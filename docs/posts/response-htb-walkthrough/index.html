<!doctype html><html lang=en><head><title>Response HTB - Insane Linux Box Walkthrough :: VAPT Walkthroughs</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Complete walkthrough of Response HTB machine featuring custom proxy exploitation, protocol smuggling, LDAP manipulation, memory forensics, and SSH key reconstruction"><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://malayamanas.github.io/posts/response-htb-walkthrough/><link rel=stylesheet href=https://malayamanas.github.io/css/buttons.min.86f6b4c106b6c6eb690ae5203d36b442c1f66f718ff4e8164fa86cf6c61ad641.css><link rel=stylesheet href=https://malayamanas.github.io/css/code.min.d529ea4b2fb8d34328d7d31afc5466d5f7bc2f0bc9abdd98b69385335d7baee4.css><link rel=stylesheet href=https://malayamanas.github.io/css/fonts.min.5bb7ed13e1d00d8ff39ea84af26737007eb5051b157b86fc24487c94f3dc8bbe.css><link rel=stylesheet href=https://malayamanas.github.io/css/footer.min.eb8dfc2c6a7eafa36cd3ba92d63e69e849e2200e0002a228d137f236b09ecd75.css><link rel=stylesheet href=https://malayamanas.github.io/css/gist.min.a751e8b0abe1ba8bc53ced52a38b19d8950fe78ca29454ea8c2595cf26aad5c0.css><link rel=stylesheet href=https://malayamanas.github.io/css/header.min.75c7eb0e2872d95ff48109c6647d0223a38db52e2561dd87966eb5fc7c6bdac6.css><link rel=stylesheet href=https://malayamanas.github.io/css/main.min.36833afd348409fc6c3d09d0897c5833d9d5bf1ff31f5e60ea3ee42ce2b1268c.css><link rel=stylesheet href=https://malayamanas.github.io/css/menu.min.3c17467ebeb3d38663dce68f71f519901124fa5cbb4519b2fb0667a21e9aca39.css><link rel=stylesheet href=https://malayamanas.github.io/css/pagination.min.bbb986dbce00a5ce5aca0504b7925fc1c581992a4bf57f163e5d69cc1db7d836.css><link rel=stylesheet href=https://malayamanas.github.io/css/post.min.e6dddd258e64c83e05cec0cd49c05216742d42fc8ecbfbe6b67083412b609bd3.css><link rel=stylesheet href=https://malayamanas.github.io/css/syntax.min.a0773cce9310cb6d8ed23e50f005448facf29a53001b57e038828daa466b25c0.css><link rel=stylesheet href=https://malayamanas.github.io/css/terminal.min.e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.css><link rel=stylesheet href=https://malayamanas.github.io/css/terms.min.b81791663c3790e738e571cdbf802312390d30e4b1d8dc9d814a5b5454d0ac11.css><link rel=stylesheet href=https://malayamanas.github.io/terminal.css><link rel="shortcut icon" href=https://malayamanas.github.io/favicon.png><link rel=apple-touch-icon href=https://malayamanas.github.io/apple-touch-icon.png><meta name=twitter:card content="summary"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Response HTB - Insane Linux Box Walkthrough"><meta property="og:description" content="Complete walkthrough of Response HTB machine featuring custom proxy exploitation, protocol smuggling, LDAP manipulation, memory forensics, and SSH key reconstruction"><meta property="og:url" content="https://malayamanas.github.io/posts/response-htb-walkthrough/"><meta property="og:site_name" content="VAPT Walkthroughs"><meta property="og:image" content="https://malayamanas.github.io/og-image.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:section" content="HTB"><meta property="article:section" content="Linux"><meta property="article:published_time" content="2024-03-15 10:00:00 +0000 UTC"></head><body><div class=container><header class=header><div class=header__inner><div class=header__logo><a href=https://malayamanas.github.io/><div class=logo>Terminal</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;â–¾</li><li><ul class=menu__dropdown><li><a href=/>Home</a></li><li><a href=/search>Search</a></li><li><a href=/tags>Tags</a></li><li><a href=/difficulty>Difficulty</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/>Home</a></li><li><a href=/search>Search</a></li><li><a href=/tags>Tags</a></li><li><a href=/difficulty>Difficulty</a></li></ul></nav></header><div class=content><article class=post><h1 class=post-title><a href=https://malayamanas.github.io/posts/response-htb-walkthrough/>Response HTB - Insane Linux Box Walkthrough</a></h1><div class=post-meta><time class=post-date>2024-03-15</time></div><span class=post-tags>#<a href=https://malayamanas.github.io/tags/insane-linux/>insane-linux</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/web/>web</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/ldap/>ldap</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/proxy/>proxy</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/protocol-smuggling/>protocol-smuggling</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/memory-forensics/>memory-forensics</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/meterpreter/>meterpreter</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/ssh-reconstruction/>ssh-reconstruction</a>&nbsp;</span><div class=post-content><div><h1 id=response-htb---insane-linux-box-walkthrough>Response HTB - Insane Linux Box Walkthrough<a href=#response-htb---insane-linux-box-walkthrough class=hanchor arialabel=Anchor>#</a></h1><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share; fullscreen" loading=eager referrerpolicy=strict-origin-when-cross-origin src="https://www.youtube.com/embed/-t1UAvTxB94?autoplay=0&amp;controls=1&amp;end=0&amp;loop=0&amp;mute=0&amp;start=0" style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 title="YouTube video"></iframe></div><p>Response is an Insane difficulty Linux machine from Hack The Box that truly lives up to its rating. This box requires standing up multiple services (web, DNS, SMTP, LDAP) on your attack machine and involves complex multi-stage exploitation including custom proxy development, cross-protocol forgery attacks, memory forensics, and SSH key reconstruction.</p><h2 id=key-exploitation-steps-and-techniques-chronological-order>Key Exploitation Steps and Techniques (Chronological Order)<a href=#key-exploitation-steps-and-techniques-chronological-order class=hanchor arialabel=Anchor>#</a></h2><h3 id=phase-1-initial-recon-and-web-proxy-bypass>Phase 1: Initial Recon and Web Proxy Bypass<a href=#phase-1-initial-recon-and-web-proxy-bypass class=hanchor arialabel=Anchor>#</a></h3><h4 id=1-port-scanning-and-host-discovery>1. Port Scanning and Host Discovery<a href=#1-port-scanning-and-host-discovery class=hanchor arialabel=Anchor>#</a></h4><ul><li>Run Nmap to identify open ports: SSH (22) and HTTP (80) on Nginx</li><li>Access the web page, identify redirects, and add virtual hosts to <code>/etc/hosts</code> (e.g., <code>response.htb</code>, <code>www.response.htb</code>, <code>proxy.response.htb</code>, <code>api.response.htb</code>, <code>chat.response.htb</code>)</li><li><strong>Technique</strong>: Basic reconnaissance with Nmap (<code>-sC -sV</code>); virtual host enumeration via source code and network inspection (Burp Suite/Developer Tools). Gobuster for directory enumeration confirms static site</li></ul><h4 id=2-bypass-proxy-url-digest-validation>2. Bypass Proxy URL Digest Validation<a href=#2-bypass-proxy-url-digest-validation class=hanchor arialabel=Anchor>#</a></h4><ul><li>Analyze proxy requests to <code>proxy.response.htb/fetch</code>; discover URL digest is a SHA-256 HMAC signed using a secret derived from PHPSESSID cookie</li><li>Manipulate PHPSESSID to include target URL (e.g., <code>http://chat.response.htb</code>), request a signed digest from the server, and reuse it to proxy arbitrary requests</li><li><strong>Technique</strong>: Session manipulation and signature oracle abuse; reverse-engineering JavaScript/PHP responses via Burp Repeater and base64 decoding</li></ul><h4 id=3-build-custom-proxy-for-chat-access>3. Build Custom Proxy for Chat Access<a href=#3-build-custom-proxy-for-chat-access class=hanchor arialabel=Anchor>#</a></h4><ul><li>Develop a Python script using <code>requests</code> and <code>http.server</code> to act as a man-in-the-middle proxy, forwarding requests to <code>chat.response.htb</code> while replacing domains to bypass restrictions. Handle MIME types, string replacements, and GET/POST methods</li><li>Download and analyze chat source code (<code>chat_source.zip</code>) to identify guest/guest creds and LDAP auth</li><li><strong>Technique</strong>: Custom scripting for proxying; content modification to evade CORS/JavaScript restrictions</li></ul><h3 id=phase-2-phishing-and-initial-user-access-bob>Phase 2: Phishing and Initial User Access (Bob)<a href=#phase-2-phishing-and-initial-user-access-bob class=hanchor arialabel=Anchor>#</a></h3><h4 id=4-spoof-ldap-for-admin-access-to-chat>4. Spoof LDAP for Admin Access to Chat<a href=#4-spoof-ldap-for-admin-access-to-chat class=hanchor arialabel=Anchor>#</a></h4><ul><li>Intercept LDAP auth requests; spoof responses using Netcat (<code>nc</code>) with hardcoded successful bind hex bytes (e.g., <code>300c02010161070a010004000400</code>) to login as admin/admin</li><li>Replace LDAP server in proxy script with attacker&rsquo;s IP</li><li><strong>Technique</strong>: Protocol spoofing/mitm on LDAP (port 389); inconsistent AI-generated responses required trial-and-error</li></ul><h4 id=5-phish-internal-ftp-info-via-chat>5. Phish Internal FTP Info via Chat<a href=#5-phish-internal-ftp-info-via-chat class=hanchor arialabel=Anchor>#</a></h4><ul><li>As admin in chat, message user &ldquo;Bob&rdquo; and convince him to share internal FTP details ([INTERNAL-FTP-IP]:2121, ftpuser:secret12345)</li><li><strong>Technique</strong>: Social engineering/phishing in real-time chat application</li></ul><h4 id=6-cross-protocol-forgery-to-exfiltrate-creds>6. Cross-Protocol Forgery to Exfiltrate Creds<a href=#6-cross-protocol-forgery-to-exfiltrate-creds class=hanchor arialabel=Anchor>#</a></h4><ul><li>Send Bob a link to malicious JavaScript (using XMLHttpRequest) that performs HTTP smuggling of FTP commands: logs in to internal FTP, uses PORT command to redirect data to attacker&rsquo;s IP/port, and retrieves <code>creds.txt</code></li><li>Monitor with Wireshark/Netcat for exfil</li><li><strong>Technique</strong>: Cross-protocol request forgery (HTTP to FTP smuggling); active mode FTP exploitation with packed port encoding; browser-based side-channel attack</li></ul><h4 id=7-ssh-as-bob>7. SSH as Bob<a href=#7-ssh-as-bob class=hanchor arialabel=Anchor>#</a></h4><ul><li>Use exfiltrated creds from <code>creds.txt</code> (bob&rsquo;s SSH password) to SSH into the box</li><li><strong>Technique</strong>: Credential reuse from exfil</li></ul><h3 id=phase-3-privilege-escalation-to-scryh>Phase 3: Privilege Escalation to scryh<a href=#phase-3-privilege-escalation-to-scryh class=hanchor arialabel=Anchor>#</a></h3><h4 id=8-analyze-and-manipulate-scansh-script>8. Analyze and Manipulate scan.sh Script<a href=#8-analyze-and-manipulate-scansh-script class=hanchor arialabel=Anchor>#</a></h4><ul><li>Examine <code>/home/scryh/scan/scan.sh</code>: script queries LDAP for IPs/emails, scans with Nmap (TLS-focused NSE scripts), generates PDF reports, and emails via SMTP (resolved via DNS MX)</li><li>Add LDAP entry (using <code>ldapadd</code> with LDIFF file) to register attacker&rsquo;s IP as a &ldquo;server&rdquo; to scan</li><li><strong>Technique</strong>: Script analysis for misconfigurations; LDAP injection/modification using bind creds from script</li></ul><h4 id=9-stand-up-fake-infrastructure-for-callback>9. Stand Up Fake Infrastructure for Callback<a href=#9-stand-up-fake-infrastructure-for-callback class=hanchor arialabel=Anchor>#</a></h4><ul><li>Create self-signed cert with OpenSSL; run HTTPS server (Python <code>http.server</code> with SSL)</li><li>Run DNSMasq with custom config for MX records pointing to attacker&rsquo;s SMTP; use iptables for port redirection (53 -> 8053)</li><li>Run SMTP debug server (Python <code>smtpd</code>)</li><li><strong>Technique</strong>: Infrastructure spoofing (web/DNS/SMTP) to receive callbacks; port redirection for compatibility</li></ul><h4 id=10-exploit-lfi-in-custom-nse-script>10. Exploit LFI in Custom NSE Script<a href=#10-exploit-lfi-in-custom-nse-script class=hanchor arialabel=Anchor>#</a></h4><ul><li>Identify modified <code>ssl-cert.nse</code> script allows reading files via <code>stateOrProvinceName</code> in cert (concatenated to <code>/data/profits_name</code>)</li><li>Set malicious state in cert (e.g., <code>../../../../home/scryh/.ssh/id_rsa</code>); server scans attacker&rsquo;s HTTPS, includes LFI output in emailed PDF report</li><li>Extract leaked id_rsa from PDF</li><li><strong>Technique</strong>: Local File Inclusion (LFI) via custom Nmap NSE script abuse; path traversal in certificate fields</li></ul><h4 id=11-ssh-as-scryh>11. SSH as scryh<a href=#11-ssh-as-scryh class=hanchor arialabel=Anchor>#</a></h4><ul><li>Use extracted id_rsa to SSH as scryh</li><li><strong>Technique</strong>: Key-based authentication with stolen private key</li></ul><h3 id=phase-4-privilege-escalation-to-root>Phase 4: Privilege Escalation to Root<a href=#phase-4-privilege-escalation-to-root class=hanchor arialabel=Anchor>#</a></h3><h4 id=12-analyze-incident-files>12. Analyze Incident Files<a href=#12-analyze-incident-files class=hanchor arialabel=Anchor>#</a></h4><ul><li>Access <code>/home/scryh/incident/</code>; download pcap, core dump, and IR PDF</li><li>Review PDF: describes meterpreter payload, encrypted stream, possible zip leak</li><li><strong>Technique</strong>: File exfiltration via Python HTTP server and wget</li></ul><h4 id=13-extract-and-decrypt-meterpreter-stream>13. Extract and Decrypt Meterpreter Stream<a href=#13-extract-and-decrypt-meterpreter-stream class=hanchor arialabel=Anchor>#</a></h4><ul><li>Use Scapy to extract TCP stream (port 4444) from pcap into binary file</li><li>Parse TLV packets: XOR key, session GUID, flags, length/type; decrypt AES-CBC portions using key from memory</li><li>Use bulk_extractor on core dump to find AES keys via key expansion/entropy analysis</li><li>Decrypt to extract leaked <code>docsbackup.zip</code></li><li><strong>Technique</strong>: Packet parsing/decryption (custom Python script for Meterpreter TLV/AES); memory forensics with bulk_extractor</li></ul><h4 id=14-reconstruct-root-ssh-key-from-screenshot>14. Reconstruct Root SSH Key from Screenshot<a href=#14-reconstruct-root-ssh-key-from-screenshot class=hanchor arialabel=Anchor>#</a></h4><ul><li>Unzip <code>docsbackup.zip</code>; find screenshot with partial base64 SSH key (bottom chunk containing prime q)</li><li>Base64-decode partial key, align bytes, extract q (193 bits)</li><li>Use public key from <code>/root/.ssh/authorized_keys</code>; reconstruct private key with RSA CTF Tool (<code>--q</code>, <code>--e</code>, <code>--private</code>)</li><li><strong>Technique</strong>: RSA key reconstruction from partial prime (using math/tools); OCR/manual transcription of image leak; padding/alignment for base64 decoding</li></ul><h4 id=15-ssh-as-root>15. SSH as Root<a href=#15-ssh-as-root class=hanchor arialabel=Anchor>#</a></h4><ul><li>Use reconstructed key to SSH as root</li><li><strong>Technique</strong>: Key-based authentication with rebuilt private key</li></ul><h2 id=security-gaps-and-remediation>Security Gaps and Remediation<a href=#security-gaps-and-remediation class=hanchor arialabel=Anchor>#</a></h2><p>This machine demonstrates multiple critical security vulnerabilities across different services:</p><h3 id=web-proxy-service-proxyresponsehtb>Web Proxy Service (proxy.response.htb)<a href=#web-proxy-service-proxyresponsehtb class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Gap</strong>: URL digest validation can be bypassed by setting PHPSESSID to include the target URL, allowing the server to sign arbitrary requests due to shared secret derivation from user-controlled session data</li><li><strong>Fix</strong>: Source code fix - Generate HMAC secrets server-side without relying on user input; implement proper validation to ensure sessions cannot control signing content</li></ul><h3 id=chat-application-chatresponsehtb>Chat Application (chat.response.htb)<a href=#chat-application-chatresponsehtb class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Gap</strong>: Allows guest/guest login and uses LDAP authentication that can be spoofed by intercepting and responding with forged successful bind responses</li><li><strong>Fix</strong>: Configuration fix - Restrict LDAP connections to internal IPs only via firewall rules; Source code fix - Enhance authentication with multi-factor or certificate-based verification beyond alphanumeric checks</li><li><strong>Gap</strong>: JavaScript and resource loading lacks restrictions, enabling domain replacements and proxying</li><li><strong>Fix</strong>: Source code fix - Hardcode internal domains in JavaScript; Configuration fix - Implement Content-Security-Policy (CSP) headers to prevent unauthorized resource loading</li></ul><h3 id=ldap-service>LDAP Service<a href=#ldap-service class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Gap</strong>: Plaintext credentials hardcoded in scripts (e.g., scan.sh), allowing unauthorized queries and additions via ldapadd</li><li><strong>Fix</strong>: Configuration fix - Store credentials in secure vaults or environment variables; Source code fix - Implement role-based access control (RBAC) to limit query/modification scopes</li><li><strong>Gap</strong>: No validation on added entries, enabling injection of malicious IPs or data</li><li><strong>Fix</strong>: Source code fix - Add input sanitization and schema enforcement for attributes like IPHostNumber</li></ul><h3 id=internal-ftp-server>Internal FTP Server<a href=#internal-ftp-server class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Gap</strong>: Exposed to browser-based attacks via cross-protocol forgery, where HTTP requests smuggle FTP commands, bypassing network restrictions</li><li><strong>Fix</strong>: Configuration fix - Isolate FTP to internal network segments with firewall rules; Source code fix - (If custom client) Validate protocols in client-side scripts to prevent smuggling</li></ul><h3 id=scan-scriptsystem-scansh-and-nmap-nse-scripts>Scan Script/System (scan.sh and Nmap NSE Scripts)<a href=#scan-scriptsystem-scansh-and-nmap-nse-scripts class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Gap</strong>: Trusts unvalidated LDAP data for scanning IPs, leading to external callbacks and report exfiltration</li><li><strong>Fix</strong>: Source code fix - Validate IPs against allowlists before scanning; Configuration fix - Run script in isolated environment with outbound restrictions</li><li><strong>Gap</strong>: Custom ssl-cert.nse script concatenates untrusted certificate fields (e.g., stateOrProvinceName) to file paths, enabling LFI/path traversal</li><li><strong>Fix</strong>: Source code fix - Sanitize and escape certificate fields before file operations</li><li><strong>Gap</strong>: Race condition in script (mentioned in initial summary) allows access to another user</li><li><strong>Fix</strong>: Source code fix - Implement file locks or atomic operations to prevent races</li></ul><h3 id=dns-and-smtp-resolution>DNS and SMTP Resolution<a href=#dns-and-smtp-resolution class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Gap</strong>: Resolves external DNS for SMTP servers based on untrusted domains, allowing attacker-controlled mail servers</li><li><strong>Fix</strong>: Configuration fix - Use internal DNS resolvers or static SMTP configurations; enforce egress filtering for DNS queries</li><li><strong>Gap</strong>: No authentication or encryption checks in SMTP sending, enabling interception of reports</li><li><strong>Fix</strong>: Configuration fix - Enable TLS and authentication for SMTP</li></ul><h3 id=incident-responseforensic-files-pcap-memory-dumps>Incident Response/Forensic Files (pcap, memory dumps)<a href=#incident-responseforensic-files-pcap-memory-dumps class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Gap</strong>: Memory dumps contain extractable AES keys due to lack of memory protections</li><li><strong>Fix</strong>: Configuration fix - Enable Address Space Layout Randomization (ASLR) and disable core dumps in production; Source code fix - Use secure key generation/wiping in payloads</li><li><strong>Gap</strong>: Encrypted Meterpreter streams in pcap can be decrypted with dumped keys</li><li><strong>Fix</strong>: Source code fix - Implement forward secrecy or ephemeral keys in custom payloads</li></ul><h3 id=ssh-system>SSH System<a href=#ssh-system class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Gap</strong>: Partial private key exposure in screenshots allows reconstruction using public key components</li><li><strong>Fix</strong>: Configuration fix - Enforce key rotation post-incident and use passphrases; Source code fix - N/A (procedural, but integrate key checks in auth modules if custom)</li></ul><h2 id=conclusion>Conclusion<a href=#conclusion class=hanchor arialabel=Anchor>#</a></h2><p>Response is an excellent machine that demonstrates the complexity of modern attack chains. It requires expertise in:</p><ul><li>Custom proxy development and web application security</li><li>Protocol manipulation and cross-protocol attacks</li><li>Infrastructure setup and service spoofing</li><li>Memory forensics and cryptographic analysis</li><li>SSH key mathematics and reconstruction</li></ul><p>The machine emphasizes that security is only as strong as the weakest link, and even sophisticated systems can be compromised through creative attack chaining and persistence.</p><hr><p><em>This walkthrough covers the complete exploitation chain for educational purposes in authorized testing environments only.</em></p></div></div></article></div><footer class=footer><div class=footer__inner><div class=copyright><span>Â© 2025 Powered by <a href=https://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=/bundle.min.js></script></div></body></html>