<!doctype html><html lang=en><head><title>Attended HTB - Hard OpenBSD Box Walkthrough :: VAPT Walkthroughs</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Complete walkthrough of Attended HTB machine featuring SMTP phishing, Vim RCE exploitation, custom HTTP C2 development, buffer overflow analysis, and ROP chain construction for privilege escalation"><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://malayamanas.github.io/posts/attended-htb-walkthrough/><link rel=stylesheet href=https://malayamanas.github.io/css/buttons.min.86f6b4c106b6c6eb690ae5203d36b442c1f66f718ff4e8164fa86cf6c61ad641.css><link rel=stylesheet href=https://malayamanas.github.io/css/code.min.d529ea4b2fb8d34328d7d31afc5466d5f7bc2f0bc9abdd98b69385335d7baee4.css><link rel=stylesheet href=https://malayamanas.github.io/css/fonts.min.5bb7ed13e1d00d8ff39ea84af26737007eb5051b157b86fc24487c94f3dc8bbe.css><link rel=stylesheet href=https://malayamanas.github.io/css/footer.min.eb8dfc2c6a7eafa36cd3ba92d63e69e849e2200e0002a228d137f236b09ecd75.css><link rel=stylesheet href=https://malayamanas.github.io/css/gist.min.a751e8b0abe1ba8bc53ced52a38b19d8950fe78ca29454ea8c2595cf26aad5c0.css><link rel=stylesheet href=https://malayamanas.github.io/css/header.min.75c7eb0e2872d95ff48109c6647d0223a38db52e2561dd87966eb5fc7c6bdac6.css><link rel=stylesheet href=https://malayamanas.github.io/css/main.min.36833afd348409fc6c3d09d0897c5833d9d5bf1ff31f5e60ea3ee42ce2b1268c.css><link rel=stylesheet href=https://malayamanas.github.io/css/menu.min.3c17467ebeb3d38663dce68f71f519901124fa5cbb4519b2fb0667a21e9aca39.css><link rel=stylesheet href=https://malayamanas.github.io/css/pagination.min.bbb986dbce00a5ce5aca0504b7925fc1c581992a4bf57f163e5d69cc1db7d836.css><link rel=stylesheet href=https://malayamanas.github.io/css/post.min.e6dddd258e64c83e05cec0cd49c05216742d42fc8ecbfbe6b67083412b609bd3.css><link rel=stylesheet href=https://malayamanas.github.io/css/syntax.min.a0773cce9310cb6d8ed23e50f005448facf29a53001b57e038828daa466b25c0.css><link rel=stylesheet href=https://malayamanas.github.io/css/terminal.min.e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.css><link rel=stylesheet href=https://malayamanas.github.io/css/terms.min.b81791663c3790e738e571cdbf802312390d30e4b1d8dc9d814a5b5454d0ac11.css><link rel=stylesheet href=https://malayamanas.github.io/terminal.css><link rel="shortcut icon" href=https://malayamanas.github.io/favicon.png><link rel=apple-touch-icon href=https://malayamanas.github.io/apple-touch-icon.png><meta name=twitter:card content="summary"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Attended HTB - Hard OpenBSD Box Walkthrough"><meta property="og:description" content="Complete walkthrough of Attended HTB machine featuring SMTP phishing, Vim RCE exploitation, custom HTTP C2 development, buffer overflow analysis, and ROP chain construction for privilege escalation"><meta property="og:url" content="https://malayamanas.github.io/posts/attended-htb-walkthrough/"><meta property="og:site_name" content="VAPT Walkthroughs"><meta property="og:image" content="https://malayamanas.github.io/og-image.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:section" content="HTB"><meta property="article:section" content="OpenBSD"><meta property="article:published_time" content="2025-09-22 07:00:00 +0000 UTC"></head><body><div class=container><header class=header><div class=header__inner><div class=header__logo><a href=https://malayamanas.github.io/><div class=logo>Terminal</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;â–¾</li><li><ul class=menu__dropdown><li><a href=/>Home</a></li><li><a href=/search>Search</a></li><li><a href=/tags>Tags</a></li><li><a href=/difficulty>Difficulty</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/>Home</a></li><li><a href=/search>Search</a></li><li><a href=/tags>Tags</a></li><li><a href=/difficulty>Difficulty</a></li></ul></nav></header><div class=content><article class=post><h1 class=post-title><a href=https://malayamanas.github.io/posts/attended-htb-walkthrough/>Attended HTB - Hard OpenBSD Box Walkthrough</a></h1><div class=post-meta><time class=post-date>2025-09-22</time></div><span class=post-tags>#<a href=https://malayamanas.github.io/tags/hard-openbsd/>hard-openbsd</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/smtp/>smtp</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/phishing/>phishing</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/vim-rce/>vim-rce</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/cve-2019-12735/>cve-2019-12735</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/buffer-overflow/>buffer-overflow</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/rop-chain/>rop-chain</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/privilege-escalation/>privilege-escalation</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/c2/>c2</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/ssh/>ssh</a>&nbsp;</span><div class=post-content><div><h1 id=attended-htb---hard-openbsd-box-walkthrough>Attended HTB - Hard OpenBSD Box Walkthrough<a href=#attended-htb---hard-openbsd-box-walkthrough class=hanchor arialabel=Anchor>#</a></h1><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share; fullscreen" loading=eager referrerpolicy=strict-origin-when-cross-origin src="https://www.youtube.com/embed/ABVR8EgXsQU?autoplay=0&amp;controls=1&amp;end=0&amp;loop=0&amp;mute=0&amp;start=0" style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 title="YouTube video"></iframe></div><h2 id=exploitation-steps>Exploitation Steps<a href=#exploitation-steps class=hanchor arialabel=Anchor>#</a></h2><ol><li><p><strong>Initial Reconnaissance (Nmap Scan)</strong>: Perform an Nmap scan on the target IP ([TARGET-IP]) to identify open ports: SSH on 22 and SMTP on 25. Discover hostname attended.htb, potential user &ldquo;gully&rdquo;, OS OpenBSD, and SMTP server OpenSMTPD.</p></li><li><p><strong>Hosts File Modification</strong>: Add &ldquo;[TARGET-IP] attended.htb&rdquo; to the local /etc/hosts file for name resolution.</p></li><li><p><strong>IPTables Logging Setup</strong>: Configure iptables to log new incoming TCP connections on the tun0 interface for monitoring reverse connections or detections.</p></li><li><p><strong>Phishing via SMTP (Initial Email)</strong>: Use swaks to send an email to <a href=mailto:gully@attended.htb>gully@attended.htb</a> with a pretext link to a local HTTP server. Observe no click, but receive a response email indicating the target initiates SMTP connections back.</p></li><li><p><strong>SMTP Server Setup for Responses</strong>: Run a Python SMTP debug server to capture response emails from gully, confirming automated replies and hints about user &ldquo;freshness&rdquo;.</p></li><li><p><strong>Email Spoofing</strong>: Spoof emails from <a href=mailto:freshness@attended.htb>freshness@attended.htb</a> to gully, eliciting responses that reveal preferences (Vim user, against proprietary attachments) and Python 2 availability.</p></li><li><p><strong>Attachment Testing</strong>: Send a .docx attachment; rejected due to proprietary format. Switch to .txt for Vim compatibility.</p></li><li><p><strong>Vim RCE Exploitation (CVE-2019-12735)</strong>: Craft a malicious .txt file with embedded code to execute a ping back to attacker IP, confirming RCE as gully when opened in Vim. Firewall blocks non-RFC compliant connections (e.g., reverse shells).</p></li><li><p><strong>Custom HTTP C2 Implant Development</strong>: Build a Python 2-compatible HTTP-based command-and-control (C2) client (web cradle) using requests.get for tasking and output, with server-side handling to keep connections open for low-latency, low-volume communication. Base64-encode the client for delivery via Vim exploit.</p></li><li><p><strong>Initial Foothold as Gully</strong>: Deliver the C2 implant via malicious .txt attachment, gaining command execution as gully. Enumerate files, find ~/.ssh/config.swap with SSH config hints.</p></li><li><p><strong>Privilege Escalation to Freshness via Cron Job</strong>: Identify cron-run fchecker.py script processing /home/shared configs. Inject a malicious SSH config with ProxyCommand executing the C2 implant, pivoting to freshness user. Drop SSH key for persistent access.</p></li><li><p><strong>Binary Discovery and Transfer</strong>: As freshness, locate authkeys binary in ~/.ssh/auth_keys. Transfer to local machine for analysis; note it&rsquo;s an OpenBSD binary with buffer overflow vulnerability.</p></li><li><p><strong>Binary Reverse Engineering</strong>: Use IDA Pro and GDB (with GEF) on an OpenBSD VM to analyze authkeys. Identify buffer overflow in base64 decoding (copies >0x300 bytes), leading to RIP overwrite.</p></li><li><p><strong>ROP Chain Construction</strong>: Build ROP chain using gadgets (not al, shr eax, pop rdx, movss, cvttss2si, mov rdi,rsi) to set registers for sys_execve (syscall 59): RAX=59, RDI=pathname (/usr/local/bin/python2), RSI=argv array, RDX=0. Use stack for strings/pointers, convert addresses to floats for SSE instructions.</p></li><li><p><strong>Exploit Formatting as SSH Public Key</strong>: Prefix ROP payload with SSH-RSA public key header (length fields, exponents) to trigger via AuthorizedKeysCommand in sshd_config on attended-gw (port 2222).</p></li><li><p><strong>Root Access on Attended-GW</strong>: Attempt SSH with exploit.pub to root@attended-gw:2222, triggering buffer overflow and executing Python 2 reverse shell as root. Retrieve root.txt.</p></li></ol><h2 id=security-gaps-and-remediation>Security Gaps and Remediation<a href=#security-gaps-and-remediation class=hanchor arialabel=Anchor>#</a></h2><h3 id=1-smtp-service-opensmtpd>1. <strong>SMTP Service (OpenSMTPD)</strong>:<a href=#1-smtp-service-opensmtpd class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Gap</strong>: Automated email responses reveal internal information such as potential usernames (e.g., &ldquo;freshness&rdquo;) and system details (e.g., Python 2 environment, Vim usage, outbound traffic restrictions).<ul><li><strong>Fix</strong>: Configuration fix - Modify OpenSMTPD configuration (/etc/mail/smtpd.conf) to disable or limit verbose error messages and automated replies to untrusted senders, using rules to filter or anonymize responses.</li></ul></li><li><strong>Gap</strong>: Allows email spoofing from internal users (e.g., spoofing from &ldquo;freshness&rdquo; to bypass dodging emails from others).<ul><li><strong>Fix</strong>: Configuration fix - Enable SPF, DKIM, or DMARC in OpenSMTPD configuration to verify sender domains and prevent spoofing; add milter plugins for additional validation.</li></ul></li><li><strong>Gap</strong>: Automated opening of email attachments in Vim, leading to RCE exploitation.<ul><li><strong>Fix</strong>: Source code fix - If automated attachment processing is custom-scripted, refactor the script to sandbox attachments or use secure viewers; alternatively, configuration fix by disabling attachment auto-opening in email client configs or using antivirus scanning.</li></ul></li></ul><h3 id=2-vim-editor>2. <strong>Vim Editor</strong>:<a href=#2-vim-editor class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Gap</strong>: Vulnerable to RCE (CVE-2019-12735) due to outdated version (2019 vulnerability).<ul><li><strong>Fix</strong>: Configuration fix - Update Vim to a patched version (e.g., via pkg_add on OpenBSD) to include security fixes; disable modelines or unsafe features in /etc/vimrc.</li></ul></li></ul><h3 id=3-firewall-system>3. <strong>Firewall System</strong>:<a href=#3-firewall-system class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Gap</strong>: Permits HTTP outbound traffic but blocks non-RFC compliant connections, allowing custom HTTP C2 but restricting standard reverse shells.<ul><li><strong>Fix</strong>: Configuration fix - Tighten firewall rules (e.g., pf.conf on OpenBSD) to whitelist specific outbound protocols/ports and inspect HTTP traffic for anomalies using tools like pf or additional IDS.</li></ul></li></ul><h3 id=4-cron-job-system-fcheckerpy-script>4. <strong>Cron Job System (fchecker.py Script)</strong>:<a href=#4-cron-job-system-fcheckerpy-script class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Gap</strong>: Processes untrusted files in /home/shared without input sanitization, leading to command injection via malicious filenames (e.g., filenames with semicolons executing arbitrary commands).<ul><li><strong>Fix</strong>: Source code fix - In fchecker.py, sanitize filenames using shlex.quote or validate against allowed characters; use subprocess.Popen with shell=False and list arguments to prevent injection.</li></ul></li><li><strong>Gap</strong>: Deletes configs after short delay (0.2 seconds) but still allows execution of embedded commands (e.g., ProxyCommand).<ul><li><strong>Fix</strong>: Source code fix - Add validation to parse and restrict SSH config options (e.g., disallow ProxyCommand) before execution; run in a restricted environment.</li></ul></li></ul><h3 id=5-ssh-service-openssh>5. <strong>SSH Service (OpenSSH)</strong>:<a href=#5-ssh-service-openssh class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Gap</strong>: SSH config allows arbitrary ProxyCommand execution from untrusted sources, enabling code execution pivot.<ul><li><strong>Fix</strong>: Configuration fix - In sshd_config, set Match blocks to restrict ProxyCommand usage or disable it via &ldquo;PermitProxyCommand no&rdquo;; ensure configs are loaded from trusted paths only.</li></ul></li><li><strong>Gap</strong>: Writable .ssh directory as freshness allows unauthorized key drops.<ul><li><strong>Fix</strong>: Configuration fix - Set stricter permissions on .ssh directories (chmod 700) and use umask; implement SELinux/AppArmor policies if available.</li></ul></li><li><strong>Gap</strong>: AuthorizedKeysCommand in sshd_config runs vulnerable binary (authkeys) for key evaluation.<ul><li><strong>Fix</strong>: Configuration fix - Disable AuthorizedKeysCommand in sshd_config or replace with a secure alternative like sshd&rsquo;s built-in key handling; restrict to run as non-root (e.g., nobody).</li></ul></li></ul><h3 id=6-custom-binary-authkeys>6. <strong>Custom Binary (authkeys)</strong>:<a href=#6-custom-binary-authkeys class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Gap</strong>: Buffer overflow in base64 decoding due to unsafe copying (copies >0x300 bytes without bounds checking).<ul><li><strong>Fix</strong>: Source code fix - Replace unsafe string operations (e.g., strcpy) with bounded alternatives like strncpy or strlcpy; implement input length validation before decoding.</li></ul></li><li><strong>Gap</strong>: Runs with elevated privileges (as root on attended-gw), allowing full system compromise via overflow.<ul><li><strong>Fix</strong>: Configuration fix - Run the binary as a low-privilege user (e.g., nobody) via sudo or setuid; drop privileges early in code if source is available.</li></ul></li><li><strong>Gap</strong>: Processes SSH public keys without validation, enabling ROP chain exploitation.<ul><li><strong>Fix</strong>: Source code fix - Add key format validation (e.g., check lengths, reject oversized keys); use secure parsing libraries for SSH keys.</li></ul></li></ul><h3 id=7-overall-system-openbsd-vms---attendedhtb-and-attended-gw>7. <strong>Overall System (OpenBSD VMs - attended.htb and attended-gw)</strong>:<a href=#7-overall-system-openbsd-vms---attendedhtb-and-attended-gw class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Gap</strong>: Information disclosure via SMTP banner and help messages (e.g., revealing OpenBSD version and contact).<ul><li><strong>Fix</strong>: Configuration fix - Customize SMTP banners in smtpd.conf to remove version/OS details; disable unnecessary HELP responses.</li></ul></li><li><strong>Gap</strong>: Old user.txt and timestamps indicate potential VM snapshot issues or lack of flag rotation, hinting at misconfiguration in HTB setup (meta, but implies insecure VM management).<ul><li><strong>Fix</strong>: Configuration fix - Ensure VM boot scripts rotate flags properly; use secure VM isolation (e.g., via bhyve or vmm on OpenBSD).</li></ul></li><li><strong>Gap</strong>: Python 2 environment exposed and used for exploits, lacking modules like requests in some contexts.<ul><li><strong>Fix</strong>: Configuration fix - Upgrade to Python 3 and remove Python 2; install necessary modules securely if needed.</li></ul></li></ul><h2 id=conclusion>Conclusion<a href=#conclusion class=hanchor arialabel=Anchor>#</a></h2><p>Attended is an excellent machine that demonstrates the complexity of modern attack chains involving social engineering, legacy software vulnerabilities, and advanced exploitation techniques on OpenBSD. It requires expertise in:</p><ul><li>SMTP enumeration and phishing campaign development</li><li>Legacy vulnerability exploitation (CVE-2019-12735)</li><li>Custom command-and-control development and deployment</li><li>Buffer overflow analysis and ROP chain construction</li><li>OpenBSD-specific binary exploitation and system hardening</li><li>Multi-stage privilege escalation through cron job abuse</li></ul><p>The machine emphasizes the importance of keeping software updated, implementing proper input validation, and securing custom binaries with appropriate privilege separation and bounds checking.</p><hr><p><em>This walkthrough covers the complete exploitation chain for educational purposes in authorized testing environments only.</em></p></div></div></article></div><footer class=footer><div class=footer__inner><div class=copyright><span>Â© 2025 Powered by <a href=https://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=/bundle.min.js></script></div></body></html>