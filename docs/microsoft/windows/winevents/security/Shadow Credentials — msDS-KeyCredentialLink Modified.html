<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Shadow Credentials — msDS-KeyCredentialLink Modified</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<nav class="navbar">
  <a href="index.html" class="nav-back">&#8592; Back to Index</a>
  <span class="nav-title">Windows Security SOP</span>
</nav>
<div class="page-header">
  <h1 class="page-title">Shadow Credentials — msDS-KeyCredentialLink Modified</h1>
  <div class="page-meta">
    <span class="badge badge-critical">Critical</span>
    <span class="meta-item"><strong>Event IDs:</strong> </span>
    <span class="meta-item"><strong>Tactics:</strong> Credential Access</span>
  </div>
  <div class="page-tags"><span class="tag-pill">credential_access</span> <span class="tag-pill">t1556.006</span></div>
</div>
<main class="content">
<hr>

<strong>Microsoft Windows Security Event Detection – Attack Technique Profile</strong>

<strong>Document Version:</strong> 1.0  
<strong>Date:</strong> February 2026  
<strong>Usecase ID / Name:</strong> Shadow Credentials — msDS-KeyCredentialLink Modified

<h3 id="1-technique-summary">1. Technique Summary</h3>

<table>
<thead>
<tr><th>Field</th><th>Value</th></tr>
</thead>
<tbody>
<tr><td><strong>Usecase Name</strong></td><td>Shadow Credentials — msDS-KeyCredentialLink Modified</td></tr>
<tr><td><strong>MITRE ATT&amp;CK Technique ID</strong></td><td>T1556.006</td></tr>
<tr><td><strong>MITRE Tactic(s)</strong></td><td>Credential Access</td></tr>
<tr><td><strong>Detection Level</strong></td><td>Critical</td></tr>
<tr><td><strong>Primary Event ID</strong></td><td>5136</td></tr>
<tr><td><strong>Log Source</strong></td><td>Windows Security Event Log</td></tr>
<tr><td><strong>Logsource Service Type</strong></td><td>security</td></tr>
<tr><td><strong>Tags</strong></td><td>credential_access, t1556.006</td></tr>
</tbody></table>

<strong>Short Description</strong>  
Shadow Credentials is a persistence and privilege escalation technique that abuses the <strong>msDS-KeyCredentialLink</strong> attribute on a target computer or user object in Active Directory. An attacker with sufficient rights (usually WriteProperty on the target object) adds their own public key to this attribute, allowing them to authenticate as the target account using a corresponding private key — without changing the account password or triggering most monitoring.

<h3 id="2-mitre-attck-mapping">2. MITRE ATT&amp;CK Mapping</h3>

<p><ul>
  <li><strong>Tactic</strong>          : Credential Access  </li>
</ul><br>
  <strong>Technique</strong>       : Modify Authentication Process: Modify Cloud Authentication Process / Shadow Credentials (T1556.006)</p>

<ul>
  <li><strong>Tactic</strong>          : Persistence / Privilege Escalation (post-compromise usage)</li>
</ul>

<h3 id="3-how-the-attack-typically-works-procedure">3. How the Attack Typically Works (Procedure)</h3>

<p><ol>
  <li>Attacker gains rights to write to the target object’s attributes:</li>
</ol><br>
<ul>
  <li>Self (via Resource-Based Constrained Delegation abuse)</li>
  <li>GenericWrite / WriteProperty on computer/user object</li>
  <li>Compromised account with high privileges</li>
</ul><br>
<ol>
  <li>Attacker generates an asymmetric key pair (usually RSA or ECC).</li>
  <li>Attacker adds the public key (in a specific ASN.1-encoded format) to the <strong>msDS-KeyCredentialLink</strong> attribute of the target computer/user object.</li>
  <li>The attacker then uses the private key to request a Kerberos TGT (via PKINIT) as the target account — no password required.</li>
  <li>With the TGT, attacker can request service tickets and move laterally or escalate privileges as the target.</li>
</ol></p>

<strong>Most common tools observed performing Shadow Credentials attacks in 2024–2026:</strong>
<ul>
  <li>Whisker (<code>whisker.exe add /target:targetcomputer$</code>)</li>
  <li>ShadowCreds / ShadowCoerce family</li>
  <li>Rubeus (<code>shadow /target:... /key:...</code>)</li>
  <li>Certipy (<code>shadow auto</code> or <code>shadow write</code>)</li>
  <li>PowerShell / custom .NET scripts abusing DirectoryServices</li>
  <li>Often combined with RBCD (Resource-Based Constrained Delegation) abuse</li>
</ul>

<h3 id="4-key-windows-security-event-indicators-event-id-5136">4. Key Windows Security Event Indicators (Event ID 5136)</h3>

<strong>Primary Detection Event:</strong> Security Event ID <strong>5136</strong> (A directory service object was modified)

<strong>Critical fields to monitor / correlate (Required attributes from your CSV):</strong>

<table>
<thead>
<tr><th>Field</th><th>Typical malicious / suspicious value(s) / pattern</th><th>Why it matters</th></tr>
</thead>
<tbody>
<tr><td><strong>ObjectDN / ObjectName</strong></td><td>Distinguished name of a computer or user object (ends in $ for computers)</td><td>Target of the shadow credential injection</td></tr>
<tr><td><strong>ObjectClass</strong></td><td>computer or user</td><td>Affected object type</td></tr>
<tr><td><strong>AttributeLDAPDisplayName</strong></td><td>msDS-KeyCredentialLink</td><td>Exact attribute being abused</td></tr>
<tr><td><strong>AttributeValue</strong></td><td>Binary blob containing ASN.1-encoded public key (often starts with 30:xx or long base64-like value)</td><td>The injected public key credential</td></tr>
<tr><td><strong>OperationType</strong></td><td>Add / Replace</td><td>Usually an addition or replacement of the attribute</td></tr>
<tr><td><strong>SubjectUserName</strong></td><td>Non-DC account performing the write (often compromised user/computer)</td><td>Legitimate writes are rare</td></tr>
<tr><td><strong>OpCorrelationID / AppCorrelationID</strong></td><td>Often present in scripted/tool-based writes</td><td>Helps correlate with tool activity</td></tr>
</tbody></table>

<strong>Highest-fidelity combination (classic Shadow Credentials signature):</strong>
<pre><code>Event ID = 5136
AttributeLDAPDisplayName = msDS-KeyCredentialLink
OperationType = Add OR Replace
ObjectClass = computer OR user
SubjectUserName is **not** a Domain Controller machine account
AttributeValue is non-empty binary/blob (public key)
→ especially when followed by PKINIT TGT requests (4768 with CertThumbprint)
</code></pre>

<h3 id="5-detection-hunting-recommendations">5. Detection / Hunting Recommendations</h3>

<strong>Strong / Classic Signature Rule (Critical Confidence)</strong>
<ul>
  <li>Event ID = 5136</li>
  <li>AttributeLDAPDisplayName = msDS-KeyCredentialLink</li>
  <li>OperationType = Add / Replace</li>
  <li>ObjectClass = computer (most common) or user</li>
  <li>Subject is <strong>not</strong> a DC computer account</li>
</ul>

<strong>Behavioral / Correlation-based Hunting Queries (SIEM / EDR)</strong>
<ul>
  <li>5136 msDS-KeyCredentialLink modifications + SubjectUserName is regular user/computer (not DC$)</li>
  <li>5136 shadow credential write + preceding RBCD abuse (5136 on msDS-AllowedToActOnBehalfOfOtherIdentity)</li>
  <li>5136 + subsequent 4768 TGT request with CertThumbprint / PreAuthType indicating PKINIT</li>
  <li>Multiple shadow credential writes from same SubjectLogonId / IpAddress</li>
</ul>

<strong>False Positive Considerations</strong>
<ul>
  <li>Extremely rare legitimate scenarios (Microsoft support / key rotation in very specific environments)</li>
  <li>Some advanced PKI / smart-card deployments (usually distinguishable by context &amp; known accounts)</li>
</ul>

<strong>Recommended Hardening (Prevention &amp; Impact Reduction)</strong>
<ul>
  <li><strong>Restrict WriteProperty</strong> rights on computer/user objects — especially msDS-KeyCredentialLink</li>
  <li>Remove unnecessary <strong>GenericWrite / WriteDacl</strong> permissions via tiered admin model</li>
  <li>Enable <strong>LDAP signing + channel binding</strong> (prevents relay → write attacks)</li>
  <li>Audit ACLs on computer objects regularly (Get-ADObjectAcl filtered for msDS-KeyCredentialLink)</li>
  <li>Monitor for unexpected PKINIT usage (4768 with certificate-based pre-auth)</li>
</ul>

<h3 id="6-recommended-response-actions">6. Recommended Response Actions</h3>

<ul>
  <li><strong>Remove the rogue key credential</strong> immediately:</li>
  <li>Clear msDS-KeyCredentialLink attribute on the target object</li>
  <li>Use PowerShell: <code>Set-ADComputer -Identity target$ -Clear &quot;msDS-KeyCredentialLink&quot;</code></li>
  <li>Isolate source workstation / account that performed the write (SubjectUserSid / IpAddress)</li>
  <li>Reset machine password of affected computer account (if computer target)</li>
  <li>Reset password of affected user account (if user target)</li>
  <li>Hunt for PKINIT TGT usage (4768 with CertThumbprint) and subsequent service tickets (4769)</li>
  <li>Review 5136, 4662, 4624, and 4768 events from the source account/IP</li>
  <li>Audit all objects with non-empty msDS-KeyCredentialLink — remove unauthorized entries</li>
</ul>

<hr>
</main>
<footer class="page-footer">
  <a href="index.html">&#8592; Back to Index</a>
</footer>
</body>
</html>