<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SAM Database Dump — Local Credential Extraction</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<nav class="navbar">
  <a href="index.html" class="nav-back">&#8592; Back to Index</a>
  <span class="nav-title">Windows Security SOP</span>
</nav>
<div class="page-header">
  <h1 class="page-title">SAM Database Dump — Local Credential Extraction</h1>
  <div class="page-meta">
    <span class="badge badge-critical">Critical</span>
    <span class="meta-item"><strong>Event IDs:</strong> </span>
    <span class="meta-item"><strong>Tactics:</strong> Credential Access</span>
  </div>
  <div class="page-tags"><span class="tag-pill">credential_access</span> <span class="tag-pill">t1003.002</span></div>
</div>
<main class="content">
<hr>

<strong>Microsoft Windows Security Event Detection – Attack Technique Profile</strong>

<strong>Document Version:</strong> 1.0  
<strong>Date:</strong> February 2026  
<strong>Usecase ID / Name:</strong> SAM Database Dump — Local Credential Extraction

<h3 id="1-technique-summary">1. Technique Summary</h3>

<table>
<thead>
<tr><th>Field</th><th>Value</th></tr>
</thead>
<tbody>
<tr><td><strong>Usecase Name</strong></td><td>SAM Database Dump — Local Credential Extraction</td></tr>
<tr><td><strong>MITRE ATT&amp;CK Technique ID</strong></td><td>T1003.002</td></tr>
<tr><td><strong>MITRE Tactic(s)</strong></td><td>Credential Access</td></tr>
<tr><td><strong>Detection Level</strong></td><td>Critical</td></tr>
<tr><td><strong>Primary Event ID(s)</strong></td><td>4656, 4663</td></tr>
<tr><td><strong>Log Source</strong></td><td>Windows Security Event Log</td></tr>
<tr><td><strong>Logsource Service Type</strong></td><td>security</td></tr>
<tr><td><strong>Tags</strong></td><td>credential_access, t1003.002</td></tr>
</tbody></table>

<strong>Short Description</strong>  
SAM (Security Accounts Manager) database dumping is a classic local credential access technique. Attackers request handles to the SAM registry hives (or offline copies) with read/write access, then extract local account NTLM hashes (and sometimes LM hashes) — enabling pass-the-hash attacks against the local machine or, if the account is reused elsewhere, against the domain.

<h3 id="2-mitre-attck-mapping">2. MITRE ATT&amp;CK Mapping</h3>

<p><ul>
  <li><strong>Tactic</strong>          : Credential Access  </li>
</ul><br>
  <strong>Technique</strong>       : OS Credential Dumping: Security Account Manager (T1003.002)</p>

<h3 id="3-how-the-attack-typically-works-procedure">3. How the Attack Typically Works (Procedure)</h3>

<p><ol>
  <li>Attacker gains administrative privileges on the target Windows system (local admin, SYSTEM via UAC bypass, privilege escalation, etc.).</li>
  <li>Attacker uses one of several methods to access the SAM database:</li>
</ol><br>
<ul>
  <li>Direct registry hive access via RegOpenKey / RegSaveKey (on live system)</li>
  <li>Offline hive extraction (copying %SystemRoot%\System32\config\SAM while system is offline or via shadow copy)</li>
  <li>Tools that impersonate SYSTEM and read SAM directly (secretsdump, pwdump-style tools)</li>
</ul><br>
<ol>
  <li>Common extraction techniques:</li>
</ol><br>
<ul>
  <li>Mimikatz <code>lsadump::sam</code></li>
  <li>Impacket <code>secretsdump.py -sam</code></li>
  <li>Reg.exe save HKLM\SAM sam.hive</li>
  <li>Volume Shadow Copy Service (vssadmin create shadow → copy SAM)</li>
  <li>Custom tools parsing SAM hive offline</li>
</ul><br>
<ol>
  <li>Extracted data: NTLM hashes of local accounts (Administrator, default accounts, cached domain logons in some cases)</li>
</ol></p>

<strong>Most common tools observed performing SAM dumping in 2024–2026:</strong>
<ul>
  <li>Mimikatz (<code>lsadump::sam</code>, <code>lsadump::secrets</code>)</li>
  <li>Impacket (<code>secretsdump.py local</code> or <code>-sam</code>)</li>
  <li>pwdump / fgdump legacy forks</li>
  <li>Reg.exe / reg save commands in scripts</li>
  <li>SharpSAM / custom .NET SAM parsers</li>
  <li>Ransomware groups often combine with vssadmin shadow deletion</li>
</ul>

<h3 id="4-key-windows-security-event-indicators-event-ids-4656-4663">4. Key Windows Security Event Indicators (Event IDs 4656, 4663)</h3>

<strong>Primary Detection Events:</strong>
<ul>
  <li><strong>4656</strong> — A handle to an object was requested</li>
  <li><strong>4663</strong> — An attempt was made to access an object</li>
</ul>

<strong>Critical fields to monitor / correlate (Required attributes from your CSV):</strong>

<table>
<thead>
<tr><th>Field</th><th>Typical malicious / suspicious value(s) / pattern</th><th>Why it matters</th></tr>
</thead>
<tbody>
<tr><td><strong>ObjectName</strong></td><td>Contains <code>\SAM</code> or full path <code>C:\Windows\System32\config\SAM</code> or <code>\Device\HarddiskVolumeShadowCopyX\Windows\System32\config\SAM</code></td><td>Target is the SAM registry hive</td></tr>
<tr><td><strong>ObjectType</strong></td><td>Registry Key (Key) or File (when shadow copy / file copy used)</td><td>Registry or file-system access to SAM</td></tr>
<tr><td><strong>AccessList / AccessMask</strong></td><td>0x100080 (KEY_READ + KEY_QUERY_VALUE) or 0x20000 (FILE_READ_DATA) + others</td><td>Rights needed to read SAM contents</td></tr>
<tr><td><strong>ProcessName</strong></td><td>Suspicious parent / process: cmd.exe, powershell.exe, reg.exe, mimikatz.exe, rundll32.exe, procdump.exe, etc.</td><td>Tool or script performing the access</td></tr>
<tr><td><strong>SubjectUserName</strong></td><td>Local Administrator, SYSTEM (via elevation), or unusual service account</td><td>Who requested the handle</td></tr>
<tr><td><strong>HandleId</strong></td><td>Followed by 4663 read operations on same handle</td><td>Indicates successful read / dump of SAM contents</td></tr>
</tbody></table>

<strong>Highest-fidelity combination (classic SAM dump signature):</strong>
<pre><code>(4656 OR 4663)
ObjectName contains SAM
AccessMask includes KEY_READ / FILE_READ_DATA
ProcessName is non-system / suspicious (reg.exe, cmd.exe, powershell.exe, mimikatz.exe)
→ especially when combined with shadow copy creation (4688 vssadmin / diskshadow) or hive save (RegSaveKey)
</code></pre>

<h3 id="5-detection-hunting-recommendations">5. Detection / Hunting Recommendations</h3>

<strong>Strong / Classic Signature Rule (Critical Confidence)</strong>
<ul>
  <li>Event ID 4656 + ObjectName contains SAM + AccessMask includes KEY_READ</li>
  <li>Event ID 4663 + ObjectName contains SAM + read access + non-legitimate ProcessName</li>
</ul>

<strong>Behavioral / Correlation-based Hunting Queries (SIEM / EDR)</strong>
<ul>
  <li>SAM registry/file access (4656/4663) + parent process is cmd/powershell/reg/rundll32</li>
  <li>4656/4663 on SAM + preceding privilege escalation (4672 SeBackupPrivilege / SeTakeOwnershipPrivilege, 4624 high-privilege logon)</li>
  <li>File creation / copy events (5145 or Sysmon 11) for sam.hive, system.hive, security.hive shortly after access</li>
  <li>vssadmin / diskshadow execution (4688) followed by SAM access</li>
</ul>

<strong>False Positive Considerations</strong>
<ul>
  <li>Legitimate backup software (Windows Server Backup, third-party tools) saving hives</li>
  <li>Forensic / IR tools run by authorized personnel</li>
  <li>AV/EDR memory/credential scanning (usually distinguishable by process name)</li>
</ul>

<strong>Recommended Hardening (Prevention &amp; Impact Reduction)</strong>
<ul>
  <li>Restrict <strong>SeBackupPrivilege</strong> and <strong>SeTakeOwnershipPrivilege</strong> — remove from Administrators group where possible</li>
  <li>Enable <strong>LAPS</strong> (Local Administrator Password Solution) or random local admin passwords</li>
  <li>Use <strong>AppLocker / WDAC</strong> to block reg.exe save operations and common LOLBins</li>
  <li>Monitor and alert on access to %SystemRoot%\System32\config\SAM outside of SYSTEM context</li>
  <li>Disable unnecessary local accounts and enforce strong, unique local admin passwords</li>
</ul>

<h3 id="6-recommended-response-actions">6. Recommended Response Actions</h3>

<ul>
  <li><strong>Isolate the compromised host immediately</strong> (source of SAM access)</li>
  <li>Reset <strong>all local account passwords</strong> on the affected machine (especially Administrator)</li>
  <li>Check for password reuse → reset domain accounts if local admin password matches domain creds</li>
  <li>Hunt for usage of dumped hashes (4624 NTLM logons from unusual IPs, Type 3 network logons)</li>
  <li>Review 4656/4663, 4688 (process creation), and 5145 events around the time of access</li>
  <li>Look for follow-on activity: lateral movement (5140/5145 admin shares), service creation (7045), scheduled tasks (4698)</li>
</ul>

<hr>
</main>
<footer class="page-footer">
  <a href="index.html">&#8592; Back to Index</a>
</footer>
</body>
</html>