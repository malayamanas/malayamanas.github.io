<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Overpass-the-Hash — Kerberos from NTLM Credential</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<nav class="navbar">
  <a href="index.html" class="nav-back">&#8592; Back to Index</a>
  <span class="nav-title">Windows Security SOP</span>
</nav>
<div class="page-header">
  <h1 class="page-title">Overpass-the-Hash — Kerberos from NTLM Credential</h1>
  <div class="page-meta">
    <span class="badge badge-high">High</span>
    <span class="meta-item"><strong>Event IDs:</strong> </span>
    <span class="meta-item"><strong>Tactics:</strong> Credential Access | Lateral Movement</span>
  </div>
  <div class="page-tags"><span class="tag-pill">credential_access</span> <span class="tag-pill">lateral_movement</span> <span class="tag-pill">t1550.002</span></div>
</div>
<main class="content">
<hr>

<strong>Microsoft Windows Security Event Detection – Attack Technique Profile</strong>

<strong>Document Version:</strong> 1.0  
<strong>Date:</strong> February 2026  
<strong>Usecase ID / Name:</strong> Overpass-the-Hash — Kerberos from NTLM Credential

<h3 id="1-technique-summary">1. Technique Summary</h3>

<table>
<thead>
<tr><th>Field</th><th>Value</th></tr>
</thead>
<tbody>
<tr><td><strong>Usecase Name</strong></td><td>Overpass-the-Hash — Kerberos from NTLM Credential</td></tr>
<tr><td><strong>MITRE ATT&amp;CK Technique ID</strong></td><td>T1550.002</td></tr>
<tr><td><strong>MITRE Tactic(s)</strong></td><td>Credential Access, Lateral Movement</td></tr>
<tr><td><strong>Detection Level</strong></td><td>High</td></tr>
<tr><td><strong>Primary Event ID</strong></td><td>4769</td></tr>
<tr><td><strong>Log Source</strong></td><td>Windows Security Event Log</td></tr>
<tr><td><strong>Logsource Service Type</strong></td><td>security</td></tr>
<tr><td><strong>Tags</strong></td><td>credential_access, lateral_movement, t1550.002</td></tr>
</tbody></table>

<strong>Short Description</strong>  
Overpass-the-Hash (OPtH) is a variation of Pass-the-Hash in which an attacker uses a stolen NTLM hash to first obtain a legitimate Kerberos TGT (via AS-REQ with RC4), then uses that TGT to request service tickets (TGS) — upgrading the authentication from NTLM to Kerberos. This allows the attacker to move laterally using modern Kerberos protocols while evading detections that focus only on NTLM Logon Type 3 with KeyLength=0.

<h3 id="2-mitre-attck-mapping">2. MITRE ATT&amp;CK Mapping</h3>

<p><ul>
  <li><strong>Tactic</strong>          : Credential Access  </li>
</ul><br>
  <strong>Technique</strong>       : Use Alternate Authentication Material: Pass the Hash (T1550.002)</p>

<p><ul>
  <li><strong>Tactic</strong>          : Lateral Movement  </li>
</ul><br>
  <strong>Technique</strong>       : Use Alternate Authentication Material: Pass the Hash (T1550.002) / Overpass-the-Hash variant</p>

<h3 id="3-how-the-attack-typically-works-procedure">3. How the Attack Typically Works (Procedure)</h3>

<ol>
  <li>Attacker obtains NTLM hash of a user (via Mimikatz sekurlsa, LSASS dump, credential dumping, previous PtH, etc.).</li>
  <li>Attacker crafts a Kerberos AS-REQ using the NT hash as the key (RC4-HMAC encryption type = 23 / 0x17).</li>
  <li>KDC validates the pre-auth (PA-ENC-TIMESTAMP) encrypted with the hash → issues a TGT encrypted with KRBTGT key.</li>
  <li>Attacker uses the legitimate TGT to request service tickets (TGS) for any SPN via normal Kerberos flow.</li>
  <li>Attacker uses the TGS for lateral movement (CIFS, WinRM, LDAP, etc.) — appears as standard Kerberos authentication.</li>
</ol>

<strong>Most common tools observed performing Overpass-the-Hash in 2024–2026:</strong>
<ul>
  <li>Mimikatz (<code>sekurlsa::pth /user:... /domain:... /ntlm:... /run:powershell.exe</code> — auto-requests TGT)</li>
  <li>Rubeus (<code>pth /user:... /rc4:... /impersonateuser:... /ptt</code> or <code>asktgt /rc4:...</code>)</li>
  <li>Impacket (<code>getTGT.py</code> with <code>-hashes</code> flag)</li>
  <li>CrackMapExec (<code>-H</code> hash + Kerberos module)</li>
  <li>Custom .NET / PowerShell Kerberos libraries</li>
</ul>

<h3 id="4-key-windows-security-event-indicators-event-id-4769">4. Key Windows Security Event Indicators (Event ID 4769)</h3>

<strong>Primary Detection Event:</strong> Security Event ID <strong>4769</strong> (A Kerberos service ticket was requested)

<strong>Critical fields to monitor / correlate (Required attributes from your CSV):</strong>

<table>
<thead>
<tr><th>Field</th><th>Typical malicious / suspicious value(s) / pattern</th><th>Why it matters</th></tr>
</thead>
<tbody>
<tr><td><strong>TicketEncryptionType</strong></td><td>0x17 (RC4-HMAC) — especially in AES-preferred environments</td><td>OPtH usually starts with RC4 TGT request due to NT hash</td></tr>
<tr><td><strong>PreAuthType</strong></td><td>2 (PA-ENC-TIMESTAMP)</td><td>Pre-auth using RC4-encrypted timestamp (hash-derived)</td></tr>
<tr><td><strong>TicketOptions</strong></td><td>Typical legitimate values (0x40810010 or similar)</td><td>TGT/TGS looks normal after upgrade</td></tr>
<tr><td><strong>ServiceName</strong></td><td>High-value SPNs (CIFS/, HOST/, LDAP/, HTTP/) after RC4 TGT request</td><td>Lateral movement target</td></tr>
<tr><td><strong>IpAddress</strong></td><td>Attacker workstation / jump host / unusual internal IP</td><td>Source of the Kerberos request</td></tr>
<tr><td><strong>SubjectUserName</strong></td><td>Privileged or recently dumped account</td><td>Account whose hash was used</td></tr>
<tr><td><strong>Status</strong></td><td>0x0 (success)</td><td>Successful ticket issuance</td></tr>
</tbody></table>

<strong>Highest-fidelity combination (strong Overpass-the-Hash indicator):</strong>
<pre><code>Event ID = 4769
TicketEncryptionType = 0x17 (RC4)
PreAuthType = 2
SubjectUserName is privileged
→ often preceded by 4624 Logon Type 3 NTLM with KeyLength=0 (hash injection)
→ or 4768 TGT request with RC4 in AES-only domain
</code></pre>

<h3 id="5-detection-hunting-recommendations">5. Detection / Hunting Recommendations</h3>

<strong>Strong / Classic Signature Rule (High Confidence)</strong>
<ul>
  <li>Event ID = 4769</li>
  <li>TicketEncryptionType = 0x17 (RC4-HMAC)</li>
  <li>Environment has AES enforced (domain functional level 2008+ with msDS-SupportedEncryptionTypes set)</li>
  <li>SubjectUserName is not a legacy/service account known to use RC4</li>
</ul>

<strong>Behavioral / Correlation-based Hunting Queries (SIEM / EDR)</strong>
<ul>
  <li>4769 with RC4 + privileged SubjectUserName + no history of RC4 usage for that account</li>
  <li>4768 TGT request (RC4) → immediate 4769 TGS request from same LogonId / IpAddress</li>
  <li>Preceding 4624 Logon Type 3 NTLM + KeyLength=0 + same SubjectUserName → hash injection → Kerberos upgrade</li>
  <li>Spike in RC4 TGT/TGS requests from single IpAddress after credential access events (4656/4663 LSASS, 4662 replication)</li>
</ul>

<strong>False Positive Considerations</strong>
<ul>
  <li>Legacy clients / applications still using RC4 (SQL, SAP, old printers)</li>
  <li>Misconfigured accounts without AES support</li>
  <li>Some third-party Kerberos stacks</li>
</ul>

<strong>Recommended Hardening (Prevention &amp; Impact Reduction)</strong>
<ul>
  <li>Disable RC4 domain-wide (<code>msDS-SupportedEncryptionTypes</code> → AES256 only)</li>
  <li>Enforce Kerberos Armoring / FAST</li>
  <li>Shorten TGT lifetimes via GPO</li>
  <li>Monitor for RC4 usage in modern environments (should be near-zero)</li>
  <li>Protect LSASS / credential dumping paths (Credential Guard, LSA protection)</li>
</ul>

<h3 id="6-recommended-response-actions">6. Recommended Response Actions</h3>

<ul>
  <li>Isolate source workstation (IpAddress / WorkstationName)</li>
  <li>Reset password of the abused account (SubjectUserName / TargetUserName)</li>
  <li>Invalidate current Kerberos tickets (force sign-out / TGT renewal)</li>
  <li>Hunt for preceding hash theft (LSASS access 4656/4663, Mimikatz indicators, 4624 NTLM PtH)</li>
  <li>Review follow-on 4624/5140/5145 events from same session for lateral movement</li>
  <li>Audit domain for remaining RC4-capable accounts — migrate to AES</li>
</ul>

<hr>
</main>
<footer class="page-footer">
  <a href="index.html">&#8592; Back to Index</a>
</footer>
</body>
</html>