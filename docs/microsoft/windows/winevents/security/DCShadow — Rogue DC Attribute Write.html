<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DCShadow — Rogue DC Attribute Write</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<nav class="navbar">
  <a href="index.html" class="nav-back">&#8592; Back to Index</a>
  <span class="nav-title">Windows Security SOP</span>
</nav>
<div class="page-header">
  <h1 class="page-title">DCShadow — Rogue DC Attribute Write</h1>
  <div class="page-meta">
    <span class="badge badge-critical">Critical</span>
    <span class="meta-item"><strong>Event IDs:</strong> </span>
    <span class="meta-item"><strong>Tactics:</strong> Defense Evasion | Credential Access</span>
  </div>
  <div class="page-tags"><span class="tag-pill">credential_access</span> <span class="tag-pill">defense_evasion</span> <span class="tag-pill">t1207</span></div>
</div>
<main class="content">
<hr>

<strong>Microsoft Windows Security Event Detection – Attack Technique Profile</strong>

<strong>Document Version:</strong> 1.0  
<strong>Date:</strong> February 2026  
<strong>Usecase ID / Name:</strong> DCShadow — Rogue DC Attribute Write

<h3 id="1-technique-summary">1. Technique Summary</h3>

<table>
<thead>
<tr><th>Field</th><th>Value</th></tr>
</thead>
<tbody>
<tr><td><strong>Usecase Name</strong></td><td>DCShadow — Rogue DC Attribute Write</td></tr>
<tr><td><strong>MITRE ATT&amp;CK Technique ID</strong></td><td>T1207</td></tr>
<tr><td><strong>MITRE Tactic(s)</strong></td><td>Defense Evasion, Credential Access</td></tr>
<tr><td><strong>Detection Level</strong></td><td>Critical</td></tr>
<tr><td><strong>Primary Event ID(s)</strong></td><td>4742, 5136</td></tr>
<tr><td><strong>Log Source</strong></td><td>Windows Security Event Log</td></tr>
<tr><td><strong>Logsource Service Type</strong></td><td>security</td></tr>
<tr><td><strong>Tags</strong></td><td>credential_access, defense_evasion, t1207</td></tr>
</tbody></table>

<strong>Short Description</strong>  
DCShadow is a post-exploitation technique that registers a rogue (non-existent) machine as a Domain Controller, allowing the attacker to impersonate a legitimate DC and push arbitrary attribute changes (e.g., user passwords, SID history, group memberships, SPNs) into Active Directory via replication — all without needing physical or direct access to a real Domain Controller.

<h3 id="2-mitre-attck-mapping">2. MITRE ATT&amp;CK Mapping</h3>

<p><ul>
  <li><strong>Tactic</strong>          : Defense Evasion  </li>
</ul><br>
  <strong>Technique</strong>       : Rogue Domain Controller (T1207)</p>

<p><ul>
  <li><strong>Tactic</strong>          : Credential Access  </li>
</ul><br>
  <strong>Technique</strong>       : (enables persistence &amp; privilege escalation via forged attributes)</p>

<h3 id="3-how-the-attack-typically-works-procedure">3. How the Attack Typically Works (Procedure)</h3>

<p><ol>
  <li>Attacker obtains highly privileged credentials (Domain Admin / Enterprise Admin or replication rights).</li>
  <li>Attacker uses a tool to:</li>
</ol><br>
<ul>
  <li>Register a fake computer object as a Domain Controller (adds <code>NTDS Settings</code> object, SPNs, etc.)</li>
  <li>Perform controlled replication push (DSInternals-style or Mimikatz <code>lsadump::dcshadow</code>)</li>
</ul><br>
<ol>
  <li>The rogue &quot;DC&quot; sends replication updates (via DRSUAPI) to a real Domain Controller.</li>
  <li>Real DC accepts changes due to attacker’s privileges → attacker can:</li>
</ol><br>
<ul>
  <li>Reset passwords</li>
  <li>Add SID history</li>
  <li>Modify group memberships</li>
  <li>Create backdoors (e.g., weak ACLs, unconstrained delegation)</li>
  <li>Inject golden ticket precursors</li>
</ul><br>
<ol>
  <li>Changes replicate domain-wide → attacker gains persistent, stealthy access.</li>
</ol></p>

<strong>Most common tools observed performing DCShadow in 2024–2026:</strong>
<ul>
  <li>Mimikatz (<code>lsadump::dcshadow /object:krbtgt /attribute:userAccountControl ...</code>)</li>
  <li>Impacket (<code>ntdsgrab.py</code> + custom replication push modules)</li>
  <li>DSInternals PowerShell (<code>New-ADReplShadowObject</code>, <code>Set-ADReplAttribute</code>)</li>
  <li>Rubeus / custom .NET DRSUAPI clients</li>
</ul>

<h3 id="4-key-windows-security-event-indicators-event-ids-4742-5136">4. Key Windows Security Event Indicators (Event IDs 4742, 5136)</h3>

<strong>Primary Detection Events:</strong>
<ul>
  <li><strong>4742</strong> — A computer account was changed (new DC registration / SPN / UAC flags)</li>
  <li><strong>5136</strong> — A directory service object was modified (attribute writes via replication)</li>
</ul>

<strong>Critical fields to monitor / correlate (Required attributes from your CSV):</strong>

<table>
<thead>
<tr><th>Field</th><th>Typical malicious / suspicious value(s) / pattern</th><th>Why it matters</th></tr>
</thead>
<tbody>
<tr><td><strong>TargetComputerName</strong></td><td>Newly created / unknown computer name (often ends in $ but no real machine exists)</td><td>Rogue DC computer object</td></tr>
<tr><td><strong>SamAccountName</strong></td><td>Fake DC name (e.g., FAKE-DC$, EVIL-DC$)</td><td>Name of the shadow DC object</td></tr>
<tr><td><strong>DnsHostName</strong></td><td>Matches fake computer name or attacker-controlled FQDN</td><td>SPN / DNS registration for rogue DC</td></tr>
<tr><td><strong>ServicePrincipalNames</strong></td><td>Contains <code>ldap/</code>, <code>GC/</code>, <code>HOST/</code>, <code>RestrictedKrbHost/</code> for the fake DC</td><td>Hallmark of DC impersonation</td></tr>
<tr><td><strong>UserAccountControl</strong></td><td>Bits set for SERVER_TRUST_ACCOUNT (0x2000), TRUSTED_FOR_DELEGATION (0x80000), etc.</td><td>Flags that make it look like a legitimate DC</td></tr>
<tr><td><strong>ObjectDN / ObjectGUID</strong></td><td>CN=NTDS Settings,CN=&lt;fake-DC&gt;,CN=Servers,CN=Default-First-Site-Name,CN=Sites,CN=Configuration,DC=...</td><td>Creation/modification of NTDS Settings object</td></tr>
<tr><td><strong>AttributeLDAPDisplayName</strong></td><td>userAccountControl, servicePrincipalName, dNSHostName, operatingSystem, whenChanged, etc.</td><td>Attributes modified to mimic a DC</td></tr>
<tr><td><strong>SubjectUserName</strong></td><td>Privileged user (often Domain Admin) performing the change</td><td>Who is registering the shadow DC</td></tr>
</tbody></table>

<strong>Highest-fidelity combination (classic DCShadow signature):</strong>
<pre><code>(4742 OR 5136)
TargetComputerName ends with $ AND is newly created / never seen before
ServicePrincipalNames contains ldap/ OR GC/ for non-DC machine
UserAccountControl includes SERVER_TRUST_ACCOUNT bit
Subject account is user (not SYSTEM from real DC)
→ especially when followed by unusual replication / attribute writes
</code></pre>

<h3 id="5-detection-hunting-recommendations">5. Detection / Hunting Recommendations</h3>

<strong>Strong / Classic Signature Rule (Critical Confidence)</strong>
<ul>
  <li>Event ID 4742 + TargetComputerName is new + ServicePrincipalNames includes DC-specific SPNs (ldap/, GC/)</li>
  <li>Event ID 5136 + AttributeLDAPDisplayName = servicePrincipalName / userAccountControl / dNSHostName + value mimics DC</li>
  <li>Subject account is <strong>not</strong> a real Domain Controller machine account</li>
</ul>

<strong>Behavioral / Correlation-based Hunting Queries (SIEM / EDR)</strong>
<ul>
  <li>New computer objects with DC-like UAC/SPNs created by non-DC subjects</li>
  <li>4742 + immediate 5136 on same ObjectGUID (NTDS Settings creation + attribute write)</li>
  <li>Unusual replication traffic (4662 with replication rights) shortly after 4742/5136</li>
  <li>Preceding privilege escalation (4672 SeDebugPrivilege, 4624 Type 3 privileged logon) + 4742/5136</li>
</ul>

<strong>False Positive Considerations</strong>
<ul>
  <li>Legitimate promotion of new Domain Controller (but usually done via dcpromo / Server Manager + known admin workflow)</li>
  <li>RODC staging / demotion events (distinguishable by context)</li>
  <li>AD health / monitoring tools (rare)</li>
</ul>

<strong>Recommended Hardening (Prevention &amp; Impact Reduction)</strong>
<ul>
  <li>Remove “Replicating Directory Changes All” rights from non-DC accounts</li>
  <li>Enable <strong>strict LDAP channel binding + signing</strong></li>
  <li>Audit computer object creation / modification in privileged OUs</li>
  <li>Monitor for new SPNs containing ldap/ or GC/ added to non-DC machines</li>
  <li>Use <strong>tier-0 isolation</strong> — no DA logons to regular systems</li>
</ul>

<h3 id="6-recommended-response-actions">6. Recommended Response Actions</h3>

<ul>
  <li><strong>Isolate source workstation</strong> where DCShadow was executed (SubjectUserSid / IpAddress)</li>
  <li><strong>Delete the rogue computer object</strong> (TargetComputerName / ObjectDN) immediately</li>
  <li><strong>Audit and reset passwords</strong> of accounts modified via the shadow replication</li>
  <li><strong>Rotate KRBTGT twice</strong> if golden-ticket precursors were written</li>
  <li>Hunt for follow-on activity: unusual 4624/4769 logons, 5136 attribute changes, SID history injection (4765/4766)</li>
  <li>Review all 4742, 5136, 4662 events from the source account/IP in the last 24–72 hours</li>
  <li>Consider enabling advanced auditing on Configuration partition and computer objects</li>
</ul>

<hr>
</main>
<footer class="page-footer">
  <a href="index.html">&#8592; Back to Index</a>
</footer>
</body>
</html>