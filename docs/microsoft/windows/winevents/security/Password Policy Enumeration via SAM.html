<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Password Policy Enumeration via SAM</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<nav class="navbar">
  <a href="index.html" class="nav-back">&#8592; Back to Index</a>
  <span class="nav-title">Windows Security SOP</span>
</nav>
<div class="page-header">
  <h1 class="page-title">Password Policy Enumeration via SAM</h1>
  <div class="page-meta">
    <span class="badge badge-low">Low</span>
    <span class="meta-item"><strong>Event IDs:</strong> </span>
    <span class="meta-item"><strong>Tactics:</strong> Credential Access | Discovery</span>
  </div>
  <div class="page-tags"><span class="tag-pill">discovery</span> <span class="tag-pill">credential_access</span> <span class="tag-pill">t1201</span></div>
</div>
<main class="content">
<hr>

<strong>Microsoft Windows Security Event Detection – Attack Technique Profile</strong>

<strong>Document Version:</strong> 1.0  
<strong>Date:</strong> February 2026  
<strong>Usecase ID / Name:</strong> Password Policy Enumeration via SAM

<h3 id="1-technique-summary">1. Technique Summary</h3>

<table>
<thead>
<tr><th>Field</th><th>Value</th></tr>
</thead>
<tbody>
<tr><td><strong>Usecase Name</strong></td><td>Password Policy Enumeration via SAM</td></tr>
<tr><td><strong>MITRE ATT&amp;CK Technique ID</strong></td><td>T1201</td></tr>
<tr><td><strong>MITRE Tactic(s)</strong></td><td>Discovery, Credential Access</td></tr>
<tr><td><strong>Detection Level</strong></td><td>Low</td></tr>
<tr><td><strong>Primary Event ID</strong></td><td>4661</td></tr>
<tr><td><strong>Log Source</strong></td><td>Windows Security Event Log</td></tr>
<tr><td><strong>Logsource Service Type</strong></td><td>security</td></tr>
<tr><td><strong>Tags</strong></td><td>discovery, credential_access, t1201</td></tr>
</tbody></table>

<strong>Short Description</strong>  
Attackers query the local SAM (Security Accounts Manager) database or domain password policy to discover lockout thresholds, password complexity requirements, maximum password age, minimum password length, and history enforcement rules. This reconnaissance helps the attacker craft effective brute-force, password spraying, or credential-stuffing attacks that avoid triggering lockouts or failing complexity checks.

<h3 id="2-mitre-attck-mapping">2. MITRE ATT&amp;CK Mapping</h3>

<p><ul>
  <li><strong>Tactic</strong>          : Discovery  </li>
</ul><br>
  <strong>Technique</strong>       : Password Policy Discovery (T1201)</p>

<p><ul>
  <li><strong>Tactic</strong>          : Credential Access  </li>
</ul><br>
  <strong>Technique</strong>       : (supports subsequent brute force / spraying)</p>

<h3 id="3-how-the-attack-typically-works-procedure">3. How the Attack Typically Works (Procedure)</h3>

<p><ol>
  <li>Attacker gains local administrative privileges or SYSTEM context on a domain-joined machine.</li>
  <li>Attacker enumerates password policy via:</li>
</ol><br>
<ul>
  <li>SAM registry hive read (HKLM\SAM\SAM\Domains\Account\Users\Names or policy keys)</li>
  <li>NetUserModalsGet API (NetUserModalsGet(3) for domain policy, NetUserModalsGet(2) for local)</li>
  <li>PowerShell (<code>Get-ADDefaultDomainPasswordPolicy</code>, <code>net accounts</code>)</li>
  <li>Mimikatz <code>misc::passwordpolicy</code></li>
  <li>Custom tools calling NetApi32.dll</li>
</ul><br>
<ol>
  <li>On domain-joined systems, local query often reflects domain policy (via cached / replicated values).</li>
  <li>Attacker uses gathered policy to:</li>
</ol><br>
<ul>
  <li>Tune brute-force scripts (stay below lockout threshold)</li>
  <li>Craft passwords meeting complexity rules</li>
  <li>Time attacks around password age / history</li>
</ul></p>

<strong>Most common tools observed performing password policy enumeration in 2024–2026:</strong>
<ul>
  <li>net.exe / net1.exe (<code>net accounts</code>)</li>
  <li>PowerShell (<code>Get-ADDefaultDomainPasswordPolicy</code>, <code>net accounts</code>)</li>
  <li>Mimikatz (<code>misc::passwordpolicy</code>)</li>
  <li>CrackMapExec / enum4linux (policy enumeration modules)</li>
  <li>BloodHound / SharpHound (domain policy collection)</li>
  <li>Custom scripts using NetUserModalsGet / SAM registry reads</li>
</ul>

<h3 id="4-key-windows-security-event-indicators-event-id-4661">4. Key Windows Security Event Indicators (Event ID 4661)</h3>

<strong>Primary Detection Event:</strong> Security Event ID <strong>4661</strong> (A handle to an object was requested)

<strong>Critical fields to monitor / correlate (Required attributes from your CSV):</strong>

<table>
<thead>
<tr><th>Field</th><th>Typical malicious / suspicious value(s) / pattern</th><th>Why it matters</th></tr>
</thead>
<tbody>
<tr><td><strong>ObjectServer</strong></td><td>Security Account Manager (SAM)</td><td>Indicates SAM database access</td></tr>
<tr><td><strong>ObjectType</strong></td><td>SAM_DOMAIN</td><td>Domain policy object being queried</td></tr>
<tr><td><strong>ObjectName</strong></td><td>SAM domain policy object (often generic or machine SID)</td><td>Target is domain-wide password policy</td></tr>
<tr><td><strong>AccessList / Properties</strong></td><td>ReadProperty on policy attributes (lockoutThreshold, lockoutDuration, minPwdLength, pwdProperties, etc.)</td><td>Specific policy fields attackers want</td></tr>
<tr><td><strong>SubjectUserName</strong></td><td>Local Administrator, SYSTEM, or unusual service account</td><td>Who is querying policy</td></tr>
<tr><td><strong>ProcessName</strong></td><td>Suspicious parent: cmd.exe, powershell.exe, mimikatz.exe, crackmapexec.exe, net.exe</td><td>Tool performing enumeration</td></tr>
</tbody></table>

<strong>Highest-fidelity combination (classic SAM policy enumeration signature):</strong>
<pre><code>Event ID = 4661
ObjectServer = SAM
ObjectType = SAM_DOMAIN
AccessList includes ReadProperty on policy fields
ProcessName / ParentProcessName is cmd.exe, powershell.exe, net.exe, mimikatz.exe
→ especially when combined with credential access attempts (4625 failures, 4656 LSASS/SAM reads)
</code></pre>

<h3 id="5-detection-hunting-recommendations">5. Detection / Hunting Recommendations</h3>

<strong>Strong / Classic Signature Rule (Medium Confidence)</strong>
<ul>
  <li>Event ID = 4661</li>
  <li>ObjectServer = SAM</li>
  <li>ObjectType = SAM_DOMAIN</li>
  <li>AccessList / Properties includes read of policy attributes</li>
  <li>ProcessName is non-system / suspicious (powershell, cmd, net.exe, mimikatz)</li>
</ul>

<strong>Behavioral / Correlation-based Hunting Queries (SIEM / EDR)</strong>
<ul>
  <li>4661 SAM_DOMAIN read + ProcessName = net.exe / powershell.exe / mimikatz.exe</li>
  <li>SAM policy enumeration + subsequent high-volume 4625 failures (brute force / spraying)</li>
  <li>4661 policy read + preceding privilege escalation (4672 SeDebugPrivilege, 4624 high-privilege logon)</li>
  <li>Correlate with other discovery: 4798/4799 group membership, 4662 LDAP reads</li>
</ul>

<strong>False Positive Considerations</strong>
<ul>
  <li>Legitimate admin / auditing scripts (<code>net accounts</code>, GPO reporting tools)</li>
  <li>Backup / monitoring agents querying policy</li>
  <li>Sysadmin troubleshooting (usually low volume, known accounts)</li>
</ul>

<strong>Recommended Hardening (Prevention &amp; Impact Reduction)</strong>
<ul>
  <li><strong>Restrict local admin rights</strong> — use LAPS or random local admin passwords</li>
  <li>Enable <strong>LSA Protection</strong> and <strong>Credential Guard</strong> — limits SAM / registry access</li>
  <li>Use <strong>AppLocker / WDAC</strong> to block execution of net.exe in non-admin contexts or restrict PowerShell</li>
  <li>Monitor and alert on SAM registry / policy object reads outside of SYSTEM context</li>
  <li>Enforce <strong>strong domain password policy</strong> — makes enumeration less useful for attackers</li>
</ul>

<h3 id="6-recommended-response-actions">6. Recommended Response Actions</h3>

<ul>
  <li><strong>Isolate the compromised host</strong> (source of policy enumeration)</li>
  <li>Review process tree (4688) and parent processes around the 4661 event</li>
  <li>Check for follow-on credential access: 4625 brute-force/spray patterns, 4656 LSASS/SAM reads</li>
  <li>Hunt for successful logons (4624) or lateral movement (5140/5145 shares) after enumeration</li>
  <li>Reset passwords of any accounts potentially targeted after policy discovery</li>
  <li>Audit local admin group membership and SAM access rights on the affected machine</li>
</ul>

<hr>
</main>
<footer class="page-footer">
  <a href="index.html">&#8592; Back to Index</a>
</footer>
</body>
</html>