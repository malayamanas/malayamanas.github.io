<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Protected Storage Service Access — Credential Theft</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<nav class="navbar">
  <a href="index.html" class="nav-back">&#8592; Back to Index</a>
  <span class="nav-title">Windows Security SOP</span>
</nav>
<div class="page-header">
  <h1 class="page-title">Protected Storage Service Access — Credential Theft</h1>
  <div class="page-meta">
    <span class="badge badge-high">High</span>
    <span class="meta-item"><strong>Event IDs:</strong> </span>
    <span class="meta-item"><strong>Tactics:</strong> Credential Access</span>
  </div>
  <div class="page-tags"><span class="tag-pill">credential_access</span> <span class="tag-pill">t1003</span></div>
</div>
<main class="content">
<hr>

<strong>Microsoft Windows Security Event Detection – Attack Technique Profile</strong>

<strong>Document Version:</strong> 1.0  
<strong>Date:</strong> February 2026  
<strong>Usecase ID / Name:</strong> Protected Storage Service Access — Credential Theft

<h3 id="1-technique-summary">1. Technique Summary</h3>

<table>
<thead>
<tr><th>Field</th><th>Value</th></tr>
</thead>
<tbody>
<tr><td><strong>Usecase Name</strong></td><td>Protected Storage Service Access — Credential Theft</td></tr>
<tr><td><strong>MITRE ATT&amp;CK Technique ID</strong></td><td>T1003</td></tr>
<tr><td><strong>MITRE Tactic(s)</strong></td><td>Credential Access</td></tr>
<tr><td><strong>Detection Level</strong></td><td>High</td></tr>
<tr><td><strong>Primary Event ID(s)</strong></td><td>4656, 4674</td></tr>
<tr><td><strong>Log Source</strong></td><td>Windows Security Event Log</td></tr>
<tr><td><strong>Logsource Service Type</strong></td><td>security</td></tr>
<tr><td><strong>Tags</strong></td><td>credential_access, t1003</td></tr>
</tbody></table>

<strong>Short Description</strong>  
Attackers attempt to access the Protected Storage Service (PStore), a legacy Windows component (pre-Vista) that stored credentials such as Internet Explorer saved passwords, AutoComplete data, and other sensitive items in an encrypted form. Although largely deprecated since Windows Vista (replaced by Credential Manager and DPAPI), remnants and compatible applications still use PStore on older systems or via compatibility layers — making it a viable (though less common) credential theft vector when attackers have elevated privileges.

<h3 id="2-mitre-attck-mapping">2. MITRE ATT&amp;CK Mapping</h3>

<p><ul>
  <li><strong>Tactic</strong>          : Credential Access  </li>
</ul><br>
  <strong>Technique</strong>       : OS Credential Dumping (T1003)  <br>
  <strong>Sub-technique</strong>   : (related to legacy credential stores)</p>

<h3 id="3-how-the-attack-typically-works-procedure">3. How the Attack Typically Works (Procedure)</h3>

<p><ol>
  <li>Attacker gains administrative or SYSTEM-level privileges on the target Windows system.</li>
  <li>Attacker targets the Protected Storage Service (pstore.dll / Protected Storage) to:</li>
</ol><br>
<ul>
  <li>Enumerate stored credentials</li>
  <li>Read protected items (IE saved passwords, Outlook credentials, dial-up passwords, etc.)</li>
</ul><br>
<ol>
  <li>Common methods:</li>
</ol><br>
<ul>
  <li>Mimikatz <code>sekurlsa::pstore</code> or <code>misc::pstore</code></li>
  <li>Custom tools calling PStore API functions (PStoreCreateInstance, PStoreEnumItems, PStoreReadItem)</li>
  <li>Registry / file access to legacy credential blobs (less common)</li>
</ul><br>
<ol>
  <li>Extracted data includes:</li>
</ol><br>
<ul>
  <li>Clear-text or decryptable passwords from Internet Explorer / legacy applications</li>
  <li>Credential blobs that can be decrypted offline with DPAPI context</li>
</ul><br>
<ol>
  <li>Often seen on older Windows versions (XP–7) or systems with legacy software still using PStore compatibility.</li>
</ol></p>

<strong>Most common tools observed performing Protected Storage access in 2024–2026:</strong>
<ul>
  <li>Mimikatz (<code>sekurlsa::pstore</code>, <code>misc::pstore</code>)</li>
  <li>LaZagne (pstore module)</li>
  <li>Custom .NET / C++ tools calling pstorec.dll APIs</li>
  <li>Legacy credential dumpers (older pwdump variants, custom scripts)</li>
  <li>Rarely seen on modern Windows 10/11 due to deprecation, but still appears in mixed environments</li>
</ul>

<h3 id="4-key-windows-security-event-indicators-event-ids-4656-4674">4. Key Windows Security Event Indicators (Event IDs 4656, 4674)</h3>

<strong>Primary Detection Events:</strong>
<ul>
  <li><strong>4656</strong> — A handle to an object was requested</li>
  <li><strong>4674</strong> — An operation was attempted on a privileged object</li>
</ul>

<strong>Critical fields to monitor / correlate (Required attributes from your CSV):</strong>

<table>
<thead>
<tr><th>Field</th><th>Typical malicious / suspicious value(s) / pattern</th><th>Why it matters</th></tr>
</thead>
<tbody>
<tr><td><strong>ObjectName</strong></td><td>Contains <code>pstorec.dll</code>, <code>ProtectedStorage</code>, or legacy credential store paths</td><td>Target is Protected Storage service / objects</td></tr>
<tr><td><strong>ObjectType</strong></td><td>Process, File, or Registry Key (when accessing pstore-related registry)</td><td>Access to service binary or configuration</td></tr>
<tr><td><strong>AccessList / AccessMask</strong></td><td>0x0010 (PROCESS_VM_READ), 0x0400 (PROCESS_QUERY_INFORMATION), or KEY_READ on related registry keys</td><td>Rights needed to read or interact with PStore</td></tr>
<tr><td><strong>PrivilegeList</strong> (4674)</td><td>SeDebugPrivilege, SeTakeOwnershipPrivilege, SeBackupPrivilege</td><td>Privileges commonly abused to access protected services</td></tr>
<tr><td><strong>ProcessName</strong></td><td>Suspicious parent: cmd.exe, powershell.exe, rundll32.exe, mimikatz.exe, custom binaries</td><td>Tool launching the access</td></tr>
<tr><td><strong>SubjectUserName</strong></td><td>Local Administrator, SYSTEM (via elevation), or unusual service account</td><td>Who requested the privileged operation</td></tr>
</tbody></table>

<strong>Highest-fidelity combination (classic PStore access signature):</strong>
<pre><code>(4656 OR 4674)
ObjectName / ObjectType references pstorec.dll or Protected Storage
AccessMask includes read / query rights
ProcessName is non-system / suspicious (powershell, cmd, mimikatz)
PrivilegeList includes SeDebugPrivilege or SeTakeOwnershipPrivilege
→ especially when combined with credential dumping indicators (LSASS access, SAM reads)
</code></pre>

<h3 id="5-detection-hunting-recommendations">5. Detection / Hunting Recommendations</h3>

<strong>Strong / Classic Signature Rule (High Confidence)</strong>
<ul>
  <li>Event ID 4656 + ObjectName contains pstorec.dll + AccessMask includes PROCESS_VM_READ</li>
  <li>Event ID 4674 + PrivilegeList contains SeDebugPrivilege + ObjectName references Protected Storage</li>
</ul>

<strong>Behavioral / Correlation-based Hunting Queries (SIEM / EDR)</strong>
<ul>
  <li>4656/4674 on pstore-related objects + parent process is cmd/powershell/rundll32/mimikatz</li>
  <li>PStore access + preceding privilege escalation (4672 SeDebugPrivilege, 4624 high-privilege logon)</li>
  <li>Correlate with other credential theft: 4656/4663 on lsass.exe, SAM hive, DPAPI keys</li>
  <li>Unusual module loads of pstorec.dll by non-system processes (Sysmon Event ID 7 if available)</li>
</ul>

<strong>False Positive Considerations</strong>
<ul>
  <li>Very rare legitimate usage (legacy IE / Outlook credential migration tools)</li>
  <li>Some password recovery / forensics utilities run by authorized personnel</li>
  <li>AV/EDR credential scanning modules (distinguishable by process name)</li>
</ul>

<strong>Recommended Hardening (Prevention &amp; Impact Reduction)</strong>
<ul>
  <li><strong>Upgrade legacy systems</strong> — Protected Storage is deprecated since Vista; migrate to Credential Manager / DPAPI</li>
  <li>Enable <strong>LSA Protection</strong> (RunAsPPL) and <strong>Credential Guard</strong> — blocks most memory / service access</li>
  <li>Restrict <strong>SeDebugPrivilege</strong> and <strong>SeTakeOwnershipPrivilege</strong> — remove from Administrators group where possible</li>
  <li>Use <strong>AppLocker / WDAC</strong> to block execution of known credential dumpers and LOLBins</li>
  <li>Monitor and alert on pstorec.dll access outside of SYSTEM context</li>
</ul>

<h3 id="6-recommended-response-actions">6. Recommended Response Actions</h3>

<ul>
  <li><strong>Isolate the compromised host</strong> immediately (source of PStore access)</li>
  <li>Kill suspicious processes and delete any extracted credential files</li>
  <li>Reset passwords of accounts whose credentials were potentially exposed (especially legacy IE/Outlook accounts)</li>
  <li>Force sign-out / credential cache clear on affected system</li>
  <li>Hunt for usage of dumped credentials (4624 NTLM/Kerberos logons from unusual IPs)</li>
  <li>Review 4656/4674, 4688 (process creation), and 5145 events around the time of access</li>
  <li>Check for follow-on activity: pass-the-hash (4624 Type 3), lateral movement (5140/5145 shares)</li>
</ul>

<hr>
</main>
<footer class="page-footer">
  <a href="index.html">&#8592; Back to Index</a>
</footer>
</body>
</html>